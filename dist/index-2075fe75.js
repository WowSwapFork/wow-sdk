import"cross-fetch/polyfill";import{RateLimiter as e}from"limiter";import{backOff as t}from"exponential-backoff";import{gql as n,request as r}from"graphql-request";import{utils as a,Contract as s,ethers as i,BigNumber as o,constants as d}from"ethers";import{StandardMerkleTree as c}from"@openzeppelin/merkle-tree";var u;!function(e){e[e.MAINNET=1]="MAINNET",e[e.GOERLI=5]="GOERLI",e[e.GNOSIS_CHAIN=100]="GNOSIS_CHAIN",e[e.MUMBAI=80001]="MUMBAI"}(u||(u={}));const l=["prod","staging"],p={env:"prod",chainId:u.MAINNET};class y extends Error{constructor(e,t){super(e),this.error_code=void 0,this.error_code=t}}const f="cow-sdk:",m="https://gnosis.mypinata.cloud/ipfs",b="https://api.pinata.cloud",{GPv2Settlement:h}=JSON.parse('{\n  "GPv2AllowListAuthentication_Implementation": {\n    "1": {\n      "address": "0x9E7Ae8Bdba9AA346739792d219a808884996Db67",\n      "transactionHash": "0x58340aa44119c74e48635fab0ac344170c6d6e8b42e5714baa4ba4e1651f63ad"\n    },\n    "4": {\n      "address": "0x9E7Ae8Bdba9AA346739792d219a808884996Db67"\n    },\n    "5": {\n      "address": "0x9E7Ae8Bdba9AA346739792d219a808884996Db67",\n      "transactionHash": "0x24f4f80b46a17345011065f9ea2af823f582db56be81098b3b66cc2db9659ea7"\n    },\n    "100": {\n      "address": "0x9E7Ae8Bdba9AA346739792d219a808884996Db67",\n      "transactionHash": "0xe52d425fe34d6d5215ccfc9ddfa485d490b3018f0ee5bbed708f2d172044d60d"\n    },\n    "80001": {\n      "address": "0x02104F2081A552C740f347b5bD97a8F6B8cfb428",\n      "transactionHash": "0x42c5c8c67ac7a27f9ee7404ed3896068835f99f8ec79b9218b713ede8adcaf1f"\n    },\n    "11155111": {\n      "address": "0x9E7Ae8Bdba9AA346739792d219a808884996Db67",\n      "transactionHash": "0xad2b992f7363e5eb8523a7034a7d36a311485f126db9938d4847cc38d2d86b86"\n    }\n  },\n  "GPv2AllowListAuthentication_Proxy": {\n    "1": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0xb84bf720364f94c749f1ec1cdf0d4c44c70411b716459aaccfd24fc677013375"\n    },\n    "4": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0x57b2278fd3a13ab1b132031024475ba1a4e28d7d4d37f556134c84512b742c1f"\n    },\n    "5": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0x39dcf30baf887a5db54551a84de8bfdb6cf418bb284b09680d13aed17d5fa0c1"\n    },\n    "100": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0x1a2d87a05a94bc6680a4faee31bbafbd74e9ddb63dd3941c717b5c609c08b957"\n    },\n    "80001": {\n      "address": "0x952862429B4aA73ea76e4C05Ba730a2BD1747b36",\n      "transactionHash": "0xd42f9d36f7f88ce6c421f3c44d122284a55aeba26bc2b984b1fca22ae7e2ac13"\n    },\n    "11155111": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0x73c54c75b3f382304f3adf33e3876c8999fb10df786d4a902733369251033cd1"\n    }\n  },\n  "GPv2AllowListAuthentication": {\n    "1": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0xb84bf720364f94c749f1ec1cdf0d4c44c70411b716459aaccfd24fc677013375"\n    },\n    "4": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0x57b2278fd3a13ab1b132031024475ba1a4e28d7d4d37f556134c84512b742c1f"\n    },\n    "5": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0x39dcf30baf887a5db54551a84de8bfdb6cf418bb284b09680d13aed17d5fa0c1"\n    },\n    "100": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0x1a2d87a05a94bc6680a4faee31bbafbd74e9ddb63dd3941c717b5c609c08b957"\n    },\n    "80001": {\n      "address": "0x952862429B4aA73ea76e4C05Ba730a2BD1747b36",\n      "transactionHash": "0xd42f9d36f7f88ce6c421f3c44d122284a55aeba26bc2b984b1fca22ae7e2ac13"\n    },\n    "11155111": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0x73c54c75b3f382304f3adf33e3876c8999fb10df786d4a902733369251033cd1"\n    }\n  },\n  "GPv2Settlement": {\n    "1": {\n      "address": "0x9008D19f58AAbD9eD0D60971565AA8510560ab41",\n      "transactionHash": "0xf49f90aa5a268c40001d1227b76bb4dd8247f18361fcad9fffd4a7a44f1320d3"\n    },\n    "4": {\n      "address": "0x9008D19f58AAbD9eD0D60971565AA8510560ab41",\n      "transactionHash": "0x609fa2e8f32c73c1f5dc21ff60a26238dacb50d4674d336c90d6950bdda17a21"\n    },\n    "5": {\n      "address": "0x9008D19f58AAbD9eD0D60971565AA8510560ab41",\n      "transactionHash": "0x982f089060ff66e19d0683ef1cc6a637297331a9ba95b65d8eb84b9f8dc64b04"\n    },\n    "100": {\n      "address": "0x9008D19f58AAbD9eD0D60971565AA8510560ab41",\n      "transactionHash": "0x9ddc538f89cd8433f4a19bc4de0de27e7c68a1d04a14b327185e4bba9af87133"\n    },\n    "80001": {\n      "address": "0xa474e4490B1B56D8a1EDE4e6eE6eF2C5c42db047",\n      "transactionHash": "0x934d1c7e46b074dc01dd2b3cb81710ecad3419555f39ea15fc7f5c53d3a00955"\n    },\n    "11155111": {\n      "address": "0x9008D19f58AAbD9eD0D60971565AA8510560ab41",\n      "transactionHash": "0x6bba22a00ffcff6bca79aced546e18d2a5a4f4e484a4e4dbafab13daf42f718d"\n    }\n  },\n  "GPv2VaultRelayer": {\n    "1": {\n      "address": "0xC92E8bdf79f0507f65a392b0ab4667716BFE0110",\n      "transactionHash": "0xf49f90aa5a268c40001d1227b76bb4dd8247f18361fcad9fffd4a7a44f1320d3"\n    },\n    "4": {\n      "address": "0xC92E8bdf79f0507f65a392b0ab4667716BFE0110",\n      "transactionHash": "0x609fa2e8f32c73c1f5dc21ff60a26238dacb50d4674d336c90d6950bdda17a21"\n    },\n    "5": {\n      "address": "0xC92E8bdf79f0507f65a392b0ab4667716BFE0110",\n      "transactionHash": "0x982f089060ff66e19d0683ef1cc6a637297331a9ba95b65d8eb84b9f8dc64b04"\n    },\n    "100": {\n      "address": "0xC92E8bdf79f0507f65a392b0ab4667716BFE0110",\n      "transactionHash": "0x9ddc538f89cd8433f4a19bc4de0de27e7c68a1d04a14b327185e4bba9af87133"\n    },\n    "80001": {\n      "address": "0x46b1a51A9166DA07db57c98B15358DE5FFfcbb97",\n      "transactionHash": "0x934d1c7e46b074dc01dd2b3cb81710ecad3419555f39ea15fc7f5c53d3a00955"\n    },\n    "11155111": {\n      "address": "0xC92E8bdf79f0507f65a392b0ab4667716BFE0110",\n      "transactionHash": "0x6bba22a00ffcff6bca79aced546e18d2a5a4f4e484a4e4dbafab13daf42f718d"\n    }\n  },\n  "GPv2TradeSimulator": {\n    "80001": {\n      "address": "0x9E88a6B1Ba0fA9c5BC9bE09a17EE982aB12DcB60",\n      "transactionHash": "0x946345cf7cda53fc88627877cacbdd94bef4f0cacc798019578e03c0e075b781"\n    }\n  }\n}'),T="0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE",E="0x2f55e8b20D0B9FEFA187AA7d00B6Cbe563605bF5",A="0x5d84eB96e4D57fB2a7945f32be7401237eD243ad",I=[u.MAINNET,u.GOERLI,u.GNOSIS_CHAIN,u.MUMBAI],v=I.reduce((e,t)=>({...e,[t]:h[t].address}),{}),g=I.reduce((e,t)=>({...e,[t]:E}),{}),O=I.reduce((e,t)=>({...e,[t]:A}),{});function S(e){return function(e){const{ethflowData:t}=e;if(!t)return e;const{userValidTo:n}=t,r=e.onchainUser||e.owner,a=T;return{...e,validTo:n,owner:r,sellToken:a}}(function(e){const{executedFeeAmount:t,executedSurplusFee:n}=e,r=null!=n?n:t;return{...e,totalFee:r}}(e))}const P=function(e,{path:n,query:r,method:a,body:s},i,o){try{const d={Accept:"application/json","Content-Type":"application/json"},c=`${e}${n}${r?"?"+r:""}`,u={method:a,body:(()=>{if(s)return"string"==typeof s?s:JSON.stringify(s)})(),headers:d};return Promise.resolve(t(function(){try{return Promise.resolve(i.removeTokens(1)).then(function(){return Promise.resolve(fetch(c,u)).then(function(e){return Promise.resolve(C(e)).then(function(t){return e.status>=200&&e.status<300?t:Promise.reject(new N(e,t))})})})}catch(e){return Promise.reject(e)}},o))}catch(e){return Promise.reject(e)}};class N extends Error{constructor(e,t){super("string"==typeof t?t:e.statusText),this.response=void 0,this.body=void 0,this.response=e,this.body=t}}const w=[408,425,429,500,502,503,504],D={numOfAttempts:10,maxDelay:Infinity,jitter:"none",retry:e=>!(e instanceof N)||w.includes(e.response.status)},_={tokensPerInterval:5,interval:"second"},C=function(e){try{let t;const n=function(){if(204!==e.status)return function(n,r){try{var a=function(){const n=e.headers.get("Content-Type");return function(){if(n)return n.toLowerCase().startsWith("application/json")?Promise.resolve(e.json()).then(function(e){return t=1,e}):Promise.resolve(e.text()).then(function(e){return t=1,e})}()}()}catch(e){return r(e)}return a&&a.then?a.then(void 0,r):a}(0,function(e){console.error(e)})}();return Promise.resolve(n&&n.then?n.then(function(e){return t?e:void 0}):t?n:void 0)}catch(e){return Promise.reject(e)}},x={[u.MAINNET]:"https://api.cow.fi/mainnet",[u.GNOSIS_CHAIN]:"https://api.cow.fi/xdai",[u.GOERLI]:"https://api.cow.fi/goerli",[u.MUMBAI]:"http://localhost:8080"},R={[u.MAINNET]:"https://barn.api.cow.fi/mainnet",[u.GNOSIS_CHAIN]:"https://barn.api.cow.fi/xdai",[u.GOERLI]:"https://barn.api.cow.fi/goerli",[u.MUMBAI]:"http://localhost:8080"};function U(e){return Object.keys(e).reduce((t,n)=>{const r=e[n];return void 0!==r&&(t[n]=r),t},{})}class k{constructor(t={}){this.context=void 0,this.rateLimiter=void 0,this.context={...p,...t},this.rateLimiter=new e(t.limiterOpts||_)}getVersion(e={}){return this.fetch({path:"/api/v1/version",method:"GET"},e)}getTrades(e,t={}){if(e.owner&&e.orderUid)return Promise.reject(new y("Cannot specify both owner and orderId"));if(!e.owner&&!e.orderUid)return Promise.reject(new y("Must specify either owner or orderId"));const n=new URLSearchParams(U(e));return this.fetch({path:"/api/v1/trades",method:"GET",query:n},t)}getOrders({owner:e,offset:t=0,limit:n=1e3},r={}){const a=new URLSearchParams(U({offset:t.toString(),limit:n.toString()}));return this.fetch({path:`/api/v1/account/${e}/orders`,method:"GET",query:a},r).then(e=>e.map(S))}getTxOrders(e,t={}){return this.fetch({path:`/api/v1/transactions/${e}/orders`,method:"GET"},t).then(e=>e.map(S))}getOrder(e,t={}){return this.fetch({path:`/api/v1/orders/${e}`,method:"GET"},t).then(e=>S(e))}getOrderMultiEnv(e,t={}){const{env:n}=this.getContextWithOverride(t),r=l.filter(e=>e!==n);let a=0;const s=n=>{const i=r[a];return n instanceof N&&404===n.response.status&&i?(a++,this.getOrder(e,{...t,env:i}).catch(s)):Promise.reject(n)};return this.getOrder(e,{...t,env:n}).catch(s)}getQuote(e,t={}){return this.fetch({path:"/api/v1/quote",method:"POST",body:e},t)}sendSignedOrderCancellations(e,t={}){return this.fetch({path:"/api/v1/orders",method:"DELETE",body:e},t)}sendOrder(e,t={}){return this.fetch({path:"/api/v1/orders",method:"POST",body:e},t)}getNativePrice(e,t={}){return this.fetch({path:`/api/v1/token/${e}/native_price`,method:"GET"},t)}getTotalSurplus(e,t={}){return this.fetch({path:`/api/v1/users/${e}/total_surplus`,method:"GET"},t)}getAppData(e,t={}){return this.fetch({path:`/api/v1/app_data/${e}`,method:"GET"},t)}uploadAppData(e,t,n={}){return this.fetch({path:`/api/v1/app_data/${e}`,method:"PUT",body:{fullAppData:t}},n)}getSolverCompetition(e,t={}){return this.fetch({path:`/api/v1/solver_competition${"string"==typeof e?"/by_tx_hash":""}/${e}`,method:"GET"},t)}getOrderLink(e,t){const{chainId:n,env:r}=this.getContextWithOverride(t);return this.getApiBaseUrls(r)[n]+`/api/v1/orders/${e}`}getContextWithOverride(e={}){return{...this.context,...e}}getApiBaseUrls(e){return this.context.baseUrls?this.context.baseUrls:"prod"===e?x:R}fetch(e,t={}){const{chainId:n,env:r}=this.getContextWithOverride(t),a=this.getApiBaseUrls(r)[n];return P(a,e,this.rateLimiter,this.context.backoffOpts||D)}}var L,B,M,F,G,$,H,V,j,W,Y,Z,q,X,K;!function(e){e.ERC20="erc20",e.INTERNAL="internal"}(L||(L={})),function(e){e.EIP712="eip712",e.ETHSIGN="ethsign"}(B||(B={})),function(e){var t;(t=e.placementError||(e.placementError={})).QUOTE_NOT_FOUND="QuoteNotFound",t.VALID_TO_TOO_FAR_IN_FUTURE="ValidToTooFarInFuture",t.PRE_VALIDATION_ERROR="PreValidationError"}(M||(M={})),function(e){var t;(t=e.errorType||(e.errorType={})).INVALID_SIGNATURE="InvalidSignature",t.WRONG_OWNER="WrongOwner",t.ORDER_NOT_FOUND="OrderNotFound",t.ALREADY_CANCELLED="AlreadyCancelled",t.ORDER_FULLY_EXECUTED="OrderFullyExecuted",t.ORDER_EXPIRED="OrderExpired",t.ON_CHAIN_ORDER="OnChainOrder"}(F||(F={})),function(e){e.MARKET="market",e.LIMIT="limit",e.LIQUIDITY="liquidity"}(G||(G={})),function(e){e.BUY="buy",e.SELL="sell"}($||($={})),function(e){var t;(t=e.errorType||(e.errorType={})).DUPLICATED_ORDER="DuplicatedOrder",t.QUOTE_NOT_FOUND="QuoteNotFound",t.INVALID_QUOTE="InvalidQuote",t.MISSING_FROM="MissingFrom",t.WRONG_OWNER="WrongOwner",t.INVALID_EIP1271SIGNATURE="InvalidEip1271Signature",t.INSUFFICIENT_BALANCE="InsufficientBalance",t.INSUFFICIENT_ALLOWANCE="InsufficientAllowance",t.INVALID_SIGNATURE="InvalidSignature",t.INSUFFICIENT_FEE="InsufficientFee",t.SELL_AMOUNT_OVERFLOW="SellAmountOverflow",t.TRANSFER_SIMULATION_FAILED="TransferSimulationFailed",t.ZERO_AMOUNT="ZeroAmount",t.INCOMPATIBLE_SIGNING_SCHEME="IncompatibleSigningScheme",t.TOO_MANY_LIMIT_ORDERS_UNSUPPORTED_BUY_TOKEN_DESTINATION="TooManyLimitOrders UnsupportedBuyTokenDestination",t.UNSUPPORTED_SELL_TOKEN_SOURCE="UnsupportedSellTokenSource",t.UNSUPPORTED_ORDER_TYPE="UnsupportedOrderType",t.INSUFFICIENT_VALID_TO="InsufficientValidTo",t.EXCESSIVE_VALID_TO="ExcessiveValidTo",t.TRANSFER_ETH_TO_CONTRACT="TransferEthToContract",t.INVALID_NATIVE_SELL_TOKEN_SAME_BUY_AND_SELL_TOKEN="InvalidNativeSellToken SameBuyAndSellToken",t.UNSUPPORTED_SIGNATURE="UnsupportedSignature",t.UNSUPPORTED_TOKEN="UnsupportedToken",t.UNSUPPORTED_CUSTOM_INTERACTION_INVALID_APP_DATA="UnsupportedCustomInteraction InvalidAppData",t.APP_DATA_HASH_MISMATCH="AppDataHashMismatch"}(H||(H={})),function(e){e.BUY="buy"}(V||(V={})),function(e){e.SELL="sell"}(j||(j={})),function(e){e.PRESIGNATURE_PENDING="presignaturePending",e.OPEN="open",e.FULFILLED="fulfilled",e.CANCELLED="cancelled",e.EXPIRED="expired"}(W||(W={})),function(e){var t;(t=e.errorType||(e.errorType={})).UNSUPPORTED_TOKEN="UnsupportedToken",t.ZERO_AMOUNT="ZeroAmount",t.UNSUPPORTED_ORDER_TYPE="UnsupportedOrderType"}(Y||(Y={})),function(e){e.FAST="fast",e.OPTIMAL="optimal",e.VERIFIED="verified"}(Z||(Z={})),function(e){var t;(t=e.errorType||(e.errorType={})).ALREADY_CANCELLED="AlreadyCancelled",t.ORDER_FULLY_EXECUTED="OrderFullyExecuted",t.ORDER_EXPIRED="OrderExpired",t.ON_CHAIN_ORDER="OnChainOrder",t.DUPLICATED_ORDER="DuplicatedOrder",t.INSUFFICIENT_FEE="InsufficientFee",t.INSUFFICIENT_ALLOWANCE="InsufficientAllowance",t.INSUFFICIENT_BALANCE="InsufficientBalance",t.INSUFFICIENT_VALID_TO="InsufficientValidTo",t.EXCESSIVE_VALID_TO="ExcessiveValidTo",t.INVALID_SIGNATURE="InvalidSignature",t.TRANSFER_ETH_TO_CONTRACT="TransferEthToContract",t.TRANSFER_SIMULATION_FAILED="TransferSimulationFailed",t.UNSUPPORTED_TOKEN="UnsupportedToken",t.WRONG_OWNER="WrongOwner",t.SAME_BUY_AND_SELL_TOKEN="SameBuyAndSellToken",t.ZERO_AMOUNT="ZeroAmount",t.UNSUPPORTED_BUY_TOKEN_DESTINATION="UnsupportedBuyTokenDestination",t.UNSUPPORTED_SELL_TOKEN_SOURCE="UnsupportedSellTokenSource",t.UNSUPPORTED_ORDER_TYPE="UnsupportedOrderType",t.UNSUPPORTED_SIGNATURE="UnsupportedSignature"}(q||(q={})),function(e){e.ERC20="erc20",e.INTERNAL="internal",e.EXTERNAL="external"}(X||(X={})),function(e){e.EIP712="eip712",e.ETHSIGN="ethsign",e.PRESIGN="presign",e.EIP1271="eip1271"}(K||(K={}));const J=n`
  query Totals {
    totals {
      tokens
      orders
      traders
      settlements
      volumeUsd
      volumeEth
      feesUsd
      feesEth
    }
  }
`,z=n`
  query LastDaysVolume($days: Int!) {
    dailyTotals(orderBy: timestamp, orderDirection: desc, first: $days) {
      timestamp
      volumeUsd
    }
  }
`,Q=n`
  query LastHoursVolume($hours: Int!) {
    hourlyTotals(orderBy: timestamp, orderDirection: desc, first: $hours) {
      timestamp
      volumeUsd
    }
  }
`,ee="https://api.thegraph.com/subgraphs/name/cowprotocol",te={[u.MAINNET]:ee+"/cow",[u.GNOSIS_CHAIN]:ee+"/cow-gc",[u.GOERLI]:ee+"/cow-goerli",[u.MUMBAI]:"https://thegraph.com/hosted-service/subgraph/shahzeb8285/wowswapfork"},ne={[u.MAINNET]:ee+"/cow-staging",[u.GNOSIS_CHAIN]:ee+"/cow-gc-staging",[u.GOERLI]:"",[u.MUMBAI]:"https://thegraph.com/hosted-service/subgraph/shahzeb8285/wowswapfork"};class re{constructor(e={}){this.API_NAME="CoW Protocol Subgraph",this.context=void 0,this.context={...p,...e}}getTotals(e={}){try{return Promise.resolve(this.runQuery(J,void 0,e)).then(function(e){return e.totals[0]})}catch(e){return Promise.reject(e)}}getLastDaysVolume(e,t={}){try{return Promise.resolve(this.runQuery(z,{days:e},t))}catch(e){return Promise.reject(e)}}getLastHoursVolume(e,t={}){try{return Promise.resolve(this.runQuery(Q,{hours:e},t))}catch(e){return Promise.reject(e)}}runQuery(e,t=undefined,n={}){try{const a=this,{chainId:s,env:i}=a.getContextWithOverride(n),o=a.getEnvConfigs(i)[s];return Promise.resolve(function(n,a){try{var s=Promise.resolve(r(o,e,t))}catch(e){return a(e)}return s&&s.then?s.then(void 0,a):s}(0,function(n){throw console.error(`[subgraph:${a.API_NAME}]`,n),new y(`Error running query: ${e}. Variables: ${JSON.stringify(t)}. API: ${o}. Inner Error: ${n}`)}))}catch(e){return Promise.reject(e)}}getContextWithOverride(e={}){return{...this.context,...e}}getEnvConfigs(e){return this.context.baseUrls?this.context.baseUrls:"prod"===e?te:ne}}const ae=()=>import("./utils-e483a037.js");class se{static signOrder(e,t,n){try{return Promise.resolve(ae()).then(function({signOrder:r}){return r(e,t,n)})}catch(e){return Promise.reject(e)}}static signOrderCancellation(e,t,n){try{return Promise.resolve(ae()).then(function({signOrderCancellation:r}){return r(e,t,n)})}catch(e){return Promise.reject(e)}}static signOrderCancellations(e,t,n){try{return Promise.resolve(ae()).then(function({signOrderCancellations:r}){return r(e,t,n)})}catch(e){return Promise.reject(e)}}static getDomain(e){try{return Promise.resolve(ae()).then(function({getDomain:t}){return t(e)})}catch(e){return Promise.reject(e)}}static getDomainSeparator(e){try{return Promise.resolve(ae()).then(function({getDomain:t}){return Promise.resolve(import("ethers/lib/utils")).then(function({_TypedDataEncoder:n}){return n.hashDomain(t(e))})})}catch(e){return Promise.reject(e)}}static getEIP712Types(){return{Order:[{name:"sellToken",type:"address"},{name:"buyToken",type:"address"},{name:"receiver",type:"address"},{name:"sellAmount",type:"uint256"},{name:"buyAmount",type:"uint256"},{name:"validTo",type:"uint32"},{name:"appData",type:"bytes32"},{name:"feeAmount",type:"uint256"},{name:"kind",type:"string"},{name:"partiallyFillable",type:"bool"},{name:"sellTokenBalance",type:"string"},{name:"buyTokenBalance",type:"string"}]}}}var ie,oe;!function(e){e[e.PRIVATE=0]="PRIVATE",e[e.EMITTED=1]="EMITTED",e[e.SWARM=2]="SWARM",e[e.WAKU=3]="WAKU",e[e.RESERVED=4]="RESERVED",e[e.IPFS=5]="IPFS"}(ie||(ie={})),function(e){e.SUCCESS="SUCCESS",e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.TRY_NEXT_BLOCK="TRY_NEXT_BLOCK",e.TRY_ON_BLOCK="TRY_ON_BLOCK",e.TRY_AT_EPOCH="TRY_AT_EPOCH",e.DONT_TRY_AGAIN="DONT_TRY_AGAIN"}(oe||(oe={}));const de=[{inputs:[{internalType:"address",name:"_settlement",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"InterfaceNotSupported",type:"error"},{inputs:[],name:"InvalidHandler",type:"error"},{inputs:[],name:"ProofNotAuthed",type:"error"},{inputs:[],name:"SingleOrderNotAuthed",type:"error"},{inputs:[],name:"SwapGuardRestricted",type:"error"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{components:[{internalType:"contract IConditionalOrder",name:"handler",type:"address"},{internalType:"bytes32",name:"salt",type:"bytes32"},{internalType:"bytes",name:"staticInput",type:"bytes"}],indexed:!1,internalType:"struct IConditionalOrder.ConditionalOrderParams",name:"params",type:"tuple"}],name:"ConditionalOrderCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!1,internalType:"bytes32",name:"root",type:"bytes32"},{components:[{internalType:"uint256",name:"location",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],indexed:!1,internalType:"struct ComposableCoW.Proof",name:"proof",type:"tuple"}],name:"MerkleRootSet",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!1,internalType:"contract ISwapGuard",name:"swapGuard",type:"address"}],name:"SwapGuardSet",type:"event"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"bytes32",name:"",type:"bytes32"}],name:"cabinet",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"contract IConditionalOrder",name:"handler",type:"address"},{internalType:"bytes32",name:"salt",type:"bytes32"},{internalType:"bytes",name:"staticInput",type:"bytes"}],internalType:"struct IConditionalOrder.ConditionalOrderParams",name:"params",type:"tuple"},{internalType:"bool",name:"dispatch",type:"bool"}],name:"create",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"contract IConditionalOrder",name:"handler",type:"address"},{internalType:"bytes32",name:"salt",type:"bytes32"},{internalType:"bytes",name:"staticInput",type:"bytes"}],internalType:"struct IConditionalOrder.ConditionalOrderParams",name:"params",type:"tuple"},{internalType:"contract IValueFactory",name:"factory",type:"address"},{internalType:"bytes",name:"data",type:"bytes"},{internalType:"bool",name:"dispatch",type:"bool"}],name:"createWithContext",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"domainSeparator",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{components:[{internalType:"contract IConditionalOrder",name:"handler",type:"address"},{internalType:"bytes32",name:"salt",type:"bytes32"},{internalType:"bytes",name:"staticInput",type:"bytes"}],internalType:"struct IConditionalOrder.ConditionalOrderParams",name:"params",type:"tuple"},{internalType:"bytes",name:"offchainInput",type:"bytes"},{internalType:"bytes32[]",name:"proof",type:"bytes32[]"}],name:"getTradeableOrderWithSignature",outputs:[{components:[{internalType:"contract IERC20",name:"sellToken",type:"address"},{internalType:"contract IERC20",name:"buyToken",type:"address"},{internalType:"address",name:"receiver",type:"address"},{internalType:"uint256",name:"sellAmount",type:"uint256"},{internalType:"uint256",name:"buyAmount",type:"uint256"},{internalType:"uint32",name:"validTo",type:"uint32"},{internalType:"bytes32",name:"appData",type:"bytes32"},{internalType:"uint256",name:"feeAmount",type:"uint256"},{internalType:"bytes32",name:"kind",type:"bytes32"},{internalType:"bool",name:"partiallyFillable",type:"bool"},{internalType:"bytes32",name:"sellTokenBalance",type:"bytes32"},{internalType:"bytes32",name:"buyTokenBalance",type:"bytes32"}],internalType:"struct GPv2Order.Data",name:"order",type:"tuple"},{internalType:"bytes",name:"signature",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"contract IConditionalOrder",name:"handler",type:"address"},{internalType:"bytes32",name:"salt",type:"bytes32"},{internalType:"bytes",name:"staticInput",type:"bytes"}],internalType:"struct IConditionalOrder.ConditionalOrderParams",name:"params",type:"tuple"}],name:"hash",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"contract Safe",name:"safe",type:"address"},{internalType:"address",name:"sender",type:"address"},{internalType:"bytes32",name:"_hash",type:"bytes32"},{internalType:"bytes32",name:"_domainSeparator",type:"bytes32"},{internalType:"bytes32",name:"",type:"bytes32"},{internalType:"bytes",name:"encodeData",type:"bytes"},{internalType:"bytes",name:"payload",type:"bytes"}],name:"isValidSafeSignature",outputs:[{internalType:"bytes4",name:"magic",type:"bytes4"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"singleOrderHash",type:"bytes32"}],name:"remove",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"roots",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"root",type:"bytes32"},{components:[{internalType:"uint256",name:"location",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],internalType:"struct ComposableCoW.Proof",name:"proof",type:"tuple"}],name:"setRoot",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"root",type:"bytes32"},{components:[{internalType:"uint256",name:"location",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],internalType:"struct ComposableCoW.Proof",name:"proof",type:"tuple"},{internalType:"contract IValueFactory",name:"factory",type:"address"},{internalType:"bytes",name:"data",type:"bytes"}],name:"setRootWithContext",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"contract ISwapGuard",name:"swapGuard",type:"address"}],name:"setSwapGuard",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"bytes32",name:"",type:"bytes32"}],name:"singleOrders",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"swapGuards",outputs:[{internalType:"contract ISwapGuard",name:"",type:"address"}],stateMutability:"view",type:"function"}];class ce{static createInterface(){return new a.Interface(de)}static connect(e,t){return new s(e,de,t)}}ce.abi=de;const ue=[{anonymous:!1,inputs:[{indexed:!0,internalType:"contract Safe",name:"safe",type:"address"},{indexed:!1,internalType:"bytes32",name:"domainSeparator",type:"bytes32"},{indexed:!1,internalType:"contract ISafeSignatureVerifier",name:"verifier",type:"address"}],name:"AddedDomainVerifier",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"contract Safe",name:"safe",type:"address"},{indexed:!1,internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"AddedInterface",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"contract Safe",name:"safe",type:"address"},{indexed:!1,internalType:"bytes4",name:"selector",type:"bytes4"},{indexed:!1,internalType:"bytes32",name:"method",type:"bytes32"}],name:"AddedSafeMethod",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"contract Safe",name:"safe",type:"address"},{indexed:!1,internalType:"bytes32",name:"domainSeparator",type:"bytes32"},{indexed:!1,internalType:"contract ISafeSignatureVerifier",name:"oldVerifier",type:"address"},{indexed:!1,internalType:"contract ISafeSignatureVerifier",name:"newVerifier",type:"address"}],name:"ChangedDomainVerifier",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"contract Safe",name:"safe",type:"address"},{indexed:!1,internalType:"bytes4",name:"selector",type:"bytes4"},{indexed:!1,internalType:"bytes32",name:"oldMethod",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"newMethod",type:"bytes32"}],name:"ChangedSafeMethod",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"contract Safe",name:"safe",type:"address"},{indexed:!1,internalType:"bytes32",name:"domainSeparator",type:"bytes32"}],name:"RemovedDomainVerifier",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"contract Safe",name:"safe",type:"address"},{indexed:!1,internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"RemovedInterface",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"contract Safe",name:"safe",type:"address"},{indexed:!1,internalType:"bytes4",name:"selector",type:"bytes4"}],name:"RemovedSafeMethod",type:"event"},{stateMutability:"nonpayable",type:"fallback"},{inputs:[{internalType:"contract Safe",name:"",type:"address"},{internalType:"bytes32",name:"",type:"bytes32"}],name:"domainVerifiers",outputs:[{internalType:"contract ISafeSignatureVerifier",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"_hash",type:"bytes32"},{internalType:"bytes",name:"signature",type:"bytes"}],name:"isValidSignature",outputs:[{internalType:"bytes4",name:"magic",type:"bytes4"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"address",name:"",type:"address"},{internalType:"uint256[]",name:"",type:"uint256[]"},{internalType:"uint256[]",name:"",type:"uint256[]"},{internalType:"bytes",name:"",type:"bytes"}],name:"onERC1155BatchReceived",outputs:[{internalType:"bytes4",name:"",type:"bytes4"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"address",name:"",type:"address"},{internalType:"uint256",name:"",type:"uint256"},{internalType:"uint256",name:"",type:"uint256"},{internalType:"bytes",name:"",type:"bytes"}],name:"onERC1155Received",outputs:[{internalType:"bytes4",name:"",type:"bytes4"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"address",name:"",type:"address"},{internalType:"uint256",name:"",type:"uint256"},{internalType:"bytes",name:"",type:"bytes"}],name:"onERC721Received",outputs:[{internalType:"bytes4",name:"",type:"bytes4"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"contract Safe",name:"",type:"address"},{internalType:"bytes4",name:"",type:"bytes4"}],name:"safeInterfaces",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"contract Safe",name:"",type:"address"},{internalType:"bytes4",name:"",type:"bytes4"}],name:"safeMethods",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"domainSeparator",type:"bytes32"},{internalType:"contract ISafeSignatureVerifier",name:"newVerifier",type:"address"}],name:"setDomainVerifier",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"selector",type:"bytes4"},{internalType:"bytes32",name:"newMethod",type:"bytes32"}],name:"setSafeMethod",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"},{internalType:"bool",name:"supported",type:"bool"}],name:"setSupportedInterface",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"_interfaceId",type:"bytes4"},{internalType:"bytes32[]",name:"handlerWithSelectors",type:"bytes32[]"}],name:"setSupportedInterfaceBatch",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"}];class le{static createInterface(){return new a.Interface(ue)}static connect(e,t){return new s(e,ue,t)}}le.abi=ue;var pe="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function ye(e){var t={exports:{}};return e(t,t.exports),t.exports}var fe=ye(function(e,t){var n=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n)return n;throw new Error("unable to locate global object")}();e.exports=t=n.fetch,n.fetch&&(t.default=n.fetch.bind(n)),t.Headers=n.Headers,t.Request=n.Request,t.Response=n.Response});const me="0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE";var be,he;!function(e){e.SELL="sell",e.BUY="buy"}(be||(be={})),function(e){e.ERC20="erc20",e.EXTERNAL="external",e.INTERNAL="internal"}(he||(he={}));const Te=[{name:"sellToken",type:"address"},{name:"buyToken",type:"address"},{name:"receiver",type:"address"},{name:"sellAmount",type:"uint256"},{name:"buyAmount",type:"uint256"},{name:"validTo",type:"uint32"},{name:"appData",type:"bytes32"},{name:"feeAmount",type:"uint256"},{name:"kind",type:"string"},{name:"partiallyFillable",type:"bool"},{name:"sellTokenBalance",type:"string"},{name:"buyTokenBalance",type:"string"}],Ee=[{name:"orderUids",type:"bytes[]"}],Ae=i.utils.id(`Order(${Te.map(({name:e,type:t})=>`${t} ${e}`).join(",")})`);function Ie(e){return"number"==typeof e?e:~~(e.getTime()/1e3)}function ve(e){return"number"==typeof e?`0x${e.toString(16).padStart(64,"0")}`:i.utils.hexZeroPad(e,32)}function ge(e){switch(e){case void 0:case he.ERC20:case he.EXTERNAL:return he.ERC20;case he.INTERNAL:return he.INTERNAL;default:throw new Error(`invalid order balance ${e}`)}}function Oe(e){var t,n;if(e.receiver===i.constants.AddressZero)throw new Error("receiver cannot be address(0)");return Object.assign(Object.assign({},e),{sellTokenBalance:null!==(t=e.sellTokenBalance)&&void 0!==t?t:he.ERC20,receiver:null!==(n=e.receiver)&&void 0!==n?n:i.constants.AddressZero,validTo:Ie(e.validTo),appData:ve(e.appData),buyTokenBalance:ge(e.buyTokenBalance)})}function Se(e,t,n){return i.utils._TypedDataEncoder.hash(e,t,n)}function Pe(e,t){return Se(e,{Order:Te},Oe(t))}function Ne(e,t){return we(e,[t])}function we(e,t){return Se(e,{OrderCancellations:Ee},{orderUids:t})}const De=56;function _e(e,t,n){return Ce({orderDigest:Pe(e,t),owner:n,validTo:t.validTo})}function Ce({orderDigest:e,owner:t,validTo:n}){return i.utils.solidityPack(["bytes32","address","uint32"],[e,t,Ie(n)])}function xe(e){const t=i.utils.arrayify(e);if(t.length!=De)throw new Error("invalid order UID length");const n=new DataView(t.buffer);return{orderDigest:i.utils.hexlify(t.subarray(0,32)),owner:i.utils.getAddress(i.utils.hexlify(t.subarray(32,52))),validTo:n.getUint32(52)}}function Re(e){return Object.assign({value:0,callData:"0x"},e)}function Ue(e){return e.map(Re)}function ke(e){return"_signTypedData"in e}function Le(e){return"send"in e}var Be=function(e,t,n,r){return new(n||(n=Promise))(function(a,s){function i(e){try{d(r.next(e))}catch(e){s(e)}}function o(e){try{d(r.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,o)}d((r=r.apply(e,t||[])).next())})};const Me=i.utils.hexDataSlice(i.utils.id("isValidSignature(bytes32,bytes)"),0,4),Fe=i.utils.id("GPv2Signing.Scheme.PreSign");var Ge,$e;function He(e,t,n,r,a){return Be(this,void 0,void 0,function*(){let s=null;switch(e){case Ge.EIP712:if(!ke(t))throw new Error("signer does not support signing typed data");s=yield t._signTypedData(n,r,a);break;case Ge.ETHSIGN:s=yield t.signMessage(i.utils.arrayify(Se(n,r,a)));break;default:throw new Error("invalid signing scheme")}return i.utils.joinSignature(i.utils.splitSignature(s))})}function Ve(e,t,n,r){return Be(this,void 0,void 0,function*(){return{scheme:r,data:yield He(r,n,e,{Order:Te},Oe(t))}})}function je(e,t,n,r){return Be(this,void 0,void 0,function*(){return We(e,[t],n,r)})}function We(e,t,n,r){return Be(this,void 0,void 0,function*(){return{scheme:r,data:yield He(r,n,e,{OrderCancellations:Ee},{orderUids:t})}})}function Ye({verifier:e,signature:t}){return i.utils.solidityPack(["address","bytes"],[e,t])}function Ze(e){const t=i.utils.arrayify(e);return{verifier:i.utils.getAddress(i.utils.hexlify(t.slice(0,20))),signature:t.slice(20)}}!function(e){e[e.EIP712=0]="EIP712",e[e.ETHSIGN=1]="ETHSIGN",e[e.EIP1271=2]="EIP1271",e[e.PRESIGN=3]="PRESIGN"}(Ge||(Ge={})),function(e){e[e.PRE=0]="PRE",e[e.INTRA=1]="INTRA",e[e.POST=2]="POST"}($e||($e={}));const qe={kind:{offset:0,options:[be.SELL,be.BUY]},partiallyFillable:{offset:1,options:[!1,!0]},sellTokenBalance:{offset:2,options:[he.ERC20,void 0,he.EXTERNAL,he.INTERNAL]},buyTokenBalance:{offset:4,options:[he.ERC20,he.INTERNAL]},signingScheme:{offset:5,options:[Ge.EIP712,Ge.ETHSIGN,Ge.EIP1271,Ge.PRESIGN]}};function Xe(e,t){const n=qe[e].options.findIndex(e=>e===t);if(void 0===n)throw new Error(`Bad key/value pair to encode: ${e}/${t}`);return n<<qe[e].offset}function Ke(e,t){const{offset:n,options:r}=qe[e],a=o.from(t).toNumber(),s=a>>n&function(e){return(1<<32-Math.clz32(e.length-1))-1}(r),i=r[s];if(void 0===i||s<0)throw new Error(`Invalid input flag for ${e}: 0b${a.toString(2)}`);return i}function Je(e){return Xe("signingScheme",e)}function ze(e){return Ke("signingScheme",e)}function Qe(e){var t;return Xe("kind",e.kind)|Xe("partiallyFillable",e.partiallyFillable)|Xe("sellTokenBalance",null!==(t=e.sellTokenBalance)&&void 0!==t?t:he.ERC20)|Xe("buyTokenBalance",ge(e.buyTokenBalance))}function et(e){return{kind:Ke("kind",e),partiallyFillable:Ke("partiallyFillable",e),sellTokenBalance:Ke("sellTokenBalance",e),buyTokenBalance:Ke("buyTokenBalance",e)}}function tt(e){return Qe(e)|Je(e.signingScheme)}function nt(e){return Object.assign(Object.assign({},et(e)),{signingScheme:ze(e)})}function rt(e){switch(e.scheme){case Ge.EIP712:case Ge.ETHSIGN:return i.utils.joinSignature(e.data);case Ge.EIP1271:return Ye(e.data);case Ge.PRESIGN:return i.utils.getAddress(e.data);default:throw new Error("unsupported signing scheme")}}function at(e,t,n,r){switch(n){case Ge.EIP712:return i.utils.verifyTypedData(e,{Order:Te},Oe(t),r);case Ge.ETHSIGN:return i.utils.verifyMessage(i.utils.arrayify(Se(e,{Order:Te},Oe(t))),r);case Ge.EIP1271:return Ze(r).verifier;case Ge.PRESIGN:return i.utils.getAddress(i.utils.hexlify(r));default:throw new Error("unsupported signing scheme")}}function st(e,t,n,{executedAmount:r}){const a=Object.assign(Object.assign({},t),{signingScheme:n.scheme}),s=Oe(t);return{sellTokenIndex:e.index(s.sellToken),buyTokenIndex:e.index(s.buyToken),receiver:s.receiver,sellAmount:s.sellAmount,buyAmount:s.buyAmount,validTo:s.validTo,appData:s.appData,feeAmount:s.feeAmount,flags:tt(a),executedAmount:r,signature:rt(n)}}class it{constructor(){this._tokens=[],this._tokenMap={}}get addresses(){return this._tokens.slice()}index(e){const t=i.utils.getAddress(e);let n=this._tokenMap[t];return void 0===n&&(n=this._tokens.length,this._tokens.push(t),this._tokenMap[t]=n),n}}class ot{constructor(e){this.domain=e,this._tokens=new it,this._trades=[],this._interactions={[$e.PRE]:[],[$e.INTRA]:[],[$e.POST]:[]},this._orderRefunds={filledAmounts:[],preSignatures:[]}}get tokens(){return this._tokens.addresses}get trades(){return this._trades.slice()}get interactions(){return[this._interactions[$e.PRE].slice(),this._interactions[$e.INTRA].slice(),[...this._interactions[$e.POST],...this.encodedOrderRefunds]]}get encodedOrderRefunds(){const{filledAmounts:e,preSignatures:t}=this._orderRefunds;if(e.length+t.length===0)return[];const n=this.domain.verifyingContract;if(void 0===n)throw new Error("domain missing settlement contract address");const r=new i.utils.Interface(["function freeFilledAmountStorage(bytes[] orderUids)","function freePreSignatureStorage(bytes[] orderUids)"]),a=[];for(const[s,i]of[["freeFilledAmountStorage",e],["freePreSignatureStorage",t]].filter(([,e])=>e.length>0))a.push(Re({target:n,callData:r.encodeFunctionData(s,[i])}));return a}clearingPrices(e){return this.tokens.map(t=>{const n=e[t];if(void 0===n)throw new Error(`missing price for token ${t}`);return n})}encodeTrade(e,t,{executedAmount:n}={}){if(e.partiallyFillable&&void 0===n)throw new Error("missing executed amount for partially fillable trade");this._trades.push(st(this._tokens,e,t,{executedAmount:null!=n?n:0}))}signEncodeTrade(e,t,n,r){return a=this,i=function*(){const a=yield Ve(this.domain,e,t,n);this.encodeTrade(e,a,r)},new((s=void 0)||(s=Promise))(function(e,t){function n(e){try{o(i.next(e))}catch(e){t(e)}}function r(e){try{o(i.throw(e))}catch(e){t(e)}}function o(t){var a;t.done?e(t.value):(a=t.value,a instanceof s?a:new s(function(e){e(a)})).then(n,r)}o((i=i.apply(a,[])).next())});var a,s,i}encodeInteraction(e,t=$e.INTRA){this._interactions[t].push(Re(e))}encodeOrderRefunds(e){var t,n;if(void 0===this.domain.verifyingContract)throw new Error("domain missing settlement contract address");const r=null!==(t=e.filledAmounts)&&void 0!==t?t:[],a=null!==(n=e.preSignatures)&&void 0!==n?n:[];if(![...r,...a].every(e=>i.utils.isHexString(e,De)))throw new Error("one or more invalid order UIDs");this._orderRefunds.filledAmounts.push(...r),this._orderRefunds.preSignatures.push(...a)}encodedSettlement(e){return[this.tokens,this.clearingPrices(e),this.trades,this.interactions]}static encodedSetup(...e){const t=new ot({name:"unused"});for(const n of e)t.encodeInteraction(n);return t.encodedSettlement({})}}function dt(e,t){const n=o.from(e.sellTokenIndex).toNumber(),r=o.from(e.buyTokenIndex).toNumber();if(Math.max(n,r)>=t.length)throw new Error("Invalid trade");return Object.assign({sellToken:t[n],buyToken:t[r],receiver:e.receiver,sellAmount:e.sellAmount,buyAmount:e.buyAmount,validTo:o.from(e.validTo).toNumber(),appData:e.appData,feeAmount:e.feeAmount},et(e.flags))}var ct,ut=function(e,t,n,r){return new(n||(n=Promise))(function(a,s){function i(e){try{d(r.next(e))}catch(e){s(e)}}function o(e){try{d(r.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,o)}d((r=r.apply(e,t||[])).next())})};!function(e){e[e.Dev=0]="Dev",e[e.Prod=1]="Prod"}(ct||(ct={}));const lt=5;function pt(e,t){switch(e){case ct.Dev:return`https://barn.api.cow.fi/${t}`;case ct.Prod:return`https://api.cow.fi/${t}`;default:throw new Error("Invalid environment")}}var yt,ft;function mt(e){switch(e){case be.SELL:return"sell";case be.BUY:return"buy";default:throw new Error(`Unsupported kind ${e}`)}}function bt(e){switch(e){case Ge.EIP712:return"eip712";case Ge.ETHSIGN:return"ethsign";case Ge.EIP1271:return"eip1271";case Ge.PRESIGN:return"presign";default:throw new Error(`Unsupported signing scheme ${e}`)}}function ht(e,t,n){return ut(this,void 0,void 0,function*(){const r=`${t}/api/v1/${e}`,a=yield fe(r,n),s=yield a.text();if(!a.ok){const e=new Error(`Calling "${r} ${JSON.stringify(n)} failed with ${a.status}: ${s}`);try{e.apiError=JSON.parse(s)}catch(e){}throw e}return JSON.parse(s)})}function Tt({baseUrl:e},t){return ut(this,void 0,void 0,function*(){return t.sellAmountBeforeFee&&(t.sellAmountBeforeFee=t.sellAmountBeforeFee.toString()),t.sellAmountAfterFee&&(t.sellAmountAfterFee=t.sellAmountAfterFee.toString()),t.buyAmountAfterFee&&(t.buyAmountAfterFee=t.buyAmountAfterFee.toString()),ht("quote",e,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})})}!function(e){e.FAST="fast",e.OPTIMAL="optimal"}(yt||(yt={})),function(e){e.SellAmountDoesNotCoverFee="SellAmountDoesNotCoverFee",e.NoLiquidity="NoLiquidity"}(ft||(ft={}));class Et{constructor(e,t){let n;this.network=e,n="string"==typeof t?t:pt(t,e),this.baseUrl=n}apiCallParams(){return{network:this.network,baseUrl:this.baseUrl}}estimateTradeAmount(e){return ut(this,void 0,void 0,function*(){return function({sellToken:e,buyToken:t,kind:n,amount:r,baseUrl:a}){return ut(this,void 0,void 0,function*(){const s=n==be.SELL?{kind:be.SELL,sellAmountAfterFee:r}:{kind:be.BUY,buyAmountAfterFee:r},{quote:i}=yield Tt({baseUrl:a},Object.assign({from:d.AddressZero,sellToken:e,buyToken:t,priceQuality:yt.FAST},s));if(i.buyToken.toLowerCase()!==t.toLowerCase())throw new Error(`Price returned for sell token ${e} uses an incorrect quote token (${i.buyToken.toLowerCase()} instead of ${t.toLowerCase()})`);return o.from(n==be.SELL?i.buyAmount:i.sellAmount)})}(Object.assign(Object.assign({},this.apiCallParams()),e))})}placeOrder(e){return ut(this,void 0,void 0,function*(){return function({order:e,signature:t,baseUrl:n,from:r}){return ut(this,void 0,void 0,function*(){const a=Oe(e);return yield ht("orders",n,{method:"post",body:JSON.stringify({sellToken:a.sellToken,buyToken:a.buyToken,sellAmount:o.from(a.sellAmount).toString(),buyAmount:o.from(a.buyAmount).toString(),validTo:a.validTo,appData:a.appData,feeAmount:o.from(a.feeAmount).toString(),kind:mt(e.kind),partiallyFillable:a.partiallyFillable,signature:rt(t),signingScheme:bt(t.scheme),receiver:a.receiver,from:r}),headers:{"Content-Type":"application/json"}})})}(Object.assign(Object.assign({},this.apiCallParams()),e))})}getExecutedSellAmount(e){return ut(this,void 0,void 0,function*(){return function({uid:e,baseUrl:t}){return ut(this,void 0,void 0,function*(){const n=yield ht(`orders/${e}`,t);return o.from(n.executedSellAmount)})}(Object.assign(Object.assign({},this.apiCallParams()),e))})}getQuote(e){return ut(this,void 0,void 0,function*(){return Tt(this.apiCallParams(),e)})}}const At=a.formatBytes32String("Mattresses in Berlin!"),It="0x4e59b44847b379578588920ca78fbf26c0b4956c",vt={authenticator:"GPv2AllowListAuthentication",settlement:"GPv2Settlement",tradeSimulator:"GPv2TradeSimulator"};function gt({abi:e,bytecode:t},n){const r=new a.Interface(e),s=a.hexConcat([t,r.encodeDeploy(n)]);return a.getCreate2Address(It,At,a.keccak256(s))}var Ot=function(e,t,n,r){return new(n||(n=Promise))(function(a,s){function i(e){try{d(r.next(e))}catch(e){s(e)}}function o(e){try{d(r.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,o)}d((r=r.apply(e,t||[])).next())})};function St(e){return i.utils.defaultAbiCoder.encode(["bytes32"],[o.from(i.utils.id(e)).sub(1)])}const Pt=St("eip1967.proxy.implementation"),Nt=St("eip1967.proxy.admin");function wt(e,t){return Ot(this,void 0,void 0,function*(){const[n]=i.utils.defaultAbiCoder.decode(["address"],yield e.getStorageAt(t,Pt));return n})}function Dt(e,t){return Ot(this,void 0,void 0,function*(){const[n]=i.utils.defaultAbiCoder.decode(["address"],yield e.getStorageAt(t,Nt));return n})}const _t=["event OwnershipTransferred(address indexed previousOwner, address indexed newOwner)","function owner() view external returns(address)","function transferOwnership(address newOwner) external","function supportsInterface(bytes4 interfaceID) external view returns (bool)"];function Ct(e){var t;return new s(e.address,_t,null!==(t=e.signer)&&void 0!==t?t:e.provider)}var xt=function(e,t,n,r){return new(n||(n=Promise))(function(a,s){function i(e){try{d(r.next(e))}catch(e){s(e)}}function o(e){try{d(r.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,o)}d((r=r.apply(e,t||[])).next())})};const Rt=new i.utils.Interface(["function manageUserBalance((uint8, address, uint256, address, address)[])","function batchSwap(uint8, (bytes32, uint256, uint256, uint256, bytes)[], address[], (address, bool, address, bool), int256[], uint256)"]);function Ut(e,t,n){return xt(this,void 0,void 0,function*(){for(const r in Rt.functions)yield e.grantRole(i.utils.solidityKeccak256(["uint256","bytes4"],[t,Rt.getSighash(r)]),n)})}const kt=function(e){try{return Promise.resolve(e.getBlock("latest")).then(function(e){return{blockNumber:e.number,blockTimestamp:e.timestamp}})}catch(e){return Promise.reject(e)}},Lt=function(e,t,n,r){try{const a=le.connect(g[n],r);return Promise.resolve(a.callStatic.domainVerifiers(e,t))}catch(e){return Promise.reject(e)}},Bt=["erc20","0x5a28e9363bb942b639270062aa6bb295f434bcdfc42c97267bf003f272060dc9"],Mt=["external","0xabee3b73373acd583a130924aad6dc38cfdc44ba0555ba94ce2ff63980ea0632"],Ft=["internal","0x4ac99ace14ee0a5ef932dc609df0943ab7ac16b7583634612f8dc35a4289a6ce"],Gt=["sell","0xf3b277728b3fee749481eb3e0b3b48980dbbab78658fc419025cb16eee346775"],$t=["buy","0x6ed88e868af0a1983e3886d5f3e95a2fafbd6c3450bc229e27342283dc429ccc"],Ht=["tuple(address handler, bytes32 salt, bytes staticInput)"],Vt=(e,t)=>`${t}@${e}`;function jt(e,t){return e===g[t]}function Wt(e,t){return e===O[t]}function Yt(e,t){return le.createInterface().encodeFunctionData("setDomainVerifier",[e,t])}function Zt(e){return a.defaultAbiCoder.encode(Ht,[e])}function qt(e){const{handler:t,salt:n,staticInput:r}=a.defaultAbiCoder.decode(Ht,e)[0];return{handler:t,salt:n,staticInput:r}}function Xt(e,t){try{a.defaultAbiCoder.encode(e,t)}catch(e){return!1}return!0}function Kt(e){return new Date(1e3*e).toISOString()}function Jt(e){if(Bt.includes(e))return he.ERC20;if(Mt.includes(e))return he.EXTERNAL;if(Ft.includes(e))return he.INTERNAL;throw new Error(`Unknown balance type: ${e}`)}function zt(e){if(Gt.includes(e))return be.SELL;if($t.includes(e))return be.BUY;throw new Error(`Unknown kind: ${e}`)}function Qt(e){const{sellToken:t,sellAmount:n,buyToken:r,buyAmount:a,buyTokenBalance:s,sellTokenBalance:i,feeAmount:o,kind:d,receiver:c,validTo:u,partiallyFillable:l,appData:p}=e;return{sellToken:t,sellAmount:n,buyToken:r,buyAmount:a,feeAmount:o,receiver:c,partiallyFillable:l,appData:p,validTo:Number(u),kind:zt(d.toString()),sellTokenBalance:Jt(i.toString()),buyTokenBalance:Jt(s.toString())}}let en,tn;function nn(){return en||(en=ce.createInterface()),en}function rn(e,t){return tn||(tn=ce.connect(O[e],t)),tn}const an={};class sn{constructor(e){this.handler=void 0,this.salt=void 0,this.data=void 0,this.staticInput=void 0,this.hasOffChainInput=void 0;const{handler:t,salt:n=a.keccak256(a.randomBytes(32)),data:r,hasOffChainInput:s=!1}=e;if(!i.utils.isAddress(t))throw new Error(`Invalid handler: ${t}`);if(!i.utils.isHexString(n)||32!==i.utils.hexDataLength(n))throw new Error(`Invalid salt: ${n}`);this.handler=t,this.salt=n,this.data=r,this.staticInput=this.transformDataToStruct(r),this.hasOffChainInput=s}get context(){}assertIsValid(){const e=this.isValid();if(!e.isValid)throw new Error(`Invalid order: ${e.reason}`)}get createCalldata(){this.assertIsValid();const e=this.context,t=nn(),n={handler:this.handler,salt:this.salt,staticInput:this.encodeStaticInput()};if(e){const r=e.factoryArgs?a.defaultAbiCoder.encode(e.factoryArgs.argsType,e.factoryArgs.args):"0x";return t.encodeFunctionData("createWithContext",[n,e.address,r,!0])}return t.encodeFunctionData("create",[n,!0])}get removeCalldata(){return this.assertIsValid(),nn().encodeFunctionData("remove",[this.id])}get id(){return a.keccak256(this.serialize())}get ctx(){return this.isSingleOrder?this.id:d.HashZero}get leaf(){return{handler:this.handler,salt:this.salt,staticInput:this.encodeStaticInput()}}static leafToId(e){return a.keccak256(Zt(e))}get offChainInput(){return"0x"}encodeStaticInputHelper(e,t){return a.defaultAbiCoder.encode(e,[t])}poll(e){try{const t=this,{chainId:n,owner:r,provider:a,orderbookApiConfig:s}=e,i=rn(n,a);return Promise.resolve(function(a,o){try{var d=function(){const a=t.isValid();return a.isValid?Promise.resolve(t.pollValidate(e)).then(function(a){return a||Promise.resolve(t.isAuthorized(e)).then(function(a){return a?Promise.resolve(i.getTradeableOrderWithSignature(r,t.leaf,t.offChainInput,[])).then(function([a,i]){let o=an[n];return o||(o=new k({...s,chainId:n}),an[n]=o),Promise.resolve(function(e,t,n){try{return Promise.resolve(import("./index-4d43fb34.js")).then(function({computeOrderUid:r}){return Promise.resolve(se.getDomain(e)).then(function(e){return r(e,n,t)})})}catch(e){return Promise.reject(e)}}(n,r,Qt(a))).then(function(n){return Promise.resolve(o.getOrder(n).then(()=>!0).catch(()=>!1)).then(function(r){let s;function o(e){return s?e:{result:oe.SUCCESS,order:a,signature:i}}const d=function(){if(r)return Promise.resolve(t.handlePollFailedAlreadyPresent(n,a,e)).then(function(e){return e?(s=1,e):(s=1,{result:oe.TRY_NEXT_BLOCK,reason:"Order already in orderbook"})})}();return d&&d.then?d.then(o):o(d)})})}):{result:oe.DONT_TRY_AGAIN,reason:`NotAuthorized: Order ${t.id} is not authorized for ${r} on chain ${n}`}})}):{result:oe.DONT_TRY_AGAIN,reason:`InvalidConditionalOrder. Reason: ${a.reason}`}}()}catch(e){return o(e)}return d&&d.then?d.then(void 0,o):d}(0,function(e){return{result:oe.UNEXPECTED_ERROR,error:e}}))}catch(e){return Promise.reject(e)}}isAuthorized(e){const{chainId:t,owner:n,provider:r}=e;return rn(t,r).callStatic.singleOrders(n,this.id)}cabinet(e){const{chainId:t,owner:n,provider:r}=e;return rn(t,r).callStatic.cabinet(n,this.ctx)}static deserializeHelper(e,t,n,r){try{const{handler:s,salt:i,staticInput:o}=qt(e);if(s!=t)throw new Error("HandlerMismatch");const[d]=a.defaultAbiCoder.decode(n,o);return r(d,i)}catch(e){throw"HandlerMismatch"===e.message?e:new Error("InvalidSerializedConditionalOrder")}}}const on=["address","bytes32","bytes"],dn=["tuple(bytes32[] proof, tuple(address handler, bytes32 salt, bytes staticInput) params)[]"];class cn{constructor(e,t,n,r=ie.PRIVATE){if(this.chain=void 0,this.location=void 0,this.orders={},this.tree=void 0,this.ctx=void 0,this.chain=e,this.location=r,t&&0===Object.keys(t).length)throw new Error("orders must have non-zero length");if(t&&!n||!t&&n)throw new Error("orders cannot have undefined root");for(const e in t)if(t.hasOwnProperty(e)){const n=t[e];if(!cn.orderTypeRegistry.hasOwnProperty(n.orderType))throw new Error(`Unknown order type: ${n.orderType}`)}if(t&&(this.orders=t,this.getOrGenerateTree().root!==n))throw new Error("root mismatch")}static fromJSON(e){const{chain:t,orders:n,root:r,location:a}=JSON.parse(e,(e,t)=>{if("orders"===e&&"object"==typeof t&&null!==t){const e={};for(const n in t)if(t.hasOwnProperty(n)){const{orderType:r,...a}=t[n];if(!cn.orderTypeRegistry.hasOwnProperty(r))throw new Error(`Unknown order type: ${r}`);e[n]=new(0,cn.orderTypeRegistry[r])(a)}return e}return"object"==typeof t&&null!==t&&t.hasOwnProperty("type")&&t.hasOwnProperty("hex")&&"BigNumber"===t.type?o.from(t):t}),s=new cn(t,n,r);return s.location=a,s}toJSON(){const e=this.getOrGenerateTree().root;return JSON.stringify({...this,root:e},(e,t)=>{if("tree"!==e){if("object"==typeof t&&null!==t&&"orderType"in t){const e=t;return{...e,orderType:e.orderType}}return t}})}add(e){e.assertIsValid(),this.orders[e.id]=e,this.reset()}remove(e){delete this.orders[e],this.reset()}update(e,t){const n=t(this.orders[e],this.ctx);delete this.orders[e],this.orders[n.id]=n,this.reset()}getById(e){return this.orders[e]}getByIndex(e){return this.orders[this.orderIds[e]]}get orderIds(){return Object.keys(this.orders)}get root(){return this.getOrGenerateTree().root}getOrGenerateTree(){return this.tree||(this.tree=c.of(Object.values(this.orders).map(e=>[...Object.values(e.leaf)]),on)),this.tree}static decodeFromJSON(e){return JSON.parse(e)}prepareProofStruct(e,t,n){try{const r=this;void 0===e&&(e=r.location);const s=function(){try{switch(e){case ie.PRIVATE:return Promise.resolve("0x");case ie.EMITTED:return Promise.resolve(r.encodeToABI(t));case ie.SWARM:case ie.WAKU:case ie.IPFS:if(!n)throw new Error("Must provide an uploader function");return Promise.resolve(function(e,a){try{var s=Promise.resolve(n(r.encodeToJSON(t)))}catch(e){return a(e)}return s&&s.then?s.then(void 0,a):s}(0,function(t){throw new Error(`Error uploading to decentralized storage ${e}: ${t}`)}));default:throw new Error("Unsupported location")}}catch(e){return Promise.reject(e)}};return Promise.resolve(s().then(t=>{try{return a.hexlify(a.arrayify(t)),r.location=e,{location:e,data:t}}catch(e){throw new Error("data returned by uploader is invalid")}}).catch(e=>{throw new Error(`Error preparing proof struct: ${e}`)}))}catch(e){return Promise.reject(e)}}static poll(e,t,n,r,a){try{function s(n){return Promise.resolve(i.getTradeableOrderWithSignature(e,t.params,n,t.proof))}const i=rn(n,r);return Promise.resolve(a?Promise.resolve(a(e,t.params)).then(s):s("0x"))}catch(o){return Promise.reject(o)}}dumpProofs(e){return this.encodeToJSON(e)}dumpProofsAndParams(e){return this.getProofs(e)}getProofs(e){return[...this.getOrGenerateTree().entries()].map(([t,n])=>e&&e(n)||void 0===e?{idx:t,value:n}:void 0).reduce((e,t)=>{if(t){const n={handler:t.value[0],salt:t.value[1],staticInput:t.value[2]};e.push({proof:this.getOrGenerateTree().getProof(t.idx),params:n})}return e},[])}encodeToABI(e){return a.defaultAbiCoder.encode(dn,[this.getProofs(e)])}encodeToJSON(e){return JSON.stringify(this.getProofs(e))}reset(){this.tree=void 0}static registerOrderType(e,t){cn.orderTypeRegistry[e]=t}static resetOrderTypeRegistry(){cn.orderTypeRegistry={}}}cn.orderTypeRegistry={};class un{constructor(e){this.knownOrderTypes=void 0,this.knownOrderTypes=e}fromParams(e){const{handler:t}=e,n=this.knownOrderTypes[t];if(n)return n(e)}}const ln="0x6cF1e9cA41f7611dEf408122793c358a3d11E5a5",pn="0x52eD56Da04309Aca4c3FECC595298d80C2f16BAc",yn=o.from(2).pow(32).sub(1),fn=o.from(31536e3),mn=["tuple(address sellToken, address buyToken, address receiver, uint256 partSellAmount, uint256 minPartLimit, uint256 t0, uint256 n, uint256 t, uint256 span, bytes32 appData)"];var bn,hn;!function(e){e.AUTO="AUTO",e.LIMIT_DURATION="LIMIT_DURATION"}(bn||(bn={})),function(e){e.AT_MINING_TIME="AT_MINING_TIME",e.AT_EPOCH="AT_EPOCH"}(hn||(hn={}));const Tn={startType:hn.AT_MINING_TIME},En={durationType:bn.AUTO};class An extends sn{constructor(e){const{handler:t,salt:n,data:r,hasOffChainInput:a}=e;if(t!==ln)throw new Error(`InvalidHandler: Expected: ${ln}, provided: ${t}`);super({handler:ln,salt:n,data:r,hasOffChainInput:a}),this.isSingleOrder=!0}static fromData(e,t){return new An({handler:ln,data:e,salt:t})}static fromParams(e){return An.deserialize(Zt(e))}get context(){return this.staticInput.t0.gt(0)?super.context:{address:pn,factoryArgs:void 0}}get orderType(){return"twap"}isValid(){const e=(()=>{const{sellToken:e,sellAmount:t,buyToken:n,buyAmount:r,startTime:a=Tn,numberOfParts:s,timeBetweenParts:i,durationOfPart:o=En}=this.data;if(e==n)return"InvalidSameToken";if(e==d.AddressZero||n==d.AddressZero)return"InvalidToken";if(!t.gt(d.Zero))return"InvalidSellAmount";if(!r.gt(d.Zero))return"InvalidMinBuyAmount";if(a.startType===hn.AT_EPOCH){const e=a.epoch;if(!e.gte(d.Zero)||!e.lt(yn))return"InvalidStartTime"}return s.gt(d.One)&&s.lte(yn)?i.gt(d.Zero)&&i.lte(fn)?o.durationType!==bn.LIMIT_DURATION||o.duration.lte(i)?Xt(mn,[this.staticInput])?void 0:"InvalidData":"InvalidSpan":"InvalidFrequency":"InvalidNumParts"})();return e?{isValid:!1,reason:e}:{isValid:!0}}startTimestamp(e){try{const t=this,{startTime:n}=t.data;return n?.startType===hn.AT_EPOCH?Promise.resolve(n.epoch.toNumber()):Promise.resolve(t.cabinet(e)).then(function(e){const t=a.defaultAbiCoder.decode(["uint256"],e)[0];if(t.gt(yn))throw new Error(`Cabinet epoch out of range: ${t.toString()}`);const n=t.toNumber();if(0===n)throw new Error("Cabinet is not set. Required for TWAP orders that start at mining time.");return n})}catch(e){return Promise.reject(e)}}endTimestamp(e){const{numberOfParts:t,timeBetweenParts:n,durationOfPart:r}=this.data;return r&&r.durationType===bn.LIMIT_DURATION?e+t.sub(1).mul(n).add(r.duration).toNumber():e+t.mul(n).toNumber()}pollValidate(e){try{const t=this;return Promise.resolve(kt(e.provider)).then(function(n){const{blockInfo:r=n}=e,{blockTimestamp:a}=r;return function(n,r){try{var s=Promise.resolve(t.startTimestamp(e)).then(function(e){if(e>a)return{result:oe.TRY_AT_EPOCH,epoch:e,reason:`TWAP hasn't started yet. Starts at ${e} (${Kt(e)})`};const n=t.endTimestamp(e);return a>=n?{result:oe.DONT_TRY_AGAIN,reason:`TWAP has expired. Expired at ${n} (${Kt(n)})`}:void 0})}catch(e){return r(e)}return s&&s.then?s.then(void 0,r):s}(0,function(e){return e?.message?.includes("Cabinet is not set")?{result:oe.DONT_TRY_AGAIN,reason:`${e?.message}. User likely removed the order.`}:e?.message?.includes("Cabinet epoch out of range")?{result:oe.DONT_TRY_AGAIN,reason:`${e?.message}`}:{result:oe.UNEXPECTED_ERROR,reason:`Unexpected error: ${e.message}`,error:e}})})}catch(e){return Promise.reject(e)}}handlePollFailedAlreadyPresent(e,t,n){try{const e=this;return Promise.resolve(kt(n.provider)).then(function(t){const{blockInfo:r=t}=n,{blockTimestamp:a}=r,s=e.data.timeBetweenParts.toNumber(),{numberOfParts:i}=e.data;return Promise.resolve(e.startTimestamp(n)).then(function(e){if(a<e)return{result:oe.UNEXPECTED_ERROR,reason:`TWAP part hash't started. First TWAP part start at ${e} (${Kt(e)})`,error:void 0};const t=i.mul(s).add(e).toNumber();if(a>=t)return{result:oe.UNEXPECTED_ERROR,reason:`TWAP is expired. Expired at ${t} (${Kt(t)})`,error:void 0};const n=Math.floor((a-e)/s);if(n===i.toNumber()-1)return{result:oe.DONT_TRY_AGAIN,reason:`Current active TWAP part (${n+1}/${i}) is already in the Order Book. This was the last TWAP part, no more orders need to be placed`};const r=e+(n+1)*s;return{result:oe.TRY_AT_EPOCH,epoch:r,reason:`Current active TWAP part (${n+1}/${i}) is already in the Order Book. TWAP part ${n+2} doesn't start until ${r} (${Kt(r)})`}})})}catch(e){return Promise.reject(e)}}serialize(){return Zt(this.leaf)}encodeStaticInput(){return super.encodeStaticInputHelper(mn,this.staticInput)}static deserialize(e){return super.deserializeHelper(e,ln,mn,(e,t)=>new An({handler:ln,salt:t,data:vn(e)}))}toString(){const{sellAmount:e,sellToken:t,buyAmount:n,buyToken:r,numberOfParts:a,startTime:s=Tn,timeBetweenParts:i,durationOfPart:o=En,receiver:d,appData:c}=this.data,u=s.startType===hn.AT_MINING_TIME?"AT_MINING_TIME":s.epoch.toNumber(),l=o.durationType===bn.AUTO?"AUTO":o.duration.toNumber(),p={sellAmount:e.toString(),sellToken:t,buyAmount:n.toString(),buyToken:r,numberOfParts:a.toString(),startTime:u,timeBetweenParts:i.toNumber(),durationOfPart:l,receiver:d,appData:c};return`${this.orderType} (${this.id}): ${JSON.stringify(p)}`}transformDataToStruct(e){return In(e)}transformStructToData(e){return vn(e)}}function In(e){const{sellAmount:t,buyAmount:n,numberOfParts:r,startTime:a=Tn,timeBetweenParts:s,durationOfPart:i=En,...o}=e,{partSellAmount:c,minPartLimit:u}=r&&!r.isZero()?{partSellAmount:t.div(r),minPartLimit:n.div(r)}:{partSellAmount:d.Zero,minPartLimit:d.Zero};return{partSellAmount:c,minPartLimit:u,t0:a.startType===hn.AT_MINING_TIME?d.Zero:a.epoch,n:r,t:s,span:i.durationType===bn.AUTO?d.Zero:i.duration,...o}}function vn(e){const{n:t,partSellAmount:n,minPartLimit:r,t:a,t0:s,span:i,...o}=e,d=i.isZero()?{durationType:bn.AUTO}:{durationType:bn.LIMIT_DURATION,duration:i},c=i.isZero()?{startType:hn.AT_MINING_TIME}:{startType:hn.AT_EPOCH,epoch:s};return{sellAmount:n.mul(t),buyAmount:r.mul(t),startTime:c,numberOfParts:t,timeBetweenParts:a,durationOfPart:d,...o}}const gn={[ln]:e=>An.fromParams(e)};export{nt as $,Et as A,me as B,y as C,It as D,B as E,we as F,ft as G,De as H,$e as I,_e as J,Ce as K,lt as L,xe as M,wt as N,he as O,Dt as P,yt as Q,_t as R,Ge as S,it as T,Ct as U,qe as V,Je as W,ze as X,Qe as Y,et as Z,tt as _,je as a,cn as a$,rt as a0,at as a1,ot as a2,dt as a3,Me as a4,Fe as a5,Ye as a6,Ze as a7,Rt as a8,Ut as a9,Z as aA,q as aB,X as aC,K as aD,P as aE,N as aF,D as aG,_ as aH,te as aI,ne as aJ,re as aK,se as aL,ie as aM,oe as aN,kt as aO,Lt as aP,Ht as aQ,Vt as aR,jt as aS,Wt as aT,Yt as aU,Zt as aV,qt as aW,Xt as aX,Kt as aY,Qt as aZ,sn as a_,ke as aa,u as ab,l as ac,p as ad,f as ae,m as af,b as ag,T as ah,E as ai,A as aj,I as ak,g as al,O as am,x as an,R as ao,k as ap,L as aq,M as ar,F as as,G as at,$ as au,H as av,V as aw,j as ax,W as ay,Y as az,Ve as b,un as b0,gn as b1,ln as b2,pn as b3,yn as b4,fn as b5,bn as b6,hn as b7,An as b8,In as b9,vn as ba,v as c,ye as d,pe as e,be as f,st as g,ct as h,Le as i,pt as j,At as k,vt as l,gt as m,Ue as n,Re as o,Te as p,Ee as q,Ae as r,We as s,Ie as t,ve as u,ge as v,Oe as w,Se as x,Pe as y,Ne as z};
//# sourceMappingURL=index-2075fe75.js.map
