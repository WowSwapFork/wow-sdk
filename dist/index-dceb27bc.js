import"cross-fetch/polyfill";import{RateLimiter as e}from"limiter";import{backOff as t}from"exponential-backoff";import{gql as n,request as a}from"graphql-request";import{utils as r,Contract as s,ethers as i,BigNumber as o,constants as d}from"ethers";import{StandardMerkleTree as c}from"@openzeppelin/merkle-tree";var u;!function(e){e[e.MAINNET=1]="MAINNET",e[e.GOERLI=5]="GOERLI",e[e.GNOSIS_CHAIN=100]="GNOSIS_CHAIN",e[e.MUMBAI=80001]="MUMBAI"}(u||(u={}));const l=["prod","staging"],p={env:"prod",chainId:u.MAINNET};class y extends Error{constructor(e,t){super(e),this.error_code=void 0,this.error_code=t}}const f="cow-sdk:",b="https://gnosis.mypinata.cloud/ipfs",m="https://api.pinata.cloud";function h(){return h=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},h.apply(this,arguments)}function T(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)t.indexOf(n=s[a])>=0||(r[n]=e[n]);return r}const{GPv2Settlement:E}=JSON.parse('{\n  "GPv2AllowListAuthentication_Implementation": {\n    "1": {\n      "address": "0x9E7Ae8Bdba9AA346739792d219a808884996Db67",\n      "transactionHash": "0x58340aa44119c74e48635fab0ac344170c6d6e8b42e5714baa4ba4e1651f63ad"\n    },\n    "4": {\n      "address": "0x9E7Ae8Bdba9AA346739792d219a808884996Db67"\n    },\n    "5": {\n      "address": "0x9E7Ae8Bdba9AA346739792d219a808884996Db67",\n      "transactionHash": "0x24f4f80b46a17345011065f9ea2af823f582db56be81098b3b66cc2db9659ea7"\n    },\n    "100": {\n      "address": "0x9E7Ae8Bdba9AA346739792d219a808884996Db67",\n      "transactionHash": "0xe52d425fe34d6d5215ccfc9ddfa485d490b3018f0ee5bbed708f2d172044d60d"\n    },\n    "80001": {\n      "address": "0x02104F2081A552C740f347b5bD97a8F6B8cfb428",\n      "transactionHash": "0x42c5c8c67ac7a27f9ee7404ed3896068835f99f8ec79b9218b713ede8adcaf1f"\n    },\n    "11155111": {\n      "address": "0x9E7Ae8Bdba9AA346739792d219a808884996Db67",\n      "transactionHash": "0xad2b992f7363e5eb8523a7034a7d36a311485f126db9938d4847cc38d2d86b86"\n    }\n  },\n  "GPv2AllowListAuthentication_Proxy": {\n    "1": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0xb84bf720364f94c749f1ec1cdf0d4c44c70411b716459aaccfd24fc677013375"\n    },\n    "4": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0x57b2278fd3a13ab1b132031024475ba1a4e28d7d4d37f556134c84512b742c1f"\n    },\n    "5": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0x39dcf30baf887a5db54551a84de8bfdb6cf418bb284b09680d13aed17d5fa0c1"\n    },\n    "100": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0x1a2d87a05a94bc6680a4faee31bbafbd74e9ddb63dd3941c717b5c609c08b957"\n    },\n    "80001": {\n      "address": "0x952862429B4aA73ea76e4C05Ba730a2BD1747b36",\n      "transactionHash": "0xd42f9d36f7f88ce6c421f3c44d122284a55aeba26bc2b984b1fca22ae7e2ac13"\n    },\n    "11155111": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0x73c54c75b3f382304f3adf33e3876c8999fb10df786d4a902733369251033cd1"\n    }\n  },\n  "GPv2AllowListAuthentication": {\n    "1": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0xb84bf720364f94c749f1ec1cdf0d4c44c70411b716459aaccfd24fc677013375"\n    },\n    "4": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0x57b2278fd3a13ab1b132031024475ba1a4e28d7d4d37f556134c84512b742c1f"\n    },\n    "5": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0x39dcf30baf887a5db54551a84de8bfdb6cf418bb284b09680d13aed17d5fa0c1"\n    },\n    "100": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0x1a2d87a05a94bc6680a4faee31bbafbd74e9ddb63dd3941c717b5c609c08b957"\n    },\n    "80001": {\n      "address": "0x952862429B4aA73ea76e4C05Ba730a2BD1747b36",\n      "transactionHash": "0xd42f9d36f7f88ce6c421f3c44d122284a55aeba26bc2b984b1fca22ae7e2ac13"\n    },\n    "11155111": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0x73c54c75b3f382304f3adf33e3876c8999fb10df786d4a902733369251033cd1"\n    }\n  },\n  "GPv2Settlement": {\n    "1": {\n      "address": "0x9008D19f58AAbD9eD0D60971565AA8510560ab41",\n      "transactionHash": "0xf49f90aa5a268c40001d1227b76bb4dd8247f18361fcad9fffd4a7a44f1320d3"\n    },\n    "4": {\n      "address": "0x9008D19f58AAbD9eD0D60971565AA8510560ab41",\n      "transactionHash": "0x609fa2e8f32c73c1f5dc21ff60a26238dacb50d4674d336c90d6950bdda17a21"\n    },\n    "5": {\n      "address": "0x9008D19f58AAbD9eD0D60971565AA8510560ab41",\n      "transactionHash": "0x982f089060ff66e19d0683ef1cc6a637297331a9ba95b65d8eb84b9f8dc64b04"\n    },\n    "100": {\n      "address": "0x9008D19f58AAbD9eD0D60971565AA8510560ab41",\n      "transactionHash": "0x9ddc538f89cd8433f4a19bc4de0de27e7c68a1d04a14b327185e4bba9af87133"\n    },\n    "80001": {\n      "address": "0xa474e4490B1B56D8a1EDE4e6eE6eF2C5c42db047",\n      "transactionHash": "0x934d1c7e46b074dc01dd2b3cb81710ecad3419555f39ea15fc7f5c53d3a00955"\n    },\n    "11155111": {\n      "address": "0x9008D19f58AAbD9eD0D60971565AA8510560ab41",\n      "transactionHash": "0x6bba22a00ffcff6bca79aced546e18d2a5a4f4e484a4e4dbafab13daf42f718d"\n    }\n  },\n  "GPv2VaultRelayer": {\n    "1": {\n      "address": "0xC92E8bdf79f0507f65a392b0ab4667716BFE0110",\n      "transactionHash": "0xf49f90aa5a268c40001d1227b76bb4dd8247f18361fcad9fffd4a7a44f1320d3"\n    },\n    "4": {\n      "address": "0xC92E8bdf79f0507f65a392b0ab4667716BFE0110",\n      "transactionHash": "0x609fa2e8f32c73c1f5dc21ff60a26238dacb50d4674d336c90d6950bdda17a21"\n    },\n    "5": {\n      "address": "0xC92E8bdf79f0507f65a392b0ab4667716BFE0110",\n      "transactionHash": "0x982f089060ff66e19d0683ef1cc6a637297331a9ba95b65d8eb84b9f8dc64b04"\n    },\n    "100": {\n      "address": "0xC92E8bdf79f0507f65a392b0ab4667716BFE0110",\n      "transactionHash": "0x9ddc538f89cd8433f4a19bc4de0de27e7c68a1d04a14b327185e4bba9af87133"\n    },\n    "80001": {\n      "address": "0x46b1a51A9166DA07db57c98B15358DE5FFfcbb97",\n      "transactionHash": "0x934d1c7e46b074dc01dd2b3cb81710ecad3419555f39ea15fc7f5c53d3a00955"\n    },\n    "11155111": {\n      "address": "0xC92E8bdf79f0507f65a392b0ab4667716BFE0110",\n      "transactionHash": "0x6bba22a00ffcff6bca79aced546e18d2a5a4f4e484a4e4dbafab13daf42f718d"\n    }\n  },\n  "GPv2TradeSimulator": {\n    "80001": {\n      "address": "0x9E88a6B1Ba0fA9c5BC9bE09a17EE982aB12DcB60",\n      "transactionHash": "0x946345cf7cda53fc88627877cacbdd94bef4f0cacc798019578e03c0e075b781"\n    }\n  }\n}'),A="0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE",I="0x2f55e8b20D0B9FEFA187AA7d00B6Cbe563605bF5",g="0x5d84eB96e4D57fB2a7945f32be7401237eD243ad",O=[u.MAINNET,u.GOERLI,u.GNOSIS_CHAIN,u.MUMBAI],v=O.reduce((e,t)=>h({},e,{[t]:E[t].address}),{}),S=O.reduce((e,t)=>h({},e,{[t]:I}),{}),w=O.reduce((e,t)=>h({},e,{[t]:g}),{});function N(e){return function(e){const{ethflowData:t}=e;if(!t)return e;const{userValidTo:n}=t;return h({},e,{validTo:n,owner:e.onchainUser||e.owner,sellToken:A})}(function(e){const{executedFeeAmount:t,executedSurplusFee:n}=e;return h({},e,{totalFee:null!=n?n:t})}(e))}class D extends Error{constructor(e,t){super("string"==typeof t?t:e.statusText),this.response=void 0,this.body=void 0,this.response=e,this.body=t}}const _=[408,425,429,500,502,503,504],P={numOfAttempts:10,maxDelay:Infinity,jitter:"none",retry:e=>!(e instanceof D)||_.includes(e.response.status)},x={tokensPerInterval:5,interval:"second"},C=async e=>{if(204!==e.status)try{const t=e.headers.get("Content-Type");if(t)return t.toLowerCase().startsWith("application/json")?await e.json():await e.text()}catch(e){console.error(e)}};async function R(e,{path:n,query:a,method:r,body:s},i,o){const d=`${e}${n}${a?"?"+a:""}`,c={method:r,body:(()=>{if(s)return"string"==typeof s?s:JSON.stringify(s)})(),headers:{Accept:"application/json","Content-Type":"application/json"}};return t(async()=>{await i.removeTokens(1);const e=await fetch(d,c),t=await C(e);return e.status>=200&&e.status<300?t:Promise.reject(new D(e,t))},o)}const U={[u.MAINNET]:"https://api.cow.fi/mainnet",[u.GNOSIS_CHAIN]:"https://api.cow.fi/xdai",[u.GOERLI]:"https://api.cow.fi/goerli",[u.MUMBAI]:"http://localhost:8080"},k={[u.MAINNET]:"https://barn.api.cow.fi/mainnet",[u.GNOSIS_CHAIN]:"https://barn.api.cow.fi/xdai",[u.GOERLI]:"https://barn.api.cow.fi/goerli",[u.MUMBAI]:"http://localhost:8080"};function L(e){return Object.keys(e).reduce((t,n)=>{const a=e[n];return void 0!==a&&(t[n]=a),t},{})}class B{constructor(t={}){this.context=void 0,this.rateLimiter=void 0,this.context=h({},p,t),this.rateLimiter=new e(t.limiterOpts||x)}getVersion(e={}){return this.fetch({path:"/api/v1/version",method:"GET"},e)}getTrades(e,t={}){if(e.owner&&e.orderUid)return Promise.reject(new y("Cannot specify both owner and orderId"));if(!e.owner&&!e.orderUid)return Promise.reject(new y("Must specify either owner or orderId"));const n=new URLSearchParams(L(e));return this.fetch({path:"/api/v1/trades",method:"GET",query:n},t)}getOrders({owner:e,offset:t=0,limit:n=1e3},a={}){const r=new URLSearchParams(L({offset:t.toString(),limit:n.toString()}));return this.fetch({path:`/api/v1/account/${e}/orders`,method:"GET",query:r},a).then(e=>e.map(N))}getTxOrders(e,t={}){return this.fetch({path:`/api/v1/transactions/${e}/orders`,method:"GET"},t).then(e=>e.map(N))}getOrder(e,t={}){return this.fetch({path:`/api/v1/orders/${e}`,method:"GET"},t).then(e=>N(e))}getOrderMultiEnv(e,t={}){const{env:n}=this.getContextWithOverride(t),a=l.filter(e=>e!==n);let r=0;const s=n=>{const i=a[r];return n instanceof D&&404===n.response.status&&i?(r++,this.getOrder(e,h({},t,{env:i})).catch(s)):Promise.reject(n)};return this.getOrder(e,h({},t,{env:n})).catch(s)}getQuote(e,t={}){return this.fetch({path:"/api/v1/quote",method:"POST",body:e},t)}sendSignedOrderCancellations(e,t={}){return this.fetch({path:"/api/v1/orders",method:"DELETE",body:e},t)}sendOrder(e,t={}){return this.fetch({path:"/api/v1/orders",method:"POST",body:e},t)}getNativePrice(e,t={}){return this.fetch({path:`/api/v1/token/${e}/native_price`,method:"GET"},t)}getTotalSurplus(e,t={}){return this.fetch({path:`/api/v1/users/${e}/total_surplus`,method:"GET"},t)}getAppData(e,t={}){return this.fetch({path:`/api/v1/app_data/${e}`,method:"GET"},t)}uploadAppData(e,t,n={}){return this.fetch({path:`/api/v1/app_data/${e}`,method:"PUT",body:{fullAppData:t}},n)}getSolverCompetition(e,t={}){return this.fetch({path:`/api/v1/solver_competition${"string"==typeof e?"/by_tx_hash":""}/${e}`,method:"GET"},t)}getOrderLink(e,t){const{chainId:n,env:a}=this.getContextWithOverride(t);return this.getApiBaseUrls(a)[n]+`/api/v1/orders/${e}`}getContextWithOverride(e={}){return h({},this.context,e)}getApiBaseUrls(e){return this.context.baseUrls?this.context.baseUrls:"prod"===e?U:k}fetch(e,t={}){const{chainId:n,env:a}=this.getContextWithOverride(t);return R(this.getApiBaseUrls(a)[n],e,this.rateLimiter,this.context.backoffOpts||P)}}var M,F,G,$,H,V,W,j,Y,Z,q,X,K,J,z;!function(e){e.ERC20="erc20",e.INTERNAL="internal"}(M||(M={})),function(e){e.EIP712="eip712",e.ETHSIGN="ethsign"}(F||(F={})),function(e){var t;(t=e.placementError||(e.placementError={})).QUOTE_NOT_FOUND="QuoteNotFound",t.VALID_TO_TOO_FAR_IN_FUTURE="ValidToTooFarInFuture",t.PRE_VALIDATION_ERROR="PreValidationError"}(G||(G={})),function(e){var t;(t=e.errorType||(e.errorType={})).INVALID_SIGNATURE="InvalidSignature",t.WRONG_OWNER="WrongOwner",t.ORDER_NOT_FOUND="OrderNotFound",t.ALREADY_CANCELLED="AlreadyCancelled",t.ORDER_FULLY_EXECUTED="OrderFullyExecuted",t.ORDER_EXPIRED="OrderExpired",t.ON_CHAIN_ORDER="OnChainOrder"}($||($={})),function(e){e.MARKET="market",e.LIMIT="limit",e.LIQUIDITY="liquidity"}(H||(H={})),function(e){e.BUY="buy",e.SELL="sell"}(V||(V={})),function(e){var t;(t=e.errorType||(e.errorType={})).DUPLICATED_ORDER="DuplicatedOrder",t.QUOTE_NOT_FOUND="QuoteNotFound",t.INVALID_QUOTE="InvalidQuote",t.MISSING_FROM="MissingFrom",t.WRONG_OWNER="WrongOwner",t.INVALID_EIP1271SIGNATURE="InvalidEip1271Signature",t.INSUFFICIENT_BALANCE="InsufficientBalance",t.INSUFFICIENT_ALLOWANCE="InsufficientAllowance",t.INVALID_SIGNATURE="InvalidSignature",t.INSUFFICIENT_FEE="InsufficientFee",t.SELL_AMOUNT_OVERFLOW="SellAmountOverflow",t.TRANSFER_SIMULATION_FAILED="TransferSimulationFailed",t.ZERO_AMOUNT="ZeroAmount",t.INCOMPATIBLE_SIGNING_SCHEME="IncompatibleSigningScheme",t.TOO_MANY_LIMIT_ORDERS_UNSUPPORTED_BUY_TOKEN_DESTINATION="TooManyLimitOrders UnsupportedBuyTokenDestination",t.UNSUPPORTED_SELL_TOKEN_SOURCE="UnsupportedSellTokenSource",t.UNSUPPORTED_ORDER_TYPE="UnsupportedOrderType",t.INSUFFICIENT_VALID_TO="InsufficientValidTo",t.EXCESSIVE_VALID_TO="ExcessiveValidTo",t.TRANSFER_ETH_TO_CONTRACT="TransferEthToContract",t.INVALID_NATIVE_SELL_TOKEN_SAME_BUY_AND_SELL_TOKEN="InvalidNativeSellToken SameBuyAndSellToken",t.UNSUPPORTED_SIGNATURE="UnsupportedSignature",t.UNSUPPORTED_TOKEN="UnsupportedToken",t.UNSUPPORTED_CUSTOM_INTERACTION_INVALID_APP_DATA="UnsupportedCustomInteraction InvalidAppData",t.APP_DATA_HASH_MISMATCH="AppDataHashMismatch"}(W||(W={})),function(e){e.BUY="buy"}(j||(j={})),function(e){e.SELL="sell"}(Y||(Y={})),function(e){e.PRESIGNATURE_PENDING="presignaturePending",e.OPEN="open",e.FULFILLED="fulfilled",e.CANCELLED="cancelled",e.EXPIRED="expired"}(Z||(Z={})),function(e){var t;(t=e.errorType||(e.errorType={})).UNSUPPORTED_TOKEN="UnsupportedToken",t.ZERO_AMOUNT="ZeroAmount",t.UNSUPPORTED_ORDER_TYPE="UnsupportedOrderType"}(q||(q={})),function(e){e.FAST="fast",e.OPTIMAL="optimal",e.VERIFIED="verified"}(X||(X={})),function(e){var t;(t=e.errorType||(e.errorType={})).ALREADY_CANCELLED="AlreadyCancelled",t.ORDER_FULLY_EXECUTED="OrderFullyExecuted",t.ORDER_EXPIRED="OrderExpired",t.ON_CHAIN_ORDER="OnChainOrder",t.DUPLICATED_ORDER="DuplicatedOrder",t.INSUFFICIENT_FEE="InsufficientFee",t.INSUFFICIENT_ALLOWANCE="InsufficientAllowance",t.INSUFFICIENT_BALANCE="InsufficientBalance",t.INSUFFICIENT_VALID_TO="InsufficientValidTo",t.EXCESSIVE_VALID_TO="ExcessiveValidTo",t.INVALID_SIGNATURE="InvalidSignature",t.TRANSFER_ETH_TO_CONTRACT="TransferEthToContract",t.TRANSFER_SIMULATION_FAILED="TransferSimulationFailed",t.UNSUPPORTED_TOKEN="UnsupportedToken",t.WRONG_OWNER="WrongOwner",t.SAME_BUY_AND_SELL_TOKEN="SameBuyAndSellToken",t.ZERO_AMOUNT="ZeroAmount",t.UNSUPPORTED_BUY_TOKEN_DESTINATION="UnsupportedBuyTokenDestination",t.UNSUPPORTED_SELL_TOKEN_SOURCE="UnsupportedSellTokenSource",t.UNSUPPORTED_ORDER_TYPE="UnsupportedOrderType",t.UNSUPPORTED_SIGNATURE="UnsupportedSignature"}(K||(K={})),function(e){e.ERC20="erc20",e.INTERNAL="internal",e.EXTERNAL="external"}(J||(J={})),function(e){e.EIP712="eip712",e.ETHSIGN="ethsign",e.PRESIGN="presign",e.EIP1271="eip1271"}(z||(z={}));let Q,ee,te,ne=e=>e;const ae=n(Q||(Q=ne`
  query Totals {
    totals {
      tokens
      orders
      traders
      settlements
      volumeUsd
      volumeEth
      feesUsd
      feesEth
    }
  }
`)),re=n(ee||(ee=ne`
  query LastDaysVolume($days: Int!) {
    dailyTotals(orderBy: timestamp, orderDirection: desc, first: $days) {
      timestamp
      volumeUsd
    }
  }
`)),se=n(te||(te=ne`
  query LastHoursVolume($hours: Int!) {
    hourlyTotals(orderBy: timestamp, orderDirection: desc, first: $hours) {
      timestamp
      volumeUsd
    }
  }
`)),ie="https://api.thegraph.com/subgraphs/name/cowprotocol",oe={[u.MAINNET]:ie+"/cow",[u.GNOSIS_CHAIN]:ie+"/cow-gc",[u.GOERLI]:ie+"/cow-goerli",[u.MUMBAI]:"https://thegraph.com/hosted-service/subgraph/shahzeb8285/wowswapfork"},de={[u.MAINNET]:ie+"/cow-staging",[u.GNOSIS_CHAIN]:ie+"/cow-gc-staging",[u.GOERLI]:"",[u.MUMBAI]:"https://thegraph.com/hosted-service/subgraph/shahzeb8285/wowswapfork"};class ce{constructor(e={}){this.API_NAME="CoW Protocol Subgraph",this.context=void 0,this.context=h({},p,e)}async getTotals(e={}){return(await this.runQuery(ae,void 0,e)).totals[0]}async getLastDaysVolume(e,t={}){return this.runQuery(re,{days:e},t)}async getLastHoursVolume(e,t={}){return this.runQuery(se,{hours:e},t)}async runQuery(e,t=undefined,n={}){const{chainId:r,env:s}=this.getContextWithOverride(n),i=this.getEnvConfigs(s)[r];try{return await a(i,e,t)}catch(n){throw console.error(`[subgraph:${this.API_NAME}]`,n),new y(`Error running query: ${e}. Variables: ${JSON.stringify(t)}. API: ${i}. Inner Error: ${n}`)}}getContextWithOverride(e={}){return h({},this.context,e)}getEnvConfigs(e){return this.context.baseUrls?this.context.baseUrls:"prod"===e?oe:de}}const ue=()=>import("./utils-00aa6acb.js");class le{static async signOrder(e,t,n){const{signOrder:a}=await ue();return a(e,t,n)}static async signOrderCancellation(e,t,n){const{signOrderCancellation:a}=await ue();return a(e,t,n)}static async signOrderCancellations(e,t,n){const{signOrderCancellations:a}=await ue();return a(e,t,n)}static async getDomain(e){const{getDomain:t}=await ue();return t(e)}static async getDomainSeparator(e){const{getDomain:t}=await ue(),{_TypedDataEncoder:n}=await import("ethers/lib/utils");return n.hashDomain(t(e))}static getEIP712Types(){return{Order:[{name:"sellToken",type:"address"},{name:"buyToken",type:"address"},{name:"receiver",type:"address"},{name:"sellAmount",type:"uint256"},{name:"buyAmount",type:"uint256"},{name:"validTo",type:"uint32"},{name:"appData",type:"bytes32"},{name:"feeAmount",type:"uint256"},{name:"kind",type:"string"},{name:"partiallyFillable",type:"bool"},{name:"sellTokenBalance",type:"string"},{name:"buyTokenBalance",type:"string"}]}}}var pe,ye;!function(e){e[e.PRIVATE=0]="PRIVATE",e[e.EMITTED=1]="EMITTED",e[e.SWARM=2]="SWARM",e[e.WAKU=3]="WAKU",e[e.RESERVED=4]="RESERVED",e[e.IPFS=5]="IPFS"}(pe||(pe={})),function(e){e.SUCCESS="SUCCESS",e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.TRY_NEXT_BLOCK="TRY_NEXT_BLOCK",e.TRY_ON_BLOCK="TRY_ON_BLOCK",e.TRY_AT_EPOCH="TRY_AT_EPOCH",e.DONT_TRY_AGAIN="DONT_TRY_AGAIN"}(ye||(ye={}));const fe=[{inputs:[{internalType:"address",name:"_settlement",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"InterfaceNotSupported",type:"error"},{inputs:[],name:"InvalidHandler",type:"error"},{inputs:[],name:"ProofNotAuthed",type:"error"},{inputs:[],name:"SingleOrderNotAuthed",type:"error"},{inputs:[],name:"SwapGuardRestricted",type:"error"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{components:[{internalType:"contract IConditionalOrder",name:"handler",type:"address"},{internalType:"bytes32",name:"salt",type:"bytes32"},{internalType:"bytes",name:"staticInput",type:"bytes"}],indexed:!1,internalType:"struct IConditionalOrder.ConditionalOrderParams",name:"params",type:"tuple"}],name:"ConditionalOrderCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!1,internalType:"bytes32",name:"root",type:"bytes32"},{components:[{internalType:"uint256",name:"location",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],indexed:!1,internalType:"struct ComposableCoW.Proof",name:"proof",type:"tuple"}],name:"MerkleRootSet",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!1,internalType:"contract ISwapGuard",name:"swapGuard",type:"address"}],name:"SwapGuardSet",type:"event"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"bytes32",name:"",type:"bytes32"}],name:"cabinet",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"contract IConditionalOrder",name:"handler",type:"address"},{internalType:"bytes32",name:"salt",type:"bytes32"},{internalType:"bytes",name:"staticInput",type:"bytes"}],internalType:"struct IConditionalOrder.ConditionalOrderParams",name:"params",type:"tuple"},{internalType:"bool",name:"dispatch",type:"bool"}],name:"create",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"contract IConditionalOrder",name:"handler",type:"address"},{internalType:"bytes32",name:"salt",type:"bytes32"},{internalType:"bytes",name:"staticInput",type:"bytes"}],internalType:"struct IConditionalOrder.ConditionalOrderParams",name:"params",type:"tuple"},{internalType:"contract IValueFactory",name:"factory",type:"address"},{internalType:"bytes",name:"data",type:"bytes"},{internalType:"bool",name:"dispatch",type:"bool"}],name:"createWithContext",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"domainSeparator",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{components:[{internalType:"contract IConditionalOrder",name:"handler",type:"address"},{internalType:"bytes32",name:"salt",type:"bytes32"},{internalType:"bytes",name:"staticInput",type:"bytes"}],internalType:"struct IConditionalOrder.ConditionalOrderParams",name:"params",type:"tuple"},{internalType:"bytes",name:"offchainInput",type:"bytes"},{internalType:"bytes32[]",name:"proof",type:"bytes32[]"}],name:"getTradeableOrderWithSignature",outputs:[{components:[{internalType:"contract IERC20",name:"sellToken",type:"address"},{internalType:"contract IERC20",name:"buyToken",type:"address"},{internalType:"address",name:"receiver",type:"address"},{internalType:"uint256",name:"sellAmount",type:"uint256"},{internalType:"uint256",name:"buyAmount",type:"uint256"},{internalType:"uint32",name:"validTo",type:"uint32"},{internalType:"bytes32",name:"appData",type:"bytes32"},{internalType:"uint256",name:"feeAmount",type:"uint256"},{internalType:"bytes32",name:"kind",type:"bytes32"},{internalType:"bool",name:"partiallyFillable",type:"bool"},{internalType:"bytes32",name:"sellTokenBalance",type:"bytes32"},{internalType:"bytes32",name:"buyTokenBalance",type:"bytes32"}],internalType:"struct GPv2Order.Data",name:"order",type:"tuple"},{internalType:"bytes",name:"signature",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"contract IConditionalOrder",name:"handler",type:"address"},{internalType:"bytes32",name:"salt",type:"bytes32"},{internalType:"bytes",name:"staticInput",type:"bytes"}],internalType:"struct IConditionalOrder.ConditionalOrderParams",name:"params",type:"tuple"}],name:"hash",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"contract Safe",name:"safe",type:"address"},{internalType:"address",name:"sender",type:"address"},{internalType:"bytes32",name:"_hash",type:"bytes32"},{internalType:"bytes32",name:"_domainSeparator",type:"bytes32"},{internalType:"bytes32",name:"",type:"bytes32"},{internalType:"bytes",name:"encodeData",type:"bytes"},{internalType:"bytes",name:"payload",type:"bytes"}],name:"isValidSafeSignature",outputs:[{internalType:"bytes4",name:"magic",type:"bytes4"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"singleOrderHash",type:"bytes32"}],name:"remove",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"roots",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"root",type:"bytes32"},{components:[{internalType:"uint256",name:"location",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],internalType:"struct ComposableCoW.Proof",name:"proof",type:"tuple"}],name:"setRoot",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"root",type:"bytes32"},{components:[{internalType:"uint256",name:"location",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],internalType:"struct ComposableCoW.Proof",name:"proof",type:"tuple"},{internalType:"contract IValueFactory",name:"factory",type:"address"},{internalType:"bytes",name:"data",type:"bytes"}],name:"setRootWithContext",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"contract ISwapGuard",name:"swapGuard",type:"address"}],name:"setSwapGuard",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"bytes32",name:"",type:"bytes32"}],name:"singleOrders",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"swapGuards",outputs:[{internalType:"contract ISwapGuard",name:"",type:"address"}],stateMutability:"view",type:"function"}];class be{static createInterface(){return new r.Interface(fe)}static connect(e,t){return new s(e,fe,t)}}be.abi=fe;const me=[{anonymous:!1,inputs:[{indexed:!0,internalType:"contract Safe",name:"safe",type:"address"},{indexed:!1,internalType:"bytes32",name:"domainSeparator",type:"bytes32"},{indexed:!1,internalType:"contract ISafeSignatureVerifier",name:"verifier",type:"address"}],name:"AddedDomainVerifier",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"contract Safe",name:"safe",type:"address"},{indexed:!1,internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"AddedInterface",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"contract Safe",name:"safe",type:"address"},{indexed:!1,internalType:"bytes4",name:"selector",type:"bytes4"},{indexed:!1,internalType:"bytes32",name:"method",type:"bytes32"}],name:"AddedSafeMethod",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"contract Safe",name:"safe",type:"address"},{indexed:!1,internalType:"bytes32",name:"domainSeparator",type:"bytes32"},{indexed:!1,internalType:"contract ISafeSignatureVerifier",name:"oldVerifier",type:"address"},{indexed:!1,internalType:"contract ISafeSignatureVerifier",name:"newVerifier",type:"address"}],name:"ChangedDomainVerifier",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"contract Safe",name:"safe",type:"address"},{indexed:!1,internalType:"bytes4",name:"selector",type:"bytes4"},{indexed:!1,internalType:"bytes32",name:"oldMethod",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"newMethod",type:"bytes32"}],name:"ChangedSafeMethod",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"contract Safe",name:"safe",type:"address"},{indexed:!1,internalType:"bytes32",name:"domainSeparator",type:"bytes32"}],name:"RemovedDomainVerifier",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"contract Safe",name:"safe",type:"address"},{indexed:!1,internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"RemovedInterface",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"contract Safe",name:"safe",type:"address"},{indexed:!1,internalType:"bytes4",name:"selector",type:"bytes4"}],name:"RemovedSafeMethod",type:"event"},{stateMutability:"nonpayable",type:"fallback"},{inputs:[{internalType:"contract Safe",name:"",type:"address"},{internalType:"bytes32",name:"",type:"bytes32"}],name:"domainVerifiers",outputs:[{internalType:"contract ISafeSignatureVerifier",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"_hash",type:"bytes32"},{internalType:"bytes",name:"signature",type:"bytes"}],name:"isValidSignature",outputs:[{internalType:"bytes4",name:"magic",type:"bytes4"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"address",name:"",type:"address"},{internalType:"uint256[]",name:"",type:"uint256[]"},{internalType:"uint256[]",name:"",type:"uint256[]"},{internalType:"bytes",name:"",type:"bytes"}],name:"onERC1155BatchReceived",outputs:[{internalType:"bytes4",name:"",type:"bytes4"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"address",name:"",type:"address"},{internalType:"uint256",name:"",type:"uint256"},{internalType:"uint256",name:"",type:"uint256"},{internalType:"bytes",name:"",type:"bytes"}],name:"onERC1155Received",outputs:[{internalType:"bytes4",name:"",type:"bytes4"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"address",name:"",type:"address"},{internalType:"uint256",name:"",type:"uint256"},{internalType:"bytes",name:"",type:"bytes"}],name:"onERC721Received",outputs:[{internalType:"bytes4",name:"",type:"bytes4"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"contract Safe",name:"",type:"address"},{internalType:"bytes4",name:"",type:"bytes4"}],name:"safeInterfaces",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"contract Safe",name:"",type:"address"},{internalType:"bytes4",name:"",type:"bytes4"}],name:"safeMethods",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"domainSeparator",type:"bytes32"},{internalType:"contract ISafeSignatureVerifier",name:"newVerifier",type:"address"}],name:"setDomainVerifier",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"selector",type:"bytes4"},{internalType:"bytes32",name:"newMethod",type:"bytes32"}],name:"setSafeMethod",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"},{internalType:"bool",name:"supported",type:"bool"}],name:"setSupportedInterface",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"_interfaceId",type:"bytes4"},{internalType:"bytes32[]",name:"handlerWithSelectors",type:"bytes32[]"}],name:"setSupportedInterfaceBatch",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"}];class he{static createInterface(){return new r.Interface(me)}static connect(e,t){return new s(e,me,t)}}he.abi=me;var Te="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Ee(e){var t={exports:{}};return e(t,t.exports),t.exports}var Ae=Ee(function(e,t){var n=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n)return n;throw new Error("unable to locate global object")}();e.exports=t=n.fetch,n.fetch&&(t.default=n.fetch.bind(n)),t.Headers=n.Headers,t.Request=n.Request,t.Response=n.Response});const Ie="0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE";var ge,Oe;!function(e){e.SELL="sell",e.BUY="buy"}(ge||(ge={})),function(e){e.ERC20="erc20",e.EXTERNAL="external",e.INTERNAL="internal"}(Oe||(Oe={}));const ve=[{name:"sellToken",type:"address"},{name:"buyToken",type:"address"},{name:"receiver",type:"address"},{name:"sellAmount",type:"uint256"},{name:"buyAmount",type:"uint256"},{name:"validTo",type:"uint32"},{name:"appData",type:"bytes32"},{name:"feeAmount",type:"uint256"},{name:"kind",type:"string"},{name:"partiallyFillable",type:"bool"},{name:"sellTokenBalance",type:"string"},{name:"buyTokenBalance",type:"string"}],Se=[{name:"orderUids",type:"bytes[]"}],we=i.utils.id(`Order(${ve.map(({name:e,type:t})=>`${t} ${e}`).join(",")})`);function Ne(e){return"number"==typeof e?e:~~(e.getTime()/1e3)}function De(e){return"number"==typeof e?`0x${e.toString(16).padStart(64,"0")}`:i.utils.hexZeroPad(e,32)}function _e(e){switch(e){case void 0:case Oe.ERC20:case Oe.EXTERNAL:return Oe.ERC20;case Oe.INTERNAL:return Oe.INTERNAL;default:throw new Error(`invalid order balance ${e}`)}}function Pe(e){var t,n;if(e.receiver===i.constants.AddressZero)throw new Error("receiver cannot be address(0)");return Object.assign(Object.assign({},e),{sellTokenBalance:null!==(t=e.sellTokenBalance)&&void 0!==t?t:Oe.ERC20,receiver:null!==(n=e.receiver)&&void 0!==n?n:i.constants.AddressZero,validTo:Ne(e.validTo),appData:De(e.appData),buyTokenBalance:_e(e.buyTokenBalance)})}function xe(e,t,n){return i.utils._TypedDataEncoder.hash(e,t,n)}function Ce(e,t){return xe(e,{Order:ve},Pe(t))}function Re(e,t){return Ue(e,[t])}function Ue(e,t){return xe(e,{OrderCancellations:Se},{orderUids:t})}const ke=56;function Le(e,t,n){return Be({orderDigest:Ce(e,t),owner:n,validTo:t.validTo})}function Be({orderDigest:e,owner:t,validTo:n}){return i.utils.solidityPack(["bytes32","address","uint32"],[e,t,Ne(n)])}function Me(e){const t=i.utils.arrayify(e);if(t.length!=ke)throw new Error("invalid order UID length");const n=new DataView(t.buffer);return{orderDigest:i.utils.hexlify(t.subarray(0,32)),owner:i.utils.getAddress(i.utils.hexlify(t.subarray(32,52))),validTo:n.getUint32(52)}}function Fe(e){return Object.assign({value:0,callData:"0x"},e)}function Ge(e){return e.map(Fe)}function $e(e){return"_signTypedData"in e}function He(e){return"send"in e}var Ve=function(e,t,n,a){return new(n||(n=Promise))(function(r,s){function i(e){try{d(a.next(e))}catch(e){s(e)}}function o(e){try{d(a.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,o)}d((a=a.apply(e,t||[])).next())})};const We=i.utils.hexDataSlice(i.utils.id("isValidSignature(bytes32,bytes)"),0,4),je=i.utils.id("GPv2Signing.Scheme.PreSign");var Ye,Ze;function qe(e,t,n,a,r){return Ve(this,void 0,void 0,function*(){let s=null;switch(e){case Ye.EIP712:if(!$e(t))throw new Error("signer does not support signing typed data");s=yield t._signTypedData(n,a,r);break;case Ye.ETHSIGN:s=yield t.signMessage(i.utils.arrayify(xe(n,a,r)));break;default:throw new Error("invalid signing scheme")}return i.utils.joinSignature(i.utils.splitSignature(s))})}function Xe(e,t,n,a){return Ve(this,void 0,void 0,function*(){return{scheme:a,data:yield qe(a,n,e,{Order:ve},Pe(t))}})}function Ke(e,t,n,a){return Ve(this,void 0,void 0,function*(){return Je(e,[t],n,a)})}function Je(e,t,n,a){return Ve(this,void 0,void 0,function*(){return{scheme:a,data:yield qe(a,n,e,{OrderCancellations:Se},{orderUids:t})}})}function ze({verifier:e,signature:t}){return i.utils.solidityPack(["address","bytes"],[e,t])}function Qe(e){const t=i.utils.arrayify(e);return{verifier:i.utils.getAddress(i.utils.hexlify(t.slice(0,20))),signature:t.slice(20)}}!function(e){e[e.EIP712=0]="EIP712",e[e.ETHSIGN=1]="ETHSIGN",e[e.EIP1271=2]="EIP1271",e[e.PRESIGN=3]="PRESIGN"}(Ye||(Ye={})),function(e){e[e.PRE=0]="PRE",e[e.INTRA=1]="INTRA",e[e.POST=2]="POST"}(Ze||(Ze={}));const et={kind:{offset:0,options:[ge.SELL,ge.BUY]},partiallyFillable:{offset:1,options:[!1,!0]},sellTokenBalance:{offset:2,options:[Oe.ERC20,void 0,Oe.EXTERNAL,Oe.INTERNAL]},buyTokenBalance:{offset:4,options:[Oe.ERC20,Oe.INTERNAL]},signingScheme:{offset:5,options:[Ye.EIP712,Ye.ETHSIGN,Ye.EIP1271,Ye.PRESIGN]}};function tt(e,t){const n=et[e].options.findIndex(e=>e===t);if(void 0===n)throw new Error(`Bad key/value pair to encode: ${e}/${t}`);return n<<et[e].offset}function nt(e,t){const{offset:n,options:a}=et[e],r=o.from(t).toNumber(),s=r>>n&function(e){return(1<<32-Math.clz32(e.length-1))-1}(a),i=a[s];if(void 0===i||s<0)throw new Error(`Invalid input flag for ${e}: 0b${r.toString(2)}`);return i}function at(e){return tt("signingScheme",e)}function rt(e){return nt("signingScheme",e)}function st(e){var t;return tt("kind",e.kind)|tt("partiallyFillable",e.partiallyFillable)|tt("sellTokenBalance",null!==(t=e.sellTokenBalance)&&void 0!==t?t:Oe.ERC20)|tt("buyTokenBalance",_e(e.buyTokenBalance))}function it(e){return{kind:nt("kind",e),partiallyFillable:nt("partiallyFillable",e),sellTokenBalance:nt("sellTokenBalance",e),buyTokenBalance:nt("buyTokenBalance",e)}}function ot(e){return st(e)|at(e.signingScheme)}function dt(e){return Object.assign(Object.assign({},it(e)),{signingScheme:rt(e)})}function ct(e){switch(e.scheme){case Ye.EIP712:case Ye.ETHSIGN:return i.utils.joinSignature(e.data);case Ye.EIP1271:return ze(e.data);case Ye.PRESIGN:return i.utils.getAddress(e.data);default:throw new Error("unsupported signing scheme")}}function ut(e,t,n,a){switch(n){case Ye.EIP712:return i.utils.verifyTypedData(e,{Order:ve},Pe(t),a);case Ye.ETHSIGN:return i.utils.verifyMessage(i.utils.arrayify(xe(e,{Order:ve},Pe(t))),a);case Ye.EIP1271:return Qe(a).verifier;case Ye.PRESIGN:return i.utils.getAddress(i.utils.hexlify(a));default:throw new Error("unsupported signing scheme")}}function lt(e,t,n,{executedAmount:a}){const r=Object.assign(Object.assign({},t),{signingScheme:n.scheme}),s=Pe(t);return{sellTokenIndex:e.index(s.sellToken),buyTokenIndex:e.index(s.buyToken),receiver:s.receiver,sellAmount:s.sellAmount,buyAmount:s.buyAmount,validTo:s.validTo,appData:s.appData,feeAmount:s.feeAmount,flags:ot(r),executedAmount:a,signature:ct(n)}}class pt{constructor(){this._tokens=[],this._tokenMap={}}get addresses(){return this._tokens.slice()}index(e){const t=i.utils.getAddress(e);let n=this._tokenMap[t];return void 0===n&&(n=this._tokens.length,this._tokens.push(t),this._tokenMap[t]=n),n}}class yt{constructor(e){this.domain=e,this._tokens=new pt,this._trades=[],this._interactions={[Ze.PRE]:[],[Ze.INTRA]:[],[Ze.POST]:[]},this._orderRefunds={filledAmounts:[],preSignatures:[]}}get tokens(){return this._tokens.addresses}get trades(){return this._trades.slice()}get interactions(){return[this._interactions[Ze.PRE].slice(),this._interactions[Ze.INTRA].slice(),[...this._interactions[Ze.POST],...this.encodedOrderRefunds]]}get encodedOrderRefunds(){const{filledAmounts:e,preSignatures:t}=this._orderRefunds;if(e.length+t.length===0)return[];const n=this.domain.verifyingContract;if(void 0===n)throw new Error("domain missing settlement contract address");const a=new i.utils.Interface(["function freeFilledAmountStorage(bytes[] orderUids)","function freePreSignatureStorage(bytes[] orderUids)"]),r=[];for(const[s,i]of[["freeFilledAmountStorage",e],["freePreSignatureStorage",t]].filter(([,e])=>e.length>0))r.push(Fe({target:n,callData:a.encodeFunctionData(s,[i])}));return r}clearingPrices(e){return this.tokens.map(t=>{const n=e[t];if(void 0===n)throw new Error(`missing price for token ${t}`);return n})}encodeTrade(e,t,{executedAmount:n}={}){if(e.partiallyFillable&&void 0===n)throw new Error("missing executed amount for partially fillable trade");this._trades.push(lt(this._tokens,e,t,{executedAmount:null!=n?n:0}))}signEncodeTrade(e,t,n,a){return r=this,i=function*(){const r=yield Xe(this.domain,e,t,n);this.encodeTrade(e,r,a)},new((s=void 0)||(s=Promise))(function(e,t){function n(e){try{o(i.next(e))}catch(e){t(e)}}function a(e){try{o(i.throw(e))}catch(e){t(e)}}function o(t){var r;t.done?e(t.value):(r=t.value,r instanceof s?r:new s(function(e){e(r)})).then(n,a)}o((i=i.apply(r,[])).next())});var r,s,i}encodeInteraction(e,t=Ze.INTRA){this._interactions[t].push(Fe(e))}encodeOrderRefunds(e){var t,n;if(void 0===this.domain.verifyingContract)throw new Error("domain missing settlement contract address");const a=null!==(t=e.filledAmounts)&&void 0!==t?t:[],r=null!==(n=e.preSignatures)&&void 0!==n?n:[];if(![...a,...r].every(e=>i.utils.isHexString(e,ke)))throw new Error("one or more invalid order UIDs");this._orderRefunds.filledAmounts.push(...a),this._orderRefunds.preSignatures.push(...r)}encodedSettlement(e){return[this.tokens,this.clearingPrices(e),this.trades,this.interactions]}static encodedSetup(...e){const t=new yt({name:"unused"});for(const n of e)t.encodeInteraction(n);return t.encodedSettlement({})}}function ft(e,t){const n=o.from(e.sellTokenIndex).toNumber(),a=o.from(e.buyTokenIndex).toNumber();if(Math.max(n,a)>=t.length)throw new Error("Invalid trade");return Object.assign({sellToken:t[n],buyToken:t[a],receiver:e.receiver,sellAmount:e.sellAmount,buyAmount:e.buyAmount,validTo:o.from(e.validTo).toNumber(),appData:e.appData,feeAmount:e.feeAmount},it(e.flags))}var bt,mt=function(e,t,n,a){return new(n||(n=Promise))(function(r,s){function i(e){try{d(a.next(e))}catch(e){s(e)}}function o(e){try{d(a.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,o)}d((a=a.apply(e,t||[])).next())})};!function(e){e[e.Dev=0]="Dev",e[e.Prod=1]="Prod"}(bt||(bt={}));const ht=5;function Tt(e,t){switch(e){case bt.Dev:return`https://barn.api.cow.fi/${t}`;case bt.Prod:return`https://api.cow.fi/${t}`;default:throw new Error("Invalid environment")}}var Et,At;function It(e){switch(e){case ge.SELL:return"sell";case ge.BUY:return"buy";default:throw new Error(`Unsupported kind ${e}`)}}function gt(e){switch(e){case Ye.EIP712:return"eip712";case Ye.ETHSIGN:return"ethsign";case Ye.EIP1271:return"eip1271";case Ye.PRESIGN:return"presign";default:throw new Error(`Unsupported signing scheme ${e}`)}}function Ot(e,t,n){return mt(this,void 0,void 0,function*(){const a=`${t}/api/v1/${e}`,r=yield Ae(a,n),s=yield r.text();if(!r.ok){const e=new Error(`Calling "${a} ${JSON.stringify(n)} failed with ${r.status}: ${s}`);try{e.apiError=JSON.parse(s)}catch(e){}throw e}return JSON.parse(s)})}function vt({baseUrl:e},t){return mt(this,void 0,void 0,function*(){return t.sellAmountBeforeFee&&(t.sellAmountBeforeFee=t.sellAmountBeforeFee.toString()),t.sellAmountAfterFee&&(t.sellAmountAfterFee=t.sellAmountAfterFee.toString()),t.buyAmountAfterFee&&(t.buyAmountAfterFee=t.buyAmountAfterFee.toString()),Ot("quote",e,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})})}!function(e){e.FAST="fast",e.OPTIMAL="optimal"}(Et||(Et={})),function(e){e.SellAmountDoesNotCoverFee="SellAmountDoesNotCoverFee",e.NoLiquidity="NoLiquidity"}(At||(At={}));class St{constructor(e,t){let n;this.network=e,n="string"==typeof t?t:Tt(t,e),this.baseUrl=n}apiCallParams(){return{network:this.network,baseUrl:this.baseUrl}}estimateTradeAmount(e){return mt(this,void 0,void 0,function*(){return function({sellToken:e,buyToken:t,kind:n,amount:a,baseUrl:r}){return mt(this,void 0,void 0,function*(){const s=n==ge.SELL?{kind:ge.SELL,sellAmountAfterFee:a}:{kind:ge.BUY,buyAmountAfterFee:a},{quote:i}=yield vt({baseUrl:r},Object.assign({from:d.AddressZero,sellToken:e,buyToken:t,priceQuality:Et.FAST},s));if(i.buyToken.toLowerCase()!==t.toLowerCase())throw new Error(`Price returned for sell token ${e} uses an incorrect quote token (${i.buyToken.toLowerCase()} instead of ${t.toLowerCase()})`);return o.from(n==ge.SELL?i.buyAmount:i.sellAmount)})}(Object.assign(Object.assign({},this.apiCallParams()),e))})}placeOrder(e){return mt(this,void 0,void 0,function*(){return function({order:e,signature:t,baseUrl:n,from:a}){return mt(this,void 0,void 0,function*(){const r=Pe(e);return yield Ot("orders",n,{method:"post",body:JSON.stringify({sellToken:r.sellToken,buyToken:r.buyToken,sellAmount:o.from(r.sellAmount).toString(),buyAmount:o.from(r.buyAmount).toString(),validTo:r.validTo,appData:r.appData,feeAmount:o.from(r.feeAmount).toString(),kind:It(e.kind),partiallyFillable:r.partiallyFillable,signature:ct(t),signingScheme:gt(t.scheme),receiver:r.receiver,from:a}),headers:{"Content-Type":"application/json"}})})}(Object.assign(Object.assign({},this.apiCallParams()),e))})}getExecutedSellAmount(e){return mt(this,void 0,void 0,function*(){return function({uid:e,baseUrl:t}){return mt(this,void 0,void 0,function*(){const n=yield Ot(`orders/${e}`,t);return o.from(n.executedSellAmount)})}(Object.assign(Object.assign({},this.apiCallParams()),e))})}getQuote(e){return mt(this,void 0,void 0,function*(){return vt(this.apiCallParams(),e)})}}const wt=r.formatBytes32String("Mattresses in Berlin!"),Nt="0x4e59b44847b379578588920ca78fbf26c0b4956c",Dt={authenticator:"GPv2AllowListAuthentication",settlement:"GPv2Settlement",tradeSimulator:"GPv2TradeSimulator"};function _t({abi:e,bytecode:t},n){const a=new r.Interface(e),s=r.hexConcat([t,a.encodeDeploy(n)]);return r.getCreate2Address(Nt,wt,r.keccak256(s))}var Pt=function(e,t,n,a){return new(n||(n=Promise))(function(r,s){function i(e){try{d(a.next(e))}catch(e){s(e)}}function o(e){try{d(a.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,o)}d((a=a.apply(e,t||[])).next())})};function xt(e){return i.utils.defaultAbiCoder.encode(["bytes32"],[o.from(i.utils.id(e)).sub(1)])}const Ct=xt("eip1967.proxy.implementation"),Rt=xt("eip1967.proxy.admin");function Ut(e,t){return Pt(this,void 0,void 0,function*(){const[n]=i.utils.defaultAbiCoder.decode(["address"],yield e.getStorageAt(t,Ct));return n})}function kt(e,t){return Pt(this,void 0,void 0,function*(){const[n]=i.utils.defaultAbiCoder.decode(["address"],yield e.getStorageAt(t,Rt));return n})}const Lt=["event OwnershipTransferred(address indexed previousOwner, address indexed newOwner)","function owner() view external returns(address)","function transferOwnership(address newOwner) external","function supportsInterface(bytes4 interfaceID) external view returns (bool)"];function Bt(e){var t;return new s(e.address,Lt,null!==(t=e.signer)&&void 0!==t?t:e.provider)}var Mt=function(e,t,n,a){return new(n||(n=Promise))(function(r,s){function i(e){try{d(a.next(e))}catch(e){s(e)}}function o(e){try{d(a.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,o)}d((a=a.apply(e,t||[])).next())})};const Ft=new i.utils.Interface(["function manageUserBalance((uint8, address, uint256, address, address)[])","function batchSwap(uint8, (bytes32, uint256, uint256, uint256, bytes)[], address[], (address, bool, address, bool), int256[], uint256)"]);function Gt(e,t,n){return Mt(this,void 0,void 0,function*(){for(const a in Ft.functions)yield e.grantRole(i.utils.solidityKeccak256(["uint256","bytes4"],[t,Ft.getSighash(a)]),n)})}const $t=["erc20","0x5a28e9363bb942b639270062aa6bb295f434bcdfc42c97267bf003f272060dc9"],Ht=["external","0xabee3b73373acd583a130924aad6dc38cfdc44ba0555ba94ce2ff63980ea0632"],Vt=["internal","0x4ac99ace14ee0a5ef932dc609df0943ab7ac16b7583634612f8dc35a4289a6ce"],Wt=["sell","0xf3b277728b3fee749481eb3e0b3b48980dbbab78658fc419025cb16eee346775"],jt=["buy","0x6ed88e868af0a1983e3886d5f3e95a2fafbd6c3450bc229e27342283dc429ccc"],Yt=["tuple(address handler, bytes32 salt, bytes staticInput)"],Zt=(e,t)=>`${t}@${e}`;function qt(e,t){return e===S[t]}function Xt(e,t){return e===w[t]}async function Kt(e,t,n,a){const r=he.connect(S[n],a);return await r.callStatic.domainVerifiers(e,t)}function Jt(e,t){return he.createInterface().encodeFunctionData("setDomainVerifier",[e,t])}function zt(e){return r.defaultAbiCoder.encode(Yt,[e])}function Qt(e){const{handler:t,salt:n,staticInput:a}=r.defaultAbiCoder.decode(Yt,e)[0];return{handler:t,salt:n,staticInput:a}}function en(e,t){try{r.defaultAbiCoder.encode(e,t)}catch(e){return!1}return!0}async function tn(e){const t=await e.getBlock("latest");return{blockNumber:t.number,blockTimestamp:t.timestamp}}function nn(e){return new Date(1e3*e).toISOString()}function an(e){if($t.includes(e))return Oe.ERC20;if(Ht.includes(e))return Oe.EXTERNAL;if(Vt.includes(e))return Oe.INTERNAL;throw new Error(`Unknown balance type: ${e}`)}function rn(e){if(Wt.includes(e))return ge.SELL;if(jt.includes(e))return ge.BUY;throw new Error(`Unknown kind: ${e}`)}function sn(e){const{sellToken:t,sellAmount:n,buyToken:a,buyAmount:r,buyTokenBalance:s,sellTokenBalance:i,feeAmount:o,kind:d,receiver:c,validTo:u,partiallyFillable:l,appData:p}=e;return{sellToken:t,sellAmount:n,buyToken:a,buyAmount:r,feeAmount:o,receiver:c,partiallyFillable:l,appData:p,validTo:Number(u),kind:rn(d.toString()),sellTokenBalance:an(i.toString()),buyTokenBalance:an(s.toString())}}let on,dn;function cn(){return on||(on=be.createInterface()),on}function un(e,t){return dn||(dn=be.connect(w[e],t)),dn}const ln={};class pn{constructor(e){this.handler=void 0,this.salt=void 0,this.data=void 0,this.staticInput=void 0,this.hasOffChainInput=void 0;const{handler:t,salt:n=r.keccak256(r.randomBytes(32)),data:a,hasOffChainInput:s=!1}=e;if(!i.utils.isAddress(t))throw new Error(`Invalid handler: ${t}`);if(!i.utils.isHexString(n)||32!==i.utils.hexDataLength(n))throw new Error(`Invalid salt: ${n}`);this.handler=t,this.salt=n,this.data=a,this.staticInput=this.transformDataToStruct(a),this.hasOffChainInput=s}get context(){}assertIsValid(){const e=this.isValid();if(!e.isValid)throw new Error(`Invalid order: ${e.reason}`)}get createCalldata(){this.assertIsValid();const e=this.context,t=cn(),n={handler:this.handler,salt:this.salt,staticInput:this.encodeStaticInput()};if(e){const a=e.factoryArgs?r.defaultAbiCoder.encode(e.factoryArgs.argsType,e.factoryArgs.args):"0x";return t.encodeFunctionData("createWithContext",[n,e.address,a,!0])}return t.encodeFunctionData("create",[n,!0])}get removeCalldata(){return this.assertIsValid(),cn().encodeFunctionData("remove",[this.id])}get id(){return r.keccak256(this.serialize())}get ctx(){return this.isSingleOrder?this.id:d.HashZero}get leaf(){return{handler:this.handler,salt:this.salt,staticInput:this.encodeStaticInput()}}static leafToId(e){return r.keccak256(zt(e))}get offChainInput(){return"0x"}encodeStaticInputHelper(e,t){return r.defaultAbiCoder.encode(e,[t])}async poll(e){const{chainId:t,owner:n,provider:a,orderbookApiConfig:r}=e,s=un(t,a);try{const a=this.isValid();if(!a.isValid)return{result:ye.DONT_TRY_AGAIN,reason:`InvalidConditionalOrder. Reason: ${a.reason}`};const i=await this.pollValidate(e);if(i)return i;if(!await this.isAuthorized(e))return{result:ye.DONT_TRY_AGAIN,reason:`NotAuthorized: Order ${this.id} is not authorized for ${n} on chain ${t}`};const[o,d]=await s.getTradeableOrderWithSignature(n,this.leaf,this.offChainInput,[]);let c=ln[t];c||(c=new B(h({},r,{chainId:t})),ln[t]=c);const u=await async function(e,t,n){const{computeOrderUid:a}=await import("./index-92ad38be.js");return a(await le.getDomain(e),n,t)}(t,n,sn(o));return await c.getOrder(u).then(()=>!0).catch(()=>!1)?await this.handlePollFailedAlreadyPresent(u,o,e)||{result:ye.TRY_NEXT_BLOCK,reason:"Order already in orderbook"}:{result:ye.SUCCESS,order:o,signature:d}}catch(e){return{result:ye.UNEXPECTED_ERROR,error:e}}}isAuthorized(e){const{chainId:t,owner:n,provider:a}=e;return un(t,a).callStatic.singleOrders(n,this.id)}cabinet(e){const{chainId:t,owner:n,provider:a}=e;return un(t,a).callStatic.cabinet(n,this.ctx)}static deserializeHelper(e,t,n,a){try{const{handler:s,salt:i,staticInput:o}=Qt(e);if(s!=t)throw new Error("HandlerMismatch");const[d]=r.defaultAbiCoder.decode(n,o);return a(d,i)}catch(e){throw"HandlerMismatch"===e.message?e:new Error("InvalidSerializedConditionalOrder")}}}const yn=["orderType"],fn=["address","bytes32","bytes"],bn=["tuple(bytes32[] proof, tuple(address handler, bytes32 salt, bytes staticInput) params)[]"];class mn{constructor(e,t,n,a=pe.PRIVATE){if(this.chain=void 0,this.location=void 0,this.orders={},this.tree=void 0,this.ctx=void 0,this.chain=e,this.location=a,t&&0===Object.keys(t).length)throw new Error("orders must have non-zero length");if(t&&!n||!t&&n)throw new Error("orders cannot have undefined root");for(const e in t)if(t.hasOwnProperty(e)){const n=t[e];if(!mn.orderTypeRegistry.hasOwnProperty(n.orderType))throw new Error(`Unknown order type: ${n.orderType}`)}if(t&&(this.orders=t,this.getOrGenerateTree().root!==n))throw new Error("root mismatch")}static fromJSON(e){const{chain:t,orders:n,root:a,location:r}=JSON.parse(e,(e,t)=>{if("orders"===e&&"object"==typeof t&&null!==t){const e={};for(const n in t)if(t.hasOwnProperty(n)){const a=t[n],{orderType:r}=a,s=T(a,yn);if(!mn.orderTypeRegistry.hasOwnProperty(r))throw new Error(`Unknown order type: ${r}`);e[n]=new(0,mn.orderTypeRegistry[r])(s)}return e}return"object"==typeof t&&null!==t&&t.hasOwnProperty("type")&&t.hasOwnProperty("hex")&&"BigNumber"===t.type?o.from(t):t}),s=new mn(t,n,a);return s.location=r,s}toJSON(){const e=this.getOrGenerateTree().root;return JSON.stringify(h({},this,{root:e}),(e,t)=>{if("tree"!==e)return"object"==typeof t&&null!==t&&"orderType"in t?h({},t,{orderType:t.orderType}):t})}add(e){e.assertIsValid(),this.orders[e.id]=e,this.reset()}remove(e){delete this.orders[e],this.reset()}update(e,t){const n=t(this.orders[e],this.ctx);delete this.orders[e],this.orders[n.id]=n,this.reset()}getById(e){return this.orders[e]}getByIndex(e){return this.orders[this.orderIds[e]]}get orderIds(){return Object.keys(this.orders)}get root(){return this.getOrGenerateTree().root}getOrGenerateTree(){return this.tree||(this.tree=c.of(Object.values(this.orders).map(e=>[...Object.values(e.leaf)]),fn)),this.tree}static decodeFromJSON(e){return JSON.parse(e)}async prepareProofStruct(e=this.location,t,n){var a=this;return await async function(){switch(e){case pe.PRIVATE:return"0x";case pe.EMITTED:return a.encodeToABI(t);case pe.SWARM:case pe.WAKU:case pe.IPFS:if(!n)throw new Error("Must provide an uploader function");try{return await n(a.encodeToJSON(t))}catch(t){throw new Error(`Error uploading to decentralized storage ${e}: ${t}`)}default:throw new Error("Unsupported location")}}().then(t=>{try{return r.hexlify(r.arrayify(t)),this.location=e,{location:e,data:t}}catch(e){throw new Error("data returned by uploader is invalid")}}).catch(e=>{throw new Error(`Error preparing proof struct: ${e}`)})}static async poll(e,t,n,a,r){const s=un(n,a),i=r?await r(e,t.params):"0x";return await s.getTradeableOrderWithSignature(e,t.params,i,t.proof)}dumpProofs(e){return this.encodeToJSON(e)}dumpProofsAndParams(e){return this.getProofs(e)}getProofs(e){return[...this.getOrGenerateTree().entries()].map(([t,n])=>e&&e(n)||void 0===e?{idx:t,value:n}:void 0).reduce((e,t)=>{if(t){const n={handler:t.value[0],salt:t.value[1],staticInput:t.value[2]};e.push({proof:this.getOrGenerateTree().getProof(t.idx),params:n})}return e},[])}encodeToABI(e){return r.defaultAbiCoder.encode(bn,[this.getProofs(e)])}encodeToJSON(e){return JSON.stringify(this.getProofs(e))}reset(){this.tree=void 0}static registerOrderType(e,t){mn.orderTypeRegistry[e]=t}static resetOrderTypeRegistry(){mn.orderTypeRegistry={}}}mn.orderTypeRegistry={};class hn{constructor(e){this.knownOrderTypes=void 0,this.knownOrderTypes=e}fromParams(e){const{handler:t}=e,n=this.knownOrderTypes[t];if(n)return n(e)}}const Tn=["sellAmount","buyAmount","numberOfParts","startTime","timeBetweenParts","durationOfPart"],En=["n","partSellAmount","minPartLimit","t","t0","span"],An="0x6cF1e9cA41f7611dEf408122793c358a3d11E5a5",In="0x52eD56Da04309Aca4c3FECC595298d80C2f16BAc",gn=o.from(2).pow(32).sub(1),On=o.from(31536e3),vn=["tuple(address sellToken, address buyToken, address receiver, uint256 partSellAmount, uint256 minPartLimit, uint256 t0, uint256 n, uint256 t, uint256 span, bytes32 appData)"];var Sn,wn;!function(e){e.AUTO="AUTO",e.LIMIT_DURATION="LIMIT_DURATION"}(Sn||(Sn={})),function(e){e.AT_MINING_TIME="AT_MINING_TIME",e.AT_EPOCH="AT_EPOCH"}(wn||(wn={}));const Nn={startType:wn.AT_MINING_TIME},Dn={durationType:Sn.AUTO};class _n extends pn{constructor(e){const{handler:t,salt:n,data:a,hasOffChainInput:r}=e;if(t!==An)throw new Error(`InvalidHandler: Expected: ${An}, provided: ${t}`);super({handler:An,salt:n,data:a,hasOffChainInput:r}),this.isSingleOrder=!0}static fromData(e,t){return new _n({handler:An,data:e,salt:t})}static fromParams(e){return _n.deserialize(zt(e))}get context(){return this.staticInput.t0.gt(0)?super.context:{address:In,factoryArgs:void 0}}get orderType(){return"twap"}isValid(){const e=(()=>{const{sellToken:e,sellAmount:t,buyToken:n,buyAmount:a,startTime:r=Nn,numberOfParts:s,timeBetweenParts:i,durationOfPart:o=Dn}=this.data;if(e==n)return"InvalidSameToken";if(e==d.AddressZero||n==d.AddressZero)return"InvalidToken";if(!t.gt(d.Zero))return"InvalidSellAmount";if(!a.gt(d.Zero))return"InvalidMinBuyAmount";if(r.startType===wn.AT_EPOCH){const e=r.epoch;if(!e.gte(d.Zero)||!e.lt(gn))return"InvalidStartTime"}return s.gt(d.One)&&s.lte(gn)?i.gt(d.Zero)&&i.lte(On)?o.durationType!==Sn.LIMIT_DURATION||o.duration.lte(i)?en(vn,[this.staticInput])?void 0:"InvalidData":"InvalidSpan":"InvalidFrequency":"InvalidNumParts"})();return e?{isValid:!1,reason:e}:{isValid:!0}}async startTimestamp(e){const{startTime:t}=this.data;if((null==t?void 0:t.startType)===wn.AT_EPOCH)return t.epoch.toNumber();const n=await this.cabinet(e),a=r.defaultAbiCoder.decode(["uint256"],n)[0];if(a.gt(gn))throw new Error(`Cabinet epoch out of range: ${a.toString()}`);const s=a.toNumber();if(0===s)throw new Error("Cabinet is not set. Required for TWAP orders that start at mining time.");return s}endTimestamp(e){const{numberOfParts:t,timeBetweenParts:n,durationOfPart:a}=this.data;return a&&a.durationType===Sn.LIMIT_DURATION?e+t.sub(1).mul(n).add(a.duration).toNumber():e+t.mul(n).toNumber()}async pollValidate(e){const{blockInfo:t=await tn(e.provider)}=e,{blockTimestamp:n}=t;try{const t=await this.startTimestamp(e);if(t>n)return{result:ye.TRY_AT_EPOCH,epoch:t,reason:`TWAP hasn't started yet. Starts at ${t} (${nn(t)})`};const a=this.endTimestamp(t);return n>=a?{result:ye.DONT_TRY_AGAIN,reason:`TWAP has expired. Expired at ${a} (${nn(a)})`}:void 0}catch(e){var a,r;return null!=e&&null!=(a=e.message)&&a.includes("Cabinet is not set")?{result:ye.DONT_TRY_AGAIN,reason:`${null==e?void 0:e.message}. User likely removed the order.`}:null!=e&&null!=(r=e.message)&&r.includes("Cabinet epoch out of range")?{result:ye.DONT_TRY_AGAIN,reason:`${null==e?void 0:e.message}`}:{result:ye.UNEXPECTED_ERROR,reason:`Unexpected error: ${e.message}`,error:e}}}async handlePollFailedAlreadyPresent(e,t,n){const{blockInfo:a=await tn(n.provider)}=n,{blockTimestamp:r}=a,s=this.data.timeBetweenParts.toNumber(),{numberOfParts:i}=this.data,o=await this.startTimestamp(n);if(r<o)return{result:ye.UNEXPECTED_ERROR,reason:`TWAP part hash't started. First TWAP part start at ${o} (${nn(o)})`,error:void 0};const d=i.mul(s).add(o).toNumber();if(r>=d)return{result:ye.UNEXPECTED_ERROR,reason:`TWAP is expired. Expired at ${d} (${nn(d)})`,error:void 0};const c=Math.floor((r-o)/s);if(c===i.toNumber()-1)return{result:ye.DONT_TRY_AGAIN,reason:`Current active TWAP part (${c+1}/${i}) is already in the Order Book. This was the last TWAP part, no more orders need to be placed`};const u=o+(c+1)*s;return{result:ye.TRY_AT_EPOCH,epoch:u,reason:`Current active TWAP part (${c+1}/${i}) is already in the Order Book. TWAP part ${c+2} doesn't start until ${u} (${nn(u)})`}}serialize(){return zt(this.leaf)}encodeStaticInput(){return super.encodeStaticInputHelper(vn,this.staticInput)}static deserialize(e){return super.deserializeHelper(e,An,vn,(e,t)=>new _n({handler:An,salt:t,data:xn(e)}))}toString(){const{sellAmount:e,sellToken:t,buyAmount:n,buyToken:a,numberOfParts:r,startTime:s=Nn,timeBetweenParts:i,durationOfPart:o=Dn,receiver:d,appData:c}=this.data,u=s.startType===wn.AT_MINING_TIME?"AT_MINING_TIME":s.epoch.toNumber(),l=o.durationType===Sn.AUTO?"AUTO":o.duration.toNumber(),p={sellAmount:e.toString(),sellToken:t,buyAmount:n.toString(),buyToken:a,numberOfParts:r.toString(),startTime:u,timeBetweenParts:i.toNumber(),durationOfPart:l,receiver:d,appData:c};return`${this.orderType} (${this.id}): ${JSON.stringify(p)}`}transformDataToStruct(e){return Pn(e)}transformStructToData(e){return xn(e)}}function Pn(e){const{sellAmount:t,buyAmount:n,numberOfParts:a,startTime:r=Nn,timeBetweenParts:s,durationOfPart:i=Dn}=e,o=T(e,Tn),{partSellAmount:c,minPartLimit:u}=a&&!a.isZero()?{partSellAmount:t.div(a),minPartLimit:n.div(a)}:{partSellAmount:d.Zero,minPartLimit:d.Zero};return h({partSellAmount:c,minPartLimit:u,t0:r.startType===wn.AT_MINING_TIME?d.Zero:r.epoch,n:a,t:s,span:i.durationType===Sn.AUTO?d.Zero:i.duration},o)}function xn(e){const{n:t,partSellAmount:n,minPartLimit:a,t:r,t0:s,span:i}=e,o=T(e,En),d=i.isZero()?{durationType:Sn.AUTO}:{durationType:Sn.LIMIT_DURATION,duration:i},c=i.isZero()?{startType:wn.AT_MINING_TIME}:{startType:wn.AT_EPOCH,epoch:s};return h({sellAmount:n.mul(t),buyAmount:a.mul(t),startTime:c,numberOfParts:t,timeBetweenParts:r,durationOfPart:d},o)}const Cn={[An]:e=>_n.fromParams(e)};export{ot as $,St as A,Ie as B,y as C,Nt as D,F as E,Ue as F,At as G,ke as H,Ze as I,Le as J,Be as K,ht as L,Me as M,Ut as N,Oe as O,kt as P,Et as Q,Lt as R,Ye as S,pt as T,Bt as U,et as V,at as W,rt as X,st as Y,it as Z,h as _,v as a,pn as a$,dt as a0,ct as a1,ut as a2,yt as a3,ft as a4,We as a5,je as a6,ze as a7,Qe as a8,Ft as a9,q as aA,X as aB,K as aC,J as aD,z as aE,D as aF,P as aG,x as aH,R as aI,oe as aJ,de as aK,ce as aL,le as aM,pe as aN,ye as aO,Yt as aP,Zt as aQ,qt as aR,Xt as aS,Kt as aT,Jt as aU,zt as aV,Qt as aW,en as aX,tn as aY,nn as aZ,sn as a_,Gt as aa,$e as ab,u as ac,l as ad,p as ae,f as af,b as ag,m as ah,A as ai,I as aj,g as ak,O as al,S as am,w as an,U as ao,k as ap,B as aq,M as ar,G as as,$ as at,H as au,V as av,W as aw,j as ax,Y as ay,Z as az,Ke as b,mn as b0,hn as b1,Cn as b2,An as b3,In as b4,gn as b5,On as b6,Sn as b7,wn as b8,_n as b9,Pn as ba,xn as bb,Je as c,Ee as d,Te as e,ge as f,lt as g,bt as h,He as i,Tt as j,wt as k,Dt as l,_t as m,Ge as n,Fe as o,ve as p,Se as q,we as r,Xe as s,Ne as t,De as u,_e as v,Pe as w,xe as x,Ce as y,Re as z};
//# sourceMappingURL=index-dceb27bc.js.map
