require("cross-fetch/polyfill");var e,t=require("limiter"),r=require("exponential-backoff"),n=require("graphql-request"),a=require("ethers"),o=require("@openzeppelin/merkle-tree");function s(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}}),t.default=e,t}exports.SupportedChainId=void 0,(e=exports.SupportedChainId||(exports.SupportedChainId={}))[e.MAINNET=1]="MAINNET",e[e.GOERLI=5]="GOERLI",e[e.GNOSIS_CHAIN=100]="GNOSIS_CHAIN",e[e.MUMBAI=80001]="MUMBAI";const i=["prod","staging"],d={env:"prod",chainId:exports.SupportedChainId.MAINNET};class u extends Error{constructor(e,t){super(e),this.error_code=void 0,this.error_code=t}}const{GPv2Settlement:c}=JSON.parse('{\n  "GPv2AllowListAuthentication_Implementation": {\n    "1": {\n      "address": "0x9E7Ae8Bdba9AA346739792d219a808884996Db67",\n      "transactionHash": "0x58340aa44119c74e48635fab0ac344170c6d6e8b42e5714baa4ba4e1651f63ad"\n    },\n    "4": {\n      "address": "0x9E7Ae8Bdba9AA346739792d219a808884996Db67"\n    },\n    "5": {\n      "address": "0x9E7Ae8Bdba9AA346739792d219a808884996Db67",\n      "transactionHash": "0x24f4f80b46a17345011065f9ea2af823f582db56be81098b3b66cc2db9659ea7"\n    },\n    "100": {\n      "address": "0x9E7Ae8Bdba9AA346739792d219a808884996Db67",\n      "transactionHash": "0xe52d425fe34d6d5215ccfc9ddfa485d490b3018f0ee5bbed708f2d172044d60d"\n    },\n    "80001": {\n      "address": "0x02104F2081A552C740f347b5bD97a8F6B8cfb428",\n      "transactionHash": "0x42c5c8c67ac7a27f9ee7404ed3896068835f99f8ec79b9218b713ede8adcaf1f"\n    },\n    "11155111": {\n      "address": "0x9E7Ae8Bdba9AA346739792d219a808884996Db67",\n      "transactionHash": "0xad2b992f7363e5eb8523a7034a7d36a311485f126db9938d4847cc38d2d86b86"\n    }\n  },\n  "GPv2AllowListAuthentication_Proxy": {\n    "1": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0xb84bf720364f94c749f1ec1cdf0d4c44c70411b716459aaccfd24fc677013375"\n    },\n    "4": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0x57b2278fd3a13ab1b132031024475ba1a4e28d7d4d37f556134c84512b742c1f"\n    },\n    "5": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0x39dcf30baf887a5db54551a84de8bfdb6cf418bb284b09680d13aed17d5fa0c1"\n    },\n    "100": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0x1a2d87a05a94bc6680a4faee31bbafbd74e9ddb63dd3941c717b5c609c08b957"\n    },\n    "80001": {\n      "address": "0x952862429B4aA73ea76e4C05Ba730a2BD1747b36",\n      "transactionHash": "0xd42f9d36f7f88ce6c421f3c44d122284a55aeba26bc2b984b1fca22ae7e2ac13"\n    },\n    "11155111": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0x73c54c75b3f382304f3adf33e3876c8999fb10df786d4a902733369251033cd1"\n    }\n  },\n  "GPv2AllowListAuthentication": {\n    "1": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0xb84bf720364f94c749f1ec1cdf0d4c44c70411b716459aaccfd24fc677013375"\n    },\n    "4": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0x57b2278fd3a13ab1b132031024475ba1a4e28d7d4d37f556134c84512b742c1f"\n    },\n    "5": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0x39dcf30baf887a5db54551a84de8bfdb6cf418bb284b09680d13aed17d5fa0c1"\n    },\n    "100": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0x1a2d87a05a94bc6680a4faee31bbafbd74e9ddb63dd3941c717b5c609c08b957"\n    },\n    "80001": {\n      "address": "0x952862429B4aA73ea76e4C05Ba730a2BD1747b36",\n      "transactionHash": "0xd42f9d36f7f88ce6c421f3c44d122284a55aeba26bc2b984b1fca22ae7e2ac13"\n    },\n    "11155111": {\n      "address": "0x2c4c28DDBdAc9C5E7055b4C863b72eA0149D8aFE",\n      "transactionHash": "0x73c54c75b3f382304f3adf33e3876c8999fb10df786d4a902733369251033cd1"\n    }\n  },\n  "GPv2Settlement": {\n    "1": {\n      "address": "0x9008D19f58AAbD9eD0D60971565AA8510560ab41",\n      "transactionHash": "0xf49f90aa5a268c40001d1227b76bb4dd8247f18361fcad9fffd4a7a44f1320d3"\n    },\n    "4": {\n      "address": "0x9008D19f58AAbD9eD0D60971565AA8510560ab41",\n      "transactionHash": "0x609fa2e8f32c73c1f5dc21ff60a26238dacb50d4674d336c90d6950bdda17a21"\n    },\n    "5": {\n      "address": "0x9008D19f58AAbD9eD0D60971565AA8510560ab41",\n      "transactionHash": "0x982f089060ff66e19d0683ef1cc6a637297331a9ba95b65d8eb84b9f8dc64b04"\n    },\n    "100": {\n      "address": "0x9008D19f58AAbD9eD0D60971565AA8510560ab41",\n      "transactionHash": "0x9ddc538f89cd8433f4a19bc4de0de27e7c68a1d04a14b327185e4bba9af87133"\n    },\n    "80001": {\n      "address": "0xa474e4490B1B56D8a1EDE4e6eE6eF2C5c42db047",\n      "transactionHash": "0x934d1c7e46b074dc01dd2b3cb81710ecad3419555f39ea15fc7f5c53d3a00955"\n    },\n    "11155111": {\n      "address": "0x9008D19f58AAbD9eD0D60971565AA8510560ab41",\n      "transactionHash": "0x6bba22a00ffcff6bca79aced546e18d2a5a4f4e484a4e4dbafab13daf42f718d"\n    }\n  },\n  "GPv2VaultRelayer": {\n    "1": {\n      "address": "0xC92E8bdf79f0507f65a392b0ab4667716BFE0110",\n      "transactionHash": "0xf49f90aa5a268c40001d1227b76bb4dd8247f18361fcad9fffd4a7a44f1320d3"\n    },\n    "4": {\n      "address": "0xC92E8bdf79f0507f65a392b0ab4667716BFE0110",\n      "transactionHash": "0x609fa2e8f32c73c1f5dc21ff60a26238dacb50d4674d336c90d6950bdda17a21"\n    },\n    "5": {\n      "address": "0xC92E8bdf79f0507f65a392b0ab4667716BFE0110",\n      "transactionHash": "0x982f089060ff66e19d0683ef1cc6a637297331a9ba95b65d8eb84b9f8dc64b04"\n    },\n    "100": {\n      "address": "0xC92E8bdf79f0507f65a392b0ab4667716BFE0110",\n      "transactionHash": "0x9ddc538f89cd8433f4a19bc4de0de27e7c68a1d04a14b327185e4bba9af87133"\n    },\n    "80001": {\n      "address": "0x46b1a51A9166DA07db57c98B15358DE5FFfcbb97",\n      "transactionHash": "0x934d1c7e46b074dc01dd2b3cb81710ecad3419555f39ea15fc7f5c53d3a00955"\n    },\n    "11155111": {\n      "address": "0xC92E8bdf79f0507f65a392b0ab4667716BFE0110",\n      "transactionHash": "0x6bba22a00ffcff6bca79aced546e18d2a5a4f4e484a4e4dbafab13daf42f718d"\n    }\n  },\n  "GPv2TradeSimulator": {\n    "80001": {\n      "address": "0x9E88a6B1Ba0fA9c5BC9bE09a17EE982aB12DcB60",\n      "transactionHash": "0x946345cf7cda53fc88627877cacbdd94bef4f0cacc798019578e03c0e075b781"\n    }\n  }\n}'),p="0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE",l="0x2f55e8b20D0B9FEFA187AA7d00B6Cbe563605bF5",y="0x5d84eB96e4D57fB2a7945f32be7401237eD243ad",f=[exports.SupportedChainId.MAINNET,exports.SupportedChainId.GOERLI,exports.SupportedChainId.GNOSIS_CHAIN,exports.SupportedChainId.MUMBAI],m=f.reduce((e,t)=>({...e,[t]:c[t].address}),{}),h=f.reduce((e,t)=>({...e,[t]:l}),{}),T=f.reduce((e,t)=>({...e,[t]:y}),{});function b(e){return function(e){const{ethflowData:t}=e;if(!t)return e;const{userValidTo:r}=t,n=e.onchainUser||e.owner,a=p;return{...e,validTo:r,owner:n,sellToken:a}}(function(e){const{executedFeeAmount:t,executedSurplusFee:r}=e,n=null!=r?r:t;return{...e,totalFee:n}}(e))}const E=function(e,{path:t,query:n,method:a,body:o},s,i){try{const d={Accept:"application/json","Content-Type":"application/json"},u=`${e}${t}${n?"?"+n:""}`,c={method:a,body:(()=>{if(o)return"string"==typeof o?o:JSON.stringify(o)})(),headers:d};return Promise.resolve(r.backOff(function(){try{return Promise.resolve(s.removeTokens(1)).then(function(){return Promise.resolve(fetch(u,c)).then(function(e){return Promise.resolve(O(e)).then(function(t){return e.status>=200&&e.status<300?t:Promise.reject(new x(e,t))})})})}catch(e){return Promise.reject(e)}},i))}catch(e){return Promise.reject(e)}};class x extends Error{constructor(e,t){super("string"==typeof t?t:e.statusText),this.response=void 0,this.body=void 0,this.response=e,this.body=t}}const S=[408,425,429,500,502,503,504],A={numOfAttempts:10,maxDelay:Infinity,jitter:"none",retry:e=>!(e instanceof x)||S.includes(e.response.status)},I={tokensPerInterval:5,interval:"second"},O=function(e){try{let t;const r=function(){if(204!==e.status)return function(r,n){try{var a=function(){const r=e.headers.get("Content-Type");return function(){if(r)return r.toLowerCase().startsWith("application/json")?Promise.resolve(e.json()).then(function(e){return t=1,e}):Promise.resolve(e.text()).then(function(e){return t=1,e})}()}()}catch(e){return n(e)}return a&&a.then?a.then(void 0,n):a}(0,function(e){console.error(e)})}();return Promise.resolve(r&&r.then?r.then(function(e){return t?e:void 0}):t?r:void 0)}catch(e){return Promise.reject(e)}},g={[exports.SupportedChainId.MAINNET]:"https://api.cow.fi/mainnet",[exports.SupportedChainId.GNOSIS_CHAIN]:"https://api.cow.fi/xdai",[exports.SupportedChainId.GOERLI]:"https://api.cow.fi/goerli",[exports.SupportedChainId.MUMBAI]:"http://localhost:8080"},v={[exports.SupportedChainId.MAINNET]:"https://barn.api.cow.fi/mainnet",[exports.SupportedChainId.GNOSIS_CHAIN]:"https://barn.api.cow.fi/xdai",[exports.SupportedChainId.GOERLI]:"https://barn.api.cow.fi/goerli",[exports.SupportedChainId.MUMBAI]:"http://localhost:8080"};function P(e){return Object.keys(e).reduce((t,r)=>{const n=e[r];return void 0!==n&&(t[r]=n),t},{})}class N{constructor(e={}){this.context=void 0,this.rateLimiter=void 0,this.context={...d,...e},this.rateLimiter=new t.RateLimiter(e.limiterOpts||I)}getVersion(e={}){return this.fetch({path:"/api/v1/version",method:"GET"},e)}getTrades(e,t={}){if(e.owner&&e.orderUid)return Promise.reject(new u("Cannot specify both owner and orderId"));if(!e.owner&&!e.orderUid)return Promise.reject(new u("Must specify either owner or orderId"));const r=new URLSearchParams(P(e));return this.fetch({path:"/api/v1/trades",method:"GET",query:r},t)}getOrders({owner:e,offset:t=0,limit:r=1e3},n={}){const a=new URLSearchParams(P({offset:t.toString(),limit:r.toString()}));return this.fetch({path:`/api/v1/account/${e}/orders`,method:"GET",query:a},n).then(e=>e.map(b))}getTxOrders(e,t={}){return this.fetch({path:`/api/v1/transactions/${e}/orders`,method:"GET"},t).then(e=>e.map(b))}getOrder(e,t={}){return this.fetch({path:`/api/v1/orders/${e}`,method:"GET"},t).then(e=>b(e))}getOrderMultiEnv(e,t={}){const{env:r}=this.getContextWithOverride(t),n=i.filter(e=>e!==r);let a=0;const o=r=>{const s=n[a];return r instanceof x&&404===r.response.status&&s?(a++,this.getOrder(e,{...t,env:s}).catch(o)):Promise.reject(r)};return this.getOrder(e,{...t,env:r}).catch(o)}getQuote(e,t={}){return this.fetch({path:"/api/v1/quote",method:"POST",body:e},t)}sendSignedOrderCancellations(e,t={}){return this.fetch({path:"/api/v1/orders",method:"DELETE",body:e},t)}sendOrder(e,t={}){return this.fetch({path:"/api/v1/orders",method:"POST",body:e},t)}getNativePrice(e,t={}){return this.fetch({path:`/api/v1/token/${e}/native_price`,method:"GET"},t)}getTotalSurplus(e,t={}){return this.fetch({path:`/api/v1/users/${e}/total_surplus`,method:"GET"},t)}getAppData(e,t={}){return this.fetch({path:`/api/v1/app_data/${e}`,method:"GET"},t)}uploadAppData(e,t,r={}){return this.fetch({path:`/api/v1/app_data/${e}`,method:"PUT",body:{fullAppData:t}},r)}getSolverCompetition(e,t={}){return this.fetch({path:`/api/v1/solver_competition${"string"==typeof e?"/by_tx_hash":""}/${e}`,method:"GET"},t)}getOrderLink(e,t){const{chainId:r,env:n}=this.getContextWithOverride(t);return this.getApiBaseUrls(n)[r]+`/api/v1/orders/${e}`}getContextWithOverride(e={}){return{...this.context,...e}}getApiBaseUrls(e){return this.context.baseUrls?this.context.baseUrls:"prod"===e?g:v}fetch(e,t={}){const{chainId:r,env:n}=this.getContextWithOverride(t),a=this.getApiBaseUrls(n)[r];return E(a,e,this.rateLimiter,this.context.backoffOpts||A)}}var C,_,D,R,w,U,B,L,k,F,M,G,$,H,V;exports.BuyTokenDestination=void 0,(C=exports.BuyTokenDestination||(exports.BuyTokenDestination={})).ERC20="erc20",C.INTERNAL="internal",exports.EcdsaSigningScheme=void 0,(_=exports.EcdsaSigningScheme||(exports.EcdsaSigningScheme={})).EIP712="eip712",_.ETHSIGN="ethsign",exports.OnchainOrderData=void 0,(R=(D=exports.OnchainOrderData||(exports.OnchainOrderData={})).placementError||(D.placementError={})).QUOTE_NOT_FOUND="QuoteNotFound",R.VALID_TO_TOO_FAR_IN_FUTURE="ValidToTooFarInFuture",R.PRE_VALIDATION_ERROR="PreValidationError",exports.OrderCancellationError=void 0,(U=(w=exports.OrderCancellationError||(exports.OrderCancellationError={})).errorType||(w.errorType={})).INVALID_SIGNATURE="InvalidSignature",U.WRONG_OWNER="WrongOwner",U.ORDER_NOT_FOUND="OrderNotFound",U.ALREADY_CANCELLED="AlreadyCancelled",U.ORDER_FULLY_EXECUTED="OrderFullyExecuted",U.ORDER_EXPIRED="OrderExpired",U.ON_CHAIN_ORDER="OnChainOrder",exports.OrderClass=void 0,(B=exports.OrderClass||(exports.OrderClass={})).MARKET="market",B.LIMIT="limit",B.LIQUIDITY="liquidity",exports.OrderKind$1=void 0,(L=exports.OrderKind$1||(exports.OrderKind$1={})).BUY="buy",L.SELL="sell",exports.OrderPostError=void 0,function(e){e.DUPLICATED_ORDER="DuplicatedOrder",e.QUOTE_NOT_FOUND="QuoteNotFound",e.INVALID_QUOTE="InvalidQuote",e.MISSING_FROM="MissingFrom",e.WRONG_OWNER="WrongOwner",e.INVALID_EIP1271SIGNATURE="InvalidEip1271Signature",e.INSUFFICIENT_BALANCE="InsufficientBalance",e.INSUFFICIENT_ALLOWANCE="InsufficientAllowance",e.INVALID_SIGNATURE="InvalidSignature",e.INSUFFICIENT_FEE="InsufficientFee",e.SELL_AMOUNT_OVERFLOW="SellAmountOverflow",e.TRANSFER_SIMULATION_FAILED="TransferSimulationFailed",e.ZERO_AMOUNT="ZeroAmount",e.INCOMPATIBLE_SIGNING_SCHEME="IncompatibleSigningScheme",e.TOO_MANY_LIMIT_ORDERS_UNSUPPORTED_BUY_TOKEN_DESTINATION="TooManyLimitOrders UnsupportedBuyTokenDestination",e.UNSUPPORTED_SELL_TOKEN_SOURCE="UnsupportedSellTokenSource",e.UNSUPPORTED_ORDER_TYPE="UnsupportedOrderType",e.INSUFFICIENT_VALID_TO="InsufficientValidTo",e.EXCESSIVE_VALID_TO="ExcessiveValidTo",e.TRANSFER_ETH_TO_CONTRACT="TransferEthToContract",e.INVALID_NATIVE_SELL_TOKEN_SAME_BUY_AND_SELL_TOKEN="InvalidNativeSellToken SameBuyAndSellToken",e.UNSUPPORTED_SIGNATURE="UnsupportedSignature",e.UNSUPPORTED_TOKEN="UnsupportedToken",e.UNSUPPORTED_CUSTOM_INTERACTION_INVALID_APP_DATA="UnsupportedCustomInteraction InvalidAppData",e.APP_DATA_HASH_MISMATCH="AppDataHashMismatch"}((k=exports.OrderPostError||(exports.OrderPostError={})).errorType||(k.errorType={})),exports.OrderQuoteSideKindBuy=void 0,(exports.OrderQuoteSideKindBuy||(exports.OrderQuoteSideKindBuy={})).BUY="buy",exports.OrderQuoteSideKindSell=void 0,(exports.OrderQuoteSideKindSell||(exports.OrderQuoteSideKindSell={})).SELL="sell",exports.OrderStatus=void 0,(F=exports.OrderStatus||(exports.OrderStatus={})).PRESIGNATURE_PENDING="presignaturePending",F.OPEN="open",F.FULFILLED="fulfilled",F.CANCELLED="cancelled",F.EXPIRED="expired",exports.PriceEstimationError=void 0,function(e){e.UNSUPPORTED_TOKEN="UnsupportedToken",e.ZERO_AMOUNT="ZeroAmount",e.UNSUPPORTED_ORDER_TYPE="UnsupportedOrderType"}((M=exports.PriceEstimationError||(exports.PriceEstimationError={})).errorType||(M.errorType={})),exports.PriceQuality=void 0,(G=exports.PriceQuality||(exports.PriceQuality={})).FAST="fast",G.OPTIMAL="optimal",G.VERIFIED="verified",exports.ReplaceOrderError=void 0,function(e){e.ALREADY_CANCELLED="AlreadyCancelled",e.ORDER_FULLY_EXECUTED="OrderFullyExecuted",e.ORDER_EXPIRED="OrderExpired",e.ON_CHAIN_ORDER="OnChainOrder",e.DUPLICATED_ORDER="DuplicatedOrder",e.INSUFFICIENT_FEE="InsufficientFee",e.INSUFFICIENT_ALLOWANCE="InsufficientAllowance",e.INSUFFICIENT_BALANCE="InsufficientBalance",e.INSUFFICIENT_VALID_TO="InsufficientValidTo",e.EXCESSIVE_VALID_TO="ExcessiveValidTo",e.INVALID_SIGNATURE="InvalidSignature",e.TRANSFER_ETH_TO_CONTRACT="TransferEthToContract",e.TRANSFER_SIMULATION_FAILED="TransferSimulationFailed",e.UNSUPPORTED_TOKEN="UnsupportedToken",e.WRONG_OWNER="WrongOwner",e.SAME_BUY_AND_SELL_TOKEN="SameBuyAndSellToken",e.ZERO_AMOUNT="ZeroAmount",e.UNSUPPORTED_BUY_TOKEN_DESTINATION="UnsupportedBuyTokenDestination",e.UNSUPPORTED_SELL_TOKEN_SOURCE="UnsupportedSellTokenSource",e.UNSUPPORTED_ORDER_TYPE="UnsupportedOrderType",e.UNSUPPORTED_SIGNATURE="UnsupportedSignature"}(($=exports.ReplaceOrderError||(exports.ReplaceOrderError={})).errorType||($.errorType={})),exports.SellTokenSource=void 0,(H=exports.SellTokenSource||(exports.SellTokenSource={})).ERC20="erc20",H.INTERNAL="internal",H.EXTERNAL="external",exports.SigningScheme$1=void 0,(V=exports.SigningScheme$1||(exports.SigningScheme$1={})).EIP712="eip712",V.ETHSIGN="ethsign",V.PRESIGN="presign",V.EIP1271="eip1271";const j=n.gql`
  query Totals {
    totals {
      tokens
      orders
      traders
      settlements
      volumeUsd
      volumeEth
      feesUsd
      feesEth
    }
  }
`,W=n.gql`
  query LastDaysVolume($days: Int!) {
    dailyTotals(orderBy: timestamp, orderDirection: desc, first: $days) {
      timestamp
      volumeUsd
    }
  }
`,K=n.gql`
  query LastHoursVolume($hours: Int!) {
    hourlyTotals(orderBy: timestamp, orderDirection: desc, first: $hours) {
      timestamp
      volumeUsd
    }
  }
`,Y="https://api.thegraph.com/subgraphs/name/cowprotocol",Q={[exports.SupportedChainId.MAINNET]:Y+"/cow",[exports.SupportedChainId.GNOSIS_CHAIN]:Y+"/cow-gc",[exports.SupportedChainId.GOERLI]:Y+"/cow-goerli",[exports.SupportedChainId.MUMBAI]:"https://thegraph.com/hosted-service/subgraph/shahzeb8285/wowswapfork"},q={[exports.SupportedChainId.MAINNET]:Y+"/cow-staging",[exports.SupportedChainId.GNOSIS_CHAIN]:Y+"/cow-gc-staging",[exports.SupportedChainId.GOERLI]:"",[exports.SupportedChainId.MUMBAI]:"https://thegraph.com/hosted-service/subgraph/shahzeb8285/wowswapfork"},X=()=>Promise.resolve().then(function(){return require("./utils-9a1df9d3.js")});class Z{static signOrder(e,t,r){try{return Promise.resolve(X()).then(function({signOrder:n}){return n(e,t,r)})}catch(e){return Promise.reject(e)}}static signOrderCancellation(e,t,r){try{return Promise.resolve(X()).then(function({signOrderCancellation:n}){return n(e,t,r)})}catch(e){return Promise.reject(e)}}static signOrderCancellations(e,t,r){try{return Promise.resolve(X()).then(function({signOrderCancellations:n}){return n(e,t,r)})}catch(e){return Promise.reject(e)}}static getDomain(e){try{return Promise.resolve(X()).then(function({getDomain:t}){return t(e)})}catch(e){return Promise.reject(e)}}static getDomainSeparator(e){try{return Promise.resolve(X()).then(function({getDomain:t}){return Promise.resolve(Promise.resolve().then(function(){/*#__PURE__*/return s(require("ethers/lib/utils"))})).then(function({_TypedDataEncoder:r}){return r.hashDomain(t(e))})})}catch(e){return Promise.reject(e)}}static getEIP712Types(){return{Order:[{name:"sellToken",type:"address"},{name:"buyToken",type:"address"},{name:"receiver",type:"address"},{name:"sellAmount",type:"uint256"},{name:"buyAmount",type:"uint256"},{name:"validTo",type:"uint32"},{name:"appData",type:"bytes32"},{name:"feeAmount",type:"uint256"},{name:"kind",type:"string"},{name:"partiallyFillable",type:"bool"},{name:"sellTokenBalance",type:"string"},{name:"buyTokenBalance",type:"string"}]}}}var z,J;exports.ProofLocation=void 0,(z=exports.ProofLocation||(exports.ProofLocation={}))[z.PRIVATE=0]="PRIVATE",z[z.EMITTED=1]="EMITTED",z[z.SWARM=2]="SWARM",z[z.WAKU=3]="WAKU",z[z.RESERVED=4]="RESERVED",z[z.IPFS=5]="IPFS",exports.PollResultCode=void 0,(J=exports.PollResultCode||(exports.PollResultCode={})).SUCCESS="SUCCESS",J.UNEXPECTED_ERROR="UNEXPECTED_ERROR",J.TRY_NEXT_BLOCK="TRY_NEXT_BLOCK",J.TRY_ON_BLOCK="TRY_ON_BLOCK",J.TRY_AT_EPOCH="TRY_AT_EPOCH",J.DONT_TRY_AGAIN="DONT_TRY_AGAIN";const ee=[{inputs:[{internalType:"address",name:"_settlement",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"InterfaceNotSupported",type:"error"},{inputs:[],name:"InvalidHandler",type:"error"},{inputs:[],name:"ProofNotAuthed",type:"error"},{inputs:[],name:"SingleOrderNotAuthed",type:"error"},{inputs:[],name:"SwapGuardRestricted",type:"error"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{components:[{internalType:"contract IConditionalOrder",name:"handler",type:"address"},{internalType:"bytes32",name:"salt",type:"bytes32"},{internalType:"bytes",name:"staticInput",type:"bytes"}],indexed:!1,internalType:"struct IConditionalOrder.ConditionalOrderParams",name:"params",type:"tuple"}],name:"ConditionalOrderCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!1,internalType:"bytes32",name:"root",type:"bytes32"},{components:[{internalType:"uint256",name:"location",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],indexed:!1,internalType:"struct ComposableCoW.Proof",name:"proof",type:"tuple"}],name:"MerkleRootSet",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!1,internalType:"contract ISwapGuard",name:"swapGuard",type:"address"}],name:"SwapGuardSet",type:"event"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"bytes32",name:"",type:"bytes32"}],name:"cabinet",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"contract IConditionalOrder",name:"handler",type:"address"},{internalType:"bytes32",name:"salt",type:"bytes32"},{internalType:"bytes",name:"staticInput",type:"bytes"}],internalType:"struct IConditionalOrder.ConditionalOrderParams",name:"params",type:"tuple"},{internalType:"bool",name:"dispatch",type:"bool"}],name:"create",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"contract IConditionalOrder",name:"handler",type:"address"},{internalType:"bytes32",name:"salt",type:"bytes32"},{internalType:"bytes",name:"staticInput",type:"bytes"}],internalType:"struct IConditionalOrder.ConditionalOrderParams",name:"params",type:"tuple"},{internalType:"contract IValueFactory",name:"factory",type:"address"},{internalType:"bytes",name:"data",type:"bytes"},{internalType:"bool",name:"dispatch",type:"bool"}],name:"createWithContext",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"domainSeparator",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{components:[{internalType:"contract IConditionalOrder",name:"handler",type:"address"},{internalType:"bytes32",name:"salt",type:"bytes32"},{internalType:"bytes",name:"staticInput",type:"bytes"}],internalType:"struct IConditionalOrder.ConditionalOrderParams",name:"params",type:"tuple"},{internalType:"bytes",name:"offchainInput",type:"bytes"},{internalType:"bytes32[]",name:"proof",type:"bytes32[]"}],name:"getTradeableOrderWithSignature",outputs:[{components:[{internalType:"contract IERC20",name:"sellToken",type:"address"},{internalType:"contract IERC20",name:"buyToken",type:"address"},{internalType:"address",name:"receiver",type:"address"},{internalType:"uint256",name:"sellAmount",type:"uint256"},{internalType:"uint256",name:"buyAmount",type:"uint256"},{internalType:"uint32",name:"validTo",type:"uint32"},{internalType:"bytes32",name:"appData",type:"bytes32"},{internalType:"uint256",name:"feeAmount",type:"uint256"},{internalType:"bytes32",name:"kind",type:"bytes32"},{internalType:"bool",name:"partiallyFillable",type:"bool"},{internalType:"bytes32",name:"sellTokenBalance",type:"bytes32"},{internalType:"bytes32",name:"buyTokenBalance",type:"bytes32"}],internalType:"struct GPv2Order.Data",name:"order",type:"tuple"},{internalType:"bytes",name:"signature",type:"bytes"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"contract IConditionalOrder",name:"handler",type:"address"},{internalType:"bytes32",name:"salt",type:"bytes32"},{internalType:"bytes",name:"staticInput",type:"bytes"}],internalType:"struct IConditionalOrder.ConditionalOrderParams",name:"params",type:"tuple"}],name:"hash",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"contract Safe",name:"safe",type:"address"},{internalType:"address",name:"sender",type:"address"},{internalType:"bytes32",name:"_hash",type:"bytes32"},{internalType:"bytes32",name:"_domainSeparator",type:"bytes32"},{internalType:"bytes32",name:"",type:"bytes32"},{internalType:"bytes",name:"encodeData",type:"bytes"},{internalType:"bytes",name:"payload",type:"bytes"}],name:"isValidSafeSignature",outputs:[{internalType:"bytes4",name:"magic",type:"bytes4"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"singleOrderHash",type:"bytes32"}],name:"remove",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"roots",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"root",type:"bytes32"},{components:[{internalType:"uint256",name:"location",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],internalType:"struct ComposableCoW.Proof",name:"proof",type:"tuple"}],name:"setRoot",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"root",type:"bytes32"},{components:[{internalType:"uint256",name:"location",type:"uint256"},{internalType:"bytes",name:"data",type:"bytes"}],internalType:"struct ComposableCoW.Proof",name:"proof",type:"tuple"},{internalType:"contract IValueFactory",name:"factory",type:"address"},{internalType:"bytes",name:"data",type:"bytes"}],name:"setRootWithContext",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"contract ISwapGuard",name:"swapGuard",type:"address"}],name:"setSwapGuard",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"bytes32",name:"",type:"bytes32"}],name:"singleOrders",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"swapGuards",outputs:[{internalType:"contract ISwapGuard",name:"",type:"address"}],stateMutability:"view",type:"function"}];class te{static createInterface(){return new a.utils.Interface(ee)}static connect(e,t){return new a.Contract(e,ee,t)}}te.abi=ee;const re=[{anonymous:!1,inputs:[{indexed:!0,internalType:"contract Safe",name:"safe",type:"address"},{indexed:!1,internalType:"bytes32",name:"domainSeparator",type:"bytes32"},{indexed:!1,internalType:"contract ISafeSignatureVerifier",name:"verifier",type:"address"}],name:"AddedDomainVerifier",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"contract Safe",name:"safe",type:"address"},{indexed:!1,internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"AddedInterface",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"contract Safe",name:"safe",type:"address"},{indexed:!1,internalType:"bytes4",name:"selector",type:"bytes4"},{indexed:!1,internalType:"bytes32",name:"method",type:"bytes32"}],name:"AddedSafeMethod",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"contract Safe",name:"safe",type:"address"},{indexed:!1,internalType:"bytes32",name:"domainSeparator",type:"bytes32"},{indexed:!1,internalType:"contract ISafeSignatureVerifier",name:"oldVerifier",type:"address"},{indexed:!1,internalType:"contract ISafeSignatureVerifier",name:"newVerifier",type:"address"}],name:"ChangedDomainVerifier",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"contract Safe",name:"safe",type:"address"},{indexed:!1,internalType:"bytes4",name:"selector",type:"bytes4"},{indexed:!1,internalType:"bytes32",name:"oldMethod",type:"bytes32"},{indexed:!1,internalType:"bytes32",name:"newMethod",type:"bytes32"}],name:"ChangedSafeMethod",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"contract Safe",name:"safe",type:"address"},{indexed:!1,internalType:"bytes32",name:"domainSeparator",type:"bytes32"}],name:"RemovedDomainVerifier",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"contract Safe",name:"safe",type:"address"},{indexed:!1,internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"RemovedInterface",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"contract Safe",name:"safe",type:"address"},{indexed:!1,internalType:"bytes4",name:"selector",type:"bytes4"}],name:"RemovedSafeMethod",type:"event"},{stateMutability:"nonpayable",type:"fallback"},{inputs:[{internalType:"contract Safe",name:"",type:"address"},{internalType:"bytes32",name:"",type:"bytes32"}],name:"domainVerifiers",outputs:[{internalType:"contract ISafeSignatureVerifier",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"_hash",type:"bytes32"},{internalType:"bytes",name:"signature",type:"bytes"}],name:"isValidSignature",outputs:[{internalType:"bytes4",name:"magic",type:"bytes4"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"address",name:"",type:"address"},{internalType:"uint256[]",name:"",type:"uint256[]"},{internalType:"uint256[]",name:"",type:"uint256[]"},{internalType:"bytes",name:"",type:"bytes"}],name:"onERC1155BatchReceived",outputs:[{internalType:"bytes4",name:"",type:"bytes4"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"address",name:"",type:"address"},{internalType:"uint256",name:"",type:"uint256"},{internalType:"uint256",name:"",type:"uint256"},{internalType:"bytes",name:"",type:"bytes"}],name:"onERC1155Received",outputs:[{internalType:"bytes4",name:"",type:"bytes4"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"address",name:"",type:"address"},{internalType:"uint256",name:"",type:"uint256"},{internalType:"bytes",name:"",type:"bytes"}],name:"onERC721Received",outputs:[{internalType:"bytes4",name:"",type:"bytes4"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"contract Safe",name:"",type:"address"},{internalType:"bytes4",name:"",type:"bytes4"}],name:"safeInterfaces",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"contract Safe",name:"",type:"address"},{internalType:"bytes4",name:"",type:"bytes4"}],name:"safeMethods",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"domainSeparator",type:"bytes32"},{internalType:"contract ISafeSignatureVerifier",name:"newVerifier",type:"address"}],name:"setDomainVerifier",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"selector",type:"bytes4"},{internalType:"bytes32",name:"newMethod",type:"bytes32"}],name:"setSafeMethod",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"},{internalType:"bool",name:"supported",type:"bool"}],name:"setSupportedInterface",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"_interfaceId",type:"bytes4"},{internalType:"bytes32[]",name:"handlerWithSelectors",type:"bytes32[]"}],name:"setSupportedInterfaceBatch",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes4",name:"interfaceId",type:"bytes4"}],name:"supportsInterface",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"}];class ne{static createInterface(){return new a.utils.Interface(re)}static connect(e,t){return new a.Contract(e,re,t)}}ne.abi=re;var ae="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function oe(e){var t={exports:{}};return e(t,t.exports),t.exports}var se,ie=oe(function(e,t){var r=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r)return r;throw new Error("unable to locate global object")}();e.exports=t=r.fetch,r.fetch&&(t.default=r.fetch.bind(r)),t.Headers=r.Headers,t.Request=r.Request,t.Response=r.Response});exports.OrderKind=void 0,function(e){e.SELL="sell",e.BUY="buy"}(exports.OrderKind||(exports.OrderKind={})),exports.OrderBalance=void 0,(se=exports.OrderBalance||(exports.OrderBalance={})).ERC20="erc20",se.EXTERNAL="external",se.INTERNAL="internal";const de=[{name:"sellToken",type:"address"},{name:"buyToken",type:"address"},{name:"receiver",type:"address"},{name:"sellAmount",type:"uint256"},{name:"buyAmount",type:"uint256"},{name:"validTo",type:"uint32"},{name:"appData",type:"bytes32"},{name:"feeAmount",type:"uint256"},{name:"kind",type:"string"},{name:"partiallyFillable",type:"bool"},{name:"sellTokenBalance",type:"string"},{name:"buyTokenBalance",type:"string"}],ue=[{name:"orderUids",type:"bytes[]"}],ce=a.ethers.utils.id(`Order(${de.map(({name:e,type:t})=>`${t} ${e}`).join(",")})`);function pe(e){return"number"==typeof e?e:~~(e.getTime()/1e3)}function le(e){return"number"==typeof e?`0x${e.toString(16).padStart(64,"0")}`:a.ethers.utils.hexZeroPad(e,32)}function ye(e){switch(e){case void 0:case exports.OrderBalance.ERC20:case exports.OrderBalance.EXTERNAL:return exports.OrderBalance.ERC20;case exports.OrderBalance.INTERNAL:return exports.OrderBalance.INTERNAL;default:throw new Error(`invalid order balance ${e}`)}}function fe(e){var t,r;if(e.receiver===a.ethers.constants.AddressZero)throw new Error("receiver cannot be address(0)");return Object.assign(Object.assign({},e),{sellTokenBalance:null!==(t=e.sellTokenBalance)&&void 0!==t?t:exports.OrderBalance.ERC20,receiver:null!==(r=e.receiver)&&void 0!==r?r:a.ethers.constants.AddressZero,validTo:pe(e.validTo),appData:le(e.appData),buyTokenBalance:ye(e.buyTokenBalance)})}function me(e,t,r){return a.ethers.utils._TypedDataEncoder.hash(e,t,r)}function he(e,t){return me(e,{Order:de},fe(t))}function Te(e,t){return me(e,{OrderCancellations:ue},{orderUids:t})}function be({orderDigest:e,owner:t,validTo:r}){return a.ethers.utils.solidityPack(["bytes32","address","uint32"],[e,t,pe(r)])}function Ee(e){return Object.assign({value:0,callData:"0x"},e)}function xe(e){return"_signTypedData"in e}var Se=function(e,t,r,n){return new(r||(r=Promise))(function(a,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function i(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,i)}d((n=n.apply(e,t||[])).next())})};const Ae=a.ethers.utils.hexDataSlice(a.ethers.utils.id("isValidSignature(bytes32,bytes)"),0,4),Ie=a.ethers.utils.id("GPv2Signing.Scheme.PreSign");function Oe(e,t,r,n,o){return Se(this,void 0,void 0,function*(){let s=null;switch(e){case exports.SigningScheme.EIP712:if(!xe(t))throw new Error("signer does not support signing typed data");s=yield t._signTypedData(r,n,o);break;case exports.SigningScheme.ETHSIGN:s=yield t.signMessage(a.ethers.utils.arrayify(me(r,n,o)));break;default:throw new Error("invalid signing scheme")}return a.ethers.utils.joinSignature(a.ethers.utils.splitSignature(s))})}function ge(e,t,r,n){return Se(this,void 0,void 0,function*(){return{scheme:n,data:yield Oe(n,r,e,{Order:de},fe(t))}})}function ve(e,t,r,n){return Se(this,void 0,void 0,function*(){return{scheme:n,data:yield Oe(n,r,e,{OrderCancellations:ue},{orderUids:t})}})}function Pe({verifier:e,signature:t}){return a.ethers.utils.solidityPack(["address","bytes"],[e,t])}function Ne(e){const t=a.ethers.utils.arrayify(e);return{verifier:a.ethers.utils.getAddress(a.ethers.utils.hexlify(t.slice(0,20))),signature:t.slice(20)}}var Ce;exports.SigningScheme=void 0,function(e){e[e.EIP712=0]="EIP712",e[e.ETHSIGN=1]="ETHSIGN",e[e.EIP1271=2]="EIP1271",e[e.PRESIGN=3]="PRESIGN"}(exports.SigningScheme||(exports.SigningScheme={})),exports.InteractionStage=void 0,(Ce=exports.InteractionStage||(exports.InteractionStage={}))[Ce.PRE=0]="PRE",Ce[Ce.INTRA=1]="INTRA",Ce[Ce.POST=2]="POST";const _e={kind:{offset:0,options:[exports.OrderKind.SELL,exports.OrderKind.BUY]},partiallyFillable:{offset:1,options:[!1,!0]},sellTokenBalance:{offset:2,options:[exports.OrderBalance.ERC20,void 0,exports.OrderBalance.EXTERNAL,exports.OrderBalance.INTERNAL]},buyTokenBalance:{offset:4,options:[exports.OrderBalance.ERC20,exports.OrderBalance.INTERNAL]},signingScheme:{offset:5,options:[exports.SigningScheme.EIP712,exports.SigningScheme.ETHSIGN,exports.SigningScheme.EIP1271,exports.SigningScheme.PRESIGN]}};function De(e,t){const r=_e[e].options.findIndex(e=>e===t);if(void 0===r)throw new Error(`Bad key/value pair to encode: ${e}/${t}`);return r<<_e[e].offset}function Re(e,t){const{offset:r,options:n}=_e[e],o=a.BigNumber.from(t).toNumber(),s=o>>r&function(e){return(1<<32-Math.clz32(e.length-1))-1}(n),i=n[s];if(void 0===i||s<0)throw new Error(`Invalid input flag for ${e}: 0b${o.toString(2)}`);return i}function we(e){return De("signingScheme",e)}function Ue(e){return Re("signingScheme",e)}function Be(e){var t;return De("kind",e.kind)|De("partiallyFillable",e.partiallyFillable)|De("sellTokenBalance",null!==(t=e.sellTokenBalance)&&void 0!==t?t:exports.OrderBalance.ERC20)|De("buyTokenBalance",ye(e.buyTokenBalance))}function Le(e){return{kind:Re("kind",e),partiallyFillable:Re("partiallyFillable",e),sellTokenBalance:Re("sellTokenBalance",e),buyTokenBalance:Re("buyTokenBalance",e)}}function ke(e){return Be(e)|we(e.signingScheme)}function Fe(e){switch(e.scheme){case exports.SigningScheme.EIP712:case exports.SigningScheme.ETHSIGN:return a.ethers.utils.joinSignature(e.data);case exports.SigningScheme.EIP1271:return Pe(e.data);case exports.SigningScheme.PRESIGN:return a.ethers.utils.getAddress(e.data);default:throw new Error("unsupported signing scheme")}}function Me(e,t,r,{executedAmount:n}){const a=Object.assign(Object.assign({},t),{signingScheme:r.scheme}),o=fe(t);return{sellTokenIndex:e.index(o.sellToken),buyTokenIndex:e.index(o.buyToken),receiver:o.receiver,sellAmount:o.sellAmount,buyAmount:o.buyAmount,validTo:o.validTo,appData:o.appData,feeAmount:o.feeAmount,flags:ke(a),executedAmount:n,signature:Fe(r)}}class Ge{constructor(){this._tokens=[],this._tokenMap={}}get addresses(){return this._tokens.slice()}index(e){const t=a.ethers.utils.getAddress(e);let r=this._tokenMap[t];return void 0===r&&(r=this._tokens.length,this._tokens.push(t),this._tokenMap[t]=r),r}}class $e{constructor(e){this.domain=e,this._tokens=new Ge,this._trades=[],this._interactions={[exports.InteractionStage.PRE]:[],[exports.InteractionStage.INTRA]:[],[exports.InteractionStage.POST]:[]},this._orderRefunds={filledAmounts:[],preSignatures:[]}}get tokens(){return this._tokens.addresses}get trades(){return this._trades.slice()}get interactions(){return[this._interactions[exports.InteractionStage.PRE].slice(),this._interactions[exports.InteractionStage.INTRA].slice(),[...this._interactions[exports.InteractionStage.POST],...this.encodedOrderRefunds]]}get encodedOrderRefunds(){const{filledAmounts:e,preSignatures:t}=this._orderRefunds;if(e.length+t.length===0)return[];const r=this.domain.verifyingContract;if(void 0===r)throw new Error("domain missing settlement contract address");const n=new a.ethers.utils.Interface(["function freeFilledAmountStorage(bytes[] orderUids)","function freePreSignatureStorage(bytes[] orderUids)"]),o=[];for(const[a,s]of[["freeFilledAmountStorage",e],["freePreSignatureStorage",t]].filter(([,e])=>e.length>0))o.push(Ee({target:r,callData:n.encodeFunctionData(a,[s])}));return o}clearingPrices(e){return this.tokens.map(t=>{const r=e[t];if(void 0===r)throw new Error(`missing price for token ${t}`);return r})}encodeTrade(e,t,{executedAmount:r}={}){if(e.partiallyFillable&&void 0===r)throw new Error("missing executed amount for partially fillable trade");this._trades.push(Me(this._tokens,e,t,{executedAmount:null!=r?r:0}))}signEncodeTrade(e,t,r,n){return a=this,s=function*(){const a=yield ge(this.domain,e,t,r);this.encodeTrade(e,a,n)},new((o=void 0)||(o=Promise))(function(e,t){function r(e){try{i(s.next(e))}catch(e){t(e)}}function n(e){try{i(s.throw(e))}catch(e){t(e)}}function i(t){var a;t.done?e(t.value):(a=t.value,a instanceof o?a:new o(function(e){e(a)})).then(r,n)}i((s=s.apply(a,[])).next())});var a,o,s}encodeInteraction(e,t=exports.InteractionStage.INTRA){this._interactions[t].push(Ee(e))}encodeOrderRefunds(e){var t,r;if(void 0===this.domain.verifyingContract)throw new Error("domain missing settlement contract address");const n=null!==(t=e.filledAmounts)&&void 0!==t?t:[],o=null!==(r=e.preSignatures)&&void 0!==r?r:[];if(![...n,...o].every(e=>a.ethers.utils.isHexString(e,56)))throw new Error("one or more invalid order UIDs");this._orderRefunds.filledAmounts.push(...n),this._orderRefunds.preSignatures.push(...o)}encodedSettlement(e){return[this.tokens,this.clearingPrices(e),this.trades,this.interactions]}static encodedSetup(...e){const t=new $e({name:"unused"});for(const r of e)t.encodeInteraction(r);return t.encodedSettlement({})}}var He,Ve,je,We=function(e,t,r,n){return new(r||(r=Promise))(function(a,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function i(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,i)}d((n=n.apply(e,t||[])).next())})};function Ke(e,t){switch(e){case exports.Environment.Dev:return`https://barn.api.cow.fi/${t}`;case exports.Environment.Prod:return`https://api.cow.fi/${t}`;default:throw new Error("Invalid environment")}}function Ye(e){switch(e){case exports.OrderKind.SELL:return"sell";case exports.OrderKind.BUY:return"buy";default:throw new Error(`Unsupported kind ${e}`)}}function Qe(e){switch(e){case exports.SigningScheme.EIP712:return"eip712";case exports.SigningScheme.ETHSIGN:return"ethsign";case exports.SigningScheme.EIP1271:return"eip1271";case exports.SigningScheme.PRESIGN:return"presign";default:throw new Error(`Unsupported signing scheme ${e}`)}}function qe(e,t,r){return We(this,void 0,void 0,function*(){const n=`${t}/api/v1/${e}`,a=yield ie(n,r),o=yield a.text();if(!a.ok){const e=new Error(`Calling "${n} ${JSON.stringify(r)} failed with ${a.status}: ${o}`);try{e.apiError=JSON.parse(o)}catch(e){}throw e}return JSON.parse(o)})}function Xe({baseUrl:e},t){return We(this,void 0,void 0,function*(){return t.sellAmountBeforeFee&&(t.sellAmountBeforeFee=t.sellAmountBeforeFee.toString()),t.sellAmountAfterFee&&(t.sellAmountAfterFee=t.sellAmountAfterFee.toString()),t.buyAmountAfterFee&&(t.buyAmountAfterFee=t.buyAmountAfterFee.toString()),qe("quote",e,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})})}exports.Environment=void 0,(He=exports.Environment||(exports.Environment={}))[He.Dev=0]="Dev",He[He.Prod=1]="Prod",exports.QuotePriceQuality=void 0,(Ve=exports.QuotePriceQuality||(exports.QuotePriceQuality={})).FAST="fast",Ve.OPTIMAL="optimal",exports.GetQuoteErrorType=void 0,(je=exports.GetQuoteErrorType||(exports.GetQuoteErrorType={})).SellAmountDoesNotCoverFee="SellAmountDoesNotCoverFee",je.NoLiquidity="NoLiquidity";const Ze=a.utils.formatBytes32String("Mattresses in Berlin!"),ze="0x4e59b44847b379578588920ca78fbf26c0b4956c";var Je=function(e,t,r,n){return new(r||(r=Promise))(function(a,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function i(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,i)}d((n=n.apply(e,t||[])).next())})};function et(e){return a.ethers.utils.defaultAbiCoder.encode(["bytes32"],[a.BigNumber.from(a.ethers.utils.id(e)).sub(1)])}const tt=et("eip1967.proxy.implementation"),rt=et("eip1967.proxy.admin"),nt=["event OwnershipTransferred(address indexed previousOwner, address indexed newOwner)","function owner() view external returns(address)","function transferOwnership(address newOwner) external","function supportsInterface(bytes4 interfaceID) external view returns (bool)"],at=new a.ethers.utils.Interface(["function manageUserBalance((uint8, address, uint256, address, address)[])","function batchSwap(uint8, (bytes32, uint256, uint256, uint256, bytes)[], address[], (address, bool, address, bool), int256[], uint256)"]),ot=function(e){try{return Promise.resolve(e.getBlock("latest")).then(function(e){return{blockNumber:e.number,blockTimestamp:e.timestamp}})}catch(e){return Promise.reject(e)}},st=["erc20","0x5a28e9363bb942b639270062aa6bb295f434bcdfc42c97267bf003f272060dc9"],it=["external","0xabee3b73373acd583a130924aad6dc38cfdc44ba0555ba94ce2ff63980ea0632"],dt=["internal","0x4ac99ace14ee0a5ef932dc609df0943ab7ac16b7583634612f8dc35a4289a6ce"],ut=["sell","0xf3b277728b3fee749481eb3e0b3b48980dbbab78658fc419025cb16eee346775"],ct=["buy","0x6ed88e868af0a1983e3886d5f3e95a2fafbd6c3450bc229e27342283dc429ccc"],pt=["tuple(address handler, bytes32 salt, bytes staticInput)"];function lt(e){return a.utils.defaultAbiCoder.encode(pt,[e])}function yt(e){const{handler:t,salt:r,staticInput:n}=a.utils.defaultAbiCoder.decode(pt,e)[0];return{handler:t,salt:r,staticInput:n}}function ft(e,t){try{a.utils.defaultAbiCoder.encode(e,t)}catch(e){return!1}return!0}function mt(e){return new Date(1e3*e).toISOString()}function ht(e){if(st.includes(e))return exports.OrderBalance.ERC20;if(it.includes(e))return exports.OrderBalance.EXTERNAL;if(dt.includes(e))return exports.OrderBalance.INTERNAL;throw new Error(`Unknown balance type: ${e}`)}function Tt(e){if(ut.includes(e))return exports.OrderKind.SELL;if(ct.includes(e))return exports.OrderKind.BUY;throw new Error(`Unknown kind: ${e}`)}function bt(e){const{sellToken:t,sellAmount:r,buyToken:n,buyAmount:a,buyTokenBalance:o,sellTokenBalance:s,feeAmount:i,kind:d,receiver:u,validTo:c,partiallyFillable:p,appData:l}=e;return{sellToken:t,sellAmount:r,buyToken:n,buyAmount:a,feeAmount:i,receiver:u,partiallyFillable:p,appData:l,validTo:Number(c),kind:Tt(d.toString()),sellTokenBalance:ht(s.toString()),buyTokenBalance:ht(o.toString())}}let Et,xt;function St(){return Et||(Et=te.createInterface()),Et}function At(e,t){return xt||(xt=te.connect(T[e],t)),xt}const It={};class Ot{constructor(e){this.handler=void 0,this.salt=void 0,this.data=void 0,this.staticInput=void 0,this.hasOffChainInput=void 0;const{handler:t,salt:r=a.utils.keccak256(a.utils.randomBytes(32)),data:n,hasOffChainInput:o=!1}=e;if(!a.ethers.utils.isAddress(t))throw new Error(`Invalid handler: ${t}`);if(!a.ethers.utils.isHexString(r)||32!==a.ethers.utils.hexDataLength(r))throw new Error(`Invalid salt: ${r}`);this.handler=t,this.salt=r,this.data=n,this.staticInput=this.transformDataToStruct(n),this.hasOffChainInput=o}get context(){}assertIsValid(){const e=this.isValid();if(!e.isValid)throw new Error(`Invalid order: ${e.reason}`)}get createCalldata(){this.assertIsValid();const e=this.context,t=St(),r={handler:this.handler,salt:this.salt,staticInput:this.encodeStaticInput()};if(e){const n=e.factoryArgs?a.utils.defaultAbiCoder.encode(e.factoryArgs.argsType,e.factoryArgs.args):"0x";return t.encodeFunctionData("createWithContext",[r,e.address,n,!0])}return t.encodeFunctionData("create",[r,!0])}get removeCalldata(){return this.assertIsValid(),St().encodeFunctionData("remove",[this.id])}get id(){return a.utils.keccak256(this.serialize())}get ctx(){return this.isSingleOrder?this.id:a.constants.HashZero}get leaf(){return{handler:this.handler,salt:this.salt,staticInput:this.encodeStaticInput()}}static leafToId(e){return a.utils.keccak256(lt(e))}get offChainInput(){return"0x"}encodeStaticInputHelper(e,t){return a.utils.defaultAbiCoder.encode(e,[t])}poll(e){try{const t=this,{chainId:r,owner:n,provider:a,orderbookApiConfig:o}=e,s=At(r,a);return Promise.resolve(function(a,i){try{var d=function(){const a=t.isValid();return a.isValid?Promise.resolve(t.pollValidate(e)).then(function(a){return a||Promise.resolve(t.isAuthorized(e)).then(function(a){return a?Promise.resolve(s.getTradeableOrderWithSignature(n,t.leaf,t.offChainInput,[])).then(function([a,s]){let i=It[r];return i||(i=new N({...o,chainId:r}),It[r]=i),Promise.resolve(function(e,t,r){try{return Promise.resolve(Promise.resolve().then(function(){return require("./index-8256d5ba.js")})).then(function({computeOrderUid:n}){return Promise.resolve(Z.getDomain(e)).then(function(e){return n(e,r,t)})})}catch(e){return Promise.reject(e)}}(r,n,bt(a))).then(function(r){return Promise.resolve(i.getOrder(r).then(()=>!0).catch(()=>!1)).then(function(n){let o;function i(e){return o?e:{result:exports.PollResultCode.SUCCESS,order:a,signature:s}}const d=function(){if(n)return Promise.resolve(t.handlePollFailedAlreadyPresent(r,a,e)).then(function(e){if(e)return o=1,e;const t={result:exports.PollResultCode.TRY_NEXT_BLOCK,reason:"Order already in orderbook"};return o=1,t})}();return d&&d.then?d.then(i):i(d)})})}):{result:exports.PollResultCode.DONT_TRY_AGAIN,reason:`NotAuthorized: Order ${t.id} is not authorized for ${n} on chain ${r}`}})}):{result:exports.PollResultCode.DONT_TRY_AGAIN,reason:`InvalidConditionalOrder. Reason: ${a.reason}`}}()}catch(e){return i(e)}return d&&d.then?d.then(void 0,i):d}(0,function(e){return{result:exports.PollResultCode.UNEXPECTED_ERROR,error:e}}))}catch(e){return Promise.reject(e)}}isAuthorized(e){const{chainId:t,owner:r,provider:n}=e;return At(t,n).callStatic.singleOrders(r,this.id)}cabinet(e){const{chainId:t,owner:r,provider:n}=e;return At(t,n).callStatic.cabinet(r,this.ctx)}static deserializeHelper(e,t,r,n){try{const{handler:o,salt:s,staticInput:i}=yt(e);if(o!=t)throw new Error("HandlerMismatch");const[d]=a.utils.defaultAbiCoder.decode(r,i);return n(d,s)}catch(e){throw"HandlerMismatch"===e.message?e:new Error("InvalidSerializedConditionalOrder")}}}const gt=["address","bytes32","bytes"],vt=["tuple(bytes32[] proof, tuple(address handler, bytes32 salt, bytes staticInput) params)[]"];class Pt{constructor(e,t,r,n=exports.ProofLocation.PRIVATE){if(this.chain=void 0,this.location=void 0,this.orders={},this.tree=void 0,this.ctx=void 0,this.chain=e,this.location=n,t&&0===Object.keys(t).length)throw new Error("orders must have non-zero length");if(t&&!r||!t&&r)throw new Error("orders cannot have undefined root");for(const e in t)if(t.hasOwnProperty(e)){const r=t[e];if(!Pt.orderTypeRegistry.hasOwnProperty(r.orderType))throw new Error(`Unknown order type: ${r.orderType}`)}if(t&&(this.orders=t,this.getOrGenerateTree().root!==r))throw new Error("root mismatch")}static fromJSON(e){const{chain:t,orders:r,root:n,location:o}=JSON.parse(e,(e,t)=>{if("orders"===e&&"object"==typeof t&&null!==t){const e={};for(const r in t)if(t.hasOwnProperty(r)){const{orderType:n,...a}=t[r];if(!Pt.orderTypeRegistry.hasOwnProperty(n))throw new Error(`Unknown order type: ${n}`);e[r]=new(0,Pt.orderTypeRegistry[n])(a)}return e}return"object"==typeof t&&null!==t&&t.hasOwnProperty("type")&&t.hasOwnProperty("hex")&&"BigNumber"===t.type?a.BigNumber.from(t):t}),s=new Pt(t,r,n);return s.location=o,s}toJSON(){const e=this.getOrGenerateTree().root;return JSON.stringify({...this,root:e},(e,t)=>{if("tree"!==e){if("object"==typeof t&&null!==t&&"orderType"in t){const e=t;return{...e,orderType:e.orderType}}return t}})}add(e){e.assertIsValid(),this.orders[e.id]=e,this.reset()}remove(e){delete this.orders[e],this.reset()}update(e,t){const r=t(this.orders[e],this.ctx);delete this.orders[e],this.orders[r.id]=r,this.reset()}getById(e){return this.orders[e]}getByIndex(e){return this.orders[this.orderIds[e]]}get orderIds(){return Object.keys(this.orders)}get root(){return this.getOrGenerateTree().root}getOrGenerateTree(){return this.tree||(this.tree=o.StandardMerkleTree.of(Object.values(this.orders).map(e=>[...Object.values(e.leaf)]),gt)),this.tree}static decodeFromJSON(e){return JSON.parse(e)}prepareProofStruct(e,t,r){try{const n=this;void 0===e&&(e=n.location);const o=function(){try{switch(e){case exports.ProofLocation.PRIVATE:return Promise.resolve("0x");case exports.ProofLocation.EMITTED:return Promise.resolve(n.encodeToABI(t));case exports.ProofLocation.SWARM:case exports.ProofLocation.WAKU:case exports.ProofLocation.IPFS:if(!r)throw new Error("Must provide an uploader function");return Promise.resolve(function(e,a){try{var o=Promise.resolve(r(n.encodeToJSON(t)))}catch(e){return a(e)}return o&&o.then?o.then(void 0,a):o}(0,function(t){throw new Error(`Error uploading to decentralized storage ${e}: ${t}`)}));default:throw new Error("Unsupported location")}}catch(e){return Promise.reject(e)}};return Promise.resolve(o().then(t=>{try{return a.utils.hexlify(a.utils.arrayify(t)),n.location=e,{location:e,data:t}}catch(e){throw new Error("data returned by uploader is invalid")}}).catch(e=>{throw new Error(`Error preparing proof struct: ${e}`)}))}catch(e){return Promise.reject(e)}}static poll(e,t,r,n,a){try{function o(r){return Promise.resolve(s.getTradeableOrderWithSignature(e,t.params,r,t.proof))}const s=At(r,n);return Promise.resolve(a?Promise.resolve(a(e,t.params)).then(o):o("0x"))}catch(i){return Promise.reject(i)}}dumpProofs(e){return this.encodeToJSON(e)}dumpProofsAndParams(e){return this.getProofs(e)}getProofs(e){return[...this.getOrGenerateTree().entries()].map(([t,r])=>e&&e(r)||void 0===e?{idx:t,value:r}:void 0).reduce((e,t)=>{if(t){const r={handler:t.value[0],salt:t.value[1],staticInput:t.value[2]};e.push({proof:this.getOrGenerateTree().getProof(t.idx),params:r})}return e},[])}encodeToABI(e){return a.utils.defaultAbiCoder.encode(vt,[this.getProofs(e)])}encodeToJSON(e){return JSON.stringify(this.getProofs(e))}reset(){this.tree=void 0}static registerOrderType(e,t){Pt.orderTypeRegistry[e]=t}static resetOrderTypeRegistry(){Pt.orderTypeRegistry={}}}Pt.orderTypeRegistry={};const Nt="0x6cF1e9cA41f7611dEf408122793c358a3d11E5a5",Ct="0x52eD56Da04309Aca4c3FECC595298d80C2f16BAc",_t=a.BigNumber.from(2).pow(32).sub(1),Dt=a.BigNumber.from(31536e3),Rt=["tuple(address sellToken, address buyToken, address receiver, uint256 partSellAmount, uint256 minPartLimit, uint256 t0, uint256 n, uint256 t, uint256 span, bytes32 appData)"];var wt,Ut;exports.DurationType=void 0,(wt=exports.DurationType||(exports.DurationType={})).AUTO="AUTO",wt.LIMIT_DURATION="LIMIT_DURATION",exports.StartTimeValue=void 0,(Ut=exports.StartTimeValue||(exports.StartTimeValue={})).AT_MINING_TIME="AT_MINING_TIME",Ut.AT_EPOCH="AT_EPOCH";const Bt={startType:exports.StartTimeValue.AT_MINING_TIME},Lt={durationType:exports.DurationType.AUTO};class kt extends Ot{constructor(e){const{handler:t,salt:r,data:n,hasOffChainInput:a}=e;if(t!==Nt)throw new Error(`InvalidHandler: Expected: ${Nt}, provided: ${t}`);super({handler:Nt,salt:r,data:n,hasOffChainInput:a}),this.isSingleOrder=!0}static fromData(e,t){return new kt({handler:Nt,data:e,salt:t})}static fromParams(e){return kt.deserialize(lt(e))}get context(){return this.staticInput.t0.gt(0)?super.context:{address:Ct,factoryArgs:void 0}}get orderType(){return"twap"}isValid(){const e=(()=>{const{sellToken:e,sellAmount:t,buyToken:r,buyAmount:n,startTime:o=Bt,numberOfParts:s,timeBetweenParts:i,durationOfPart:d=Lt}=this.data;if(e==r)return"InvalidSameToken";if(e==a.constants.AddressZero||r==a.constants.AddressZero)return"InvalidToken";if(!t.gt(a.constants.Zero))return"InvalidSellAmount";if(!n.gt(a.constants.Zero))return"InvalidMinBuyAmount";if(o.startType===exports.StartTimeValue.AT_EPOCH){const e=o.epoch;if(!e.gte(a.constants.Zero)||!e.lt(_t))return"InvalidStartTime"}return s.gt(a.constants.One)&&s.lte(_t)?i.gt(a.constants.Zero)&&i.lte(Dt)?d.durationType!==exports.DurationType.LIMIT_DURATION||d.duration.lte(i)?ft(Rt,[this.staticInput])?void 0:"InvalidData":"InvalidSpan":"InvalidFrequency":"InvalidNumParts"})();return e?{isValid:!1,reason:e}:{isValid:!0}}startTimestamp(e){try{const t=this,{startTime:r}=t.data;return r?.startType===exports.StartTimeValue.AT_EPOCH?Promise.resolve(r.epoch.toNumber()):Promise.resolve(t.cabinet(e)).then(function(e){const t=a.utils.defaultAbiCoder.decode(["uint256"],e)[0];if(t.gt(_t))throw new Error(`Cabinet epoch out of range: ${t.toString()}`);const r=t.toNumber();if(0===r)throw new Error("Cabinet is not set. Required for TWAP orders that start at mining time.");return r})}catch(e){return Promise.reject(e)}}endTimestamp(e){const{numberOfParts:t,timeBetweenParts:r,durationOfPart:n}=this.data;return n&&n.durationType===exports.DurationType.LIMIT_DURATION?e+t.sub(1).mul(r).add(n.duration).toNumber():e+t.mul(r).toNumber()}pollValidate(e){try{const t=this;return Promise.resolve(ot(e.provider)).then(function(r){const{blockInfo:n=r}=e,{blockTimestamp:a}=n;return function(r,n){try{var o=Promise.resolve(t.startTimestamp(e)).then(function(e){if(e>a)return{result:exports.PollResultCode.TRY_AT_EPOCH,epoch:e,reason:`TWAP hasn't started yet. Starts at ${e} (${mt(e)})`};const r=t.endTimestamp(e);return a>=r?{result:exports.PollResultCode.DONT_TRY_AGAIN,reason:`TWAP has expired. Expired at ${r} (${mt(r)})`}:void 0})}catch(e){return n(e)}return o&&o.then?o.then(void 0,n):o}(0,function(e){return e?.message?.includes("Cabinet is not set")?{result:exports.PollResultCode.DONT_TRY_AGAIN,reason:`${e?.message}. User likely removed the order.`}:e?.message?.includes("Cabinet epoch out of range")?{result:exports.PollResultCode.DONT_TRY_AGAIN,reason:`${e?.message}`}:{result:exports.PollResultCode.UNEXPECTED_ERROR,reason:`Unexpected error: ${e.message}`,error:e}})})}catch(e){return Promise.reject(e)}}handlePollFailedAlreadyPresent(e,t,r){try{const e=this;return Promise.resolve(ot(r.provider)).then(function(t){const{blockInfo:n=t}=r,{blockTimestamp:a}=n,o=e.data.timeBetweenParts.toNumber(),{numberOfParts:s}=e.data;return Promise.resolve(e.startTimestamp(r)).then(function(e){if(a<e)return{result:exports.PollResultCode.UNEXPECTED_ERROR,reason:`TWAP part hash't started. First TWAP part start at ${e} (${mt(e)})`,error:void 0};const t=s.mul(o).add(e).toNumber();if(a>=t)return{result:exports.PollResultCode.UNEXPECTED_ERROR,reason:`TWAP is expired. Expired at ${t} (${mt(t)})`,error:void 0};const r=Math.floor((a-e)/o);if(r===s.toNumber()-1)return{result:exports.PollResultCode.DONT_TRY_AGAIN,reason:`Current active TWAP part (${r+1}/${s}) is already in the Order Book. This was the last TWAP part, no more orders need to be placed`};const n=e+(r+1)*o;return{result:exports.PollResultCode.TRY_AT_EPOCH,epoch:n,reason:`Current active TWAP part (${r+1}/${s}) is already in the Order Book. TWAP part ${r+2} doesn't start until ${n} (${mt(n)})`}})})}catch(e){return Promise.reject(e)}}serialize(){return lt(this.leaf)}encodeStaticInput(){return super.encodeStaticInputHelper(Rt,this.staticInput)}static deserialize(e){return super.deserializeHelper(e,Nt,Rt,(e,t)=>new kt({handler:Nt,salt:t,data:Mt(e)}))}toString(){const{sellAmount:e,sellToken:t,buyAmount:r,buyToken:n,numberOfParts:a,startTime:o=Bt,timeBetweenParts:s,durationOfPart:i=Lt,receiver:d,appData:u}=this.data,c=o.startType===exports.StartTimeValue.AT_MINING_TIME?"AT_MINING_TIME":o.epoch.toNumber(),p=i.durationType===exports.DurationType.AUTO?"AUTO":i.duration.toNumber(),l={sellAmount:e.toString(),sellToken:t,buyAmount:r.toString(),buyToken:n,numberOfParts:a.toString(),startTime:c,timeBetweenParts:s.toNumber(),durationOfPart:p,receiver:d,appData:u};return`${this.orderType} (${this.id}): ${JSON.stringify(l)}`}transformDataToStruct(e){return Ft(e)}transformStructToData(e){return Mt(e)}}function Ft(e){const{sellAmount:t,buyAmount:r,numberOfParts:n,startTime:o=Bt,timeBetweenParts:s,durationOfPart:i=Lt,...d}=e,{partSellAmount:u,minPartLimit:c}=n&&!n.isZero()?{partSellAmount:t.div(n),minPartLimit:r.div(n)}:{partSellAmount:a.constants.Zero,minPartLimit:a.constants.Zero},p=i.durationType===exports.DurationType.AUTO?a.constants.Zero:i.duration;return{partSellAmount:u,minPartLimit:c,t0:o.startType===exports.StartTimeValue.AT_MINING_TIME?a.constants.Zero:o.epoch,n:n,t:s,span:p,...d}}function Mt(e){const{n:t,partSellAmount:r,minPartLimit:n,t:a,t0:o,span:s,...i}=e,d=s.isZero()?{durationType:exports.DurationType.AUTO}:{durationType:exports.DurationType.LIMIT_DURATION,duration:s},u=s.isZero()?{startType:exports.StartTimeValue.AT_MINING_TIME}:{startType:exports.StartTimeValue.AT_EPOCH,epoch:o};return{sellAmount:r.mul(t),buyAmount:n.mul(t),startTime:u,numberOfParts:t,timeBetweenParts:a,durationOfPart:d,...i}}const Gt={[Nt]:e=>kt.fromParams(e)};exports.ALL_SUPPORTED_CHAIN_IDS=f,exports.Api=class{constructor(e,t){let r;this.network=e,r="string"==typeof t?t:Ke(t,e),this.baseUrl=r}apiCallParams(){return{network:this.network,baseUrl:this.baseUrl}}estimateTradeAmount(e){return We(this,void 0,void 0,function*(){return function({sellToken:e,buyToken:t,kind:r,amount:n,baseUrl:o}){return We(this,void 0,void 0,function*(){const s=r==exports.OrderKind.SELL?{kind:exports.OrderKind.SELL,sellAmountAfterFee:n}:{kind:exports.OrderKind.BUY,buyAmountAfterFee:n},{quote:i}=yield Xe({baseUrl:o},Object.assign({from:a.constants.AddressZero,sellToken:e,buyToken:t,priceQuality:exports.QuotePriceQuality.FAST},s));if(i.buyToken.toLowerCase()!==t.toLowerCase())throw new Error(`Price returned for sell token ${e} uses an incorrect quote token (${i.buyToken.toLowerCase()} instead of ${t.toLowerCase()})`);const d=r==exports.OrderKind.SELL?i.buyAmount:i.sellAmount;return a.BigNumber.from(d)})}(Object.assign(Object.assign({},this.apiCallParams()),e))})}placeOrder(e){return We(this,void 0,void 0,function*(){return function({order:e,signature:t,baseUrl:r,from:n}){return We(this,void 0,void 0,function*(){const o=fe(e);return yield qe("orders",r,{method:"post",body:JSON.stringify({sellToken:o.sellToken,buyToken:o.buyToken,sellAmount:a.BigNumber.from(o.sellAmount).toString(),buyAmount:a.BigNumber.from(o.buyAmount).toString(),validTo:o.validTo,appData:o.appData,feeAmount:a.BigNumber.from(o.feeAmount).toString(),kind:Ye(e.kind),partiallyFillable:o.partiallyFillable,signature:Fe(t),signingScheme:Qe(t.scheme),receiver:o.receiver,from:n}),headers:{"Content-Type":"application/json"}})})}(Object.assign(Object.assign({},this.apiCallParams()),e))})}getExecutedSellAmount(e){return We(this,void 0,void 0,function*(){return function({uid:e,baseUrl:t}){return We(this,void 0,void 0,function*(){const r=yield qe(`orders/${e}`,t);return a.BigNumber.from(r.executedSellAmount)})}(Object.assign(Object.assign({},this.apiCallParams()),e))})}getQuote(e){return We(this,void 0,void 0,function*(){return Xe(this.apiCallParams(),e)})}},exports.BUY_ETH_ADDRESS="0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE",exports.BUY_ETH_ADDRESS$1=p,exports.CANCELLATIONS_TYPE_FIELDS=ue,exports.COMPOSABLE_COW=y,exports.COMPOSABLE_COW_CONTRACT_ADDRESS=T,exports.CONDITIONAL_ORDER_PARAMS_ABI=pt,exports.CONTRACT_NAMES={authenticator:"GPv2AllowListAuthentication",settlement:"GPv2Settlement",tradeSimulator:"GPv2TradeSimulator"},exports.COW_PROTOCOL_SETTLEMENT_CONTRACT_ADDRESS=m,exports.CURRENT_BLOCK_TIMESTAMP_FACTORY_ADDRESS=Ct,exports.ConditionalOrder=Ot,exports.ConditionalOrderFactory=class{constructor(e){this.knownOrderTypes=void 0,this.knownOrderTypes=e}fromParams(e){const{handler:t}=e,r=this.knownOrderTypes[t];if(r)return r(e)}},exports.CowError=u,exports.DEFAULT_BACKOFF_OPTIONS=A,exports.DEFAULT_CONDITIONAL_ORDER_REGISTRY=Gt,exports.DEFAULT_COW_API_CONTEXT=d,exports.DEFAULT_IPFS_READ_URI="https://gnosis.mypinata.cloud/ipfs",exports.DEFAULT_IPFS_WRITE_URI="https://api.pinata.cloud",exports.DEFAULT_LIMITER_OPTIONS=I,exports.DEFAULT_TOKEN_FORMATTER=(e,t)=>`${t}@${e}`,exports.DEPLOYER_CONTRACT=ze,exports.EIP1271_MAGICVALUE=Ae,exports.EIP173_PROXY_ABI=nt,exports.ENVS_LIST=i,exports.EXTENSIBLE_FALLBACK_HANDLER=l,exports.EXTENSIBLE_FALLBACK_HANDLER_CONTRACT_ADDRESS=h,exports.FLAG_MASKS=_e,exports.LIMIT_CONCURRENT_REQUESTS=5,exports.MAX_FREQUENCY=Dt,exports.MAX_UINT32=_t,exports.Multiplexer=Pt,exports.ORDER_BOOK_PROD_CONFIG=g,exports.ORDER_BOOK_STAGING_CONFIG=v,exports.ORDER_TYPE_FIELDS=de,exports.ORDER_TYPE_HASH=ce,exports.ORDER_UID_LENGTH=56,exports.OrderBookApi=N,exports.OrderBookApiError=x,exports.OrderSigningUtils=Z,exports.PRE_SIGNED=Ie,exports.SALT=Ze,exports.SUBGRAPH_PROD_CONFIG=Q,exports.SUBGRAPH_STAGING_CONFIG=q,exports.SettlementEncoder=$e,exports.SubgraphApi=class{constructor(e={}){this.API_NAME="CoW Protocol Subgraph",this.context=void 0,this.context={...d,...e}}getTotals(e={}){try{return Promise.resolve(this.runQuery(j,void 0,e)).then(function(e){return e.totals[0]})}catch(e){return Promise.reject(e)}}getLastDaysVolume(e,t={}){try{return Promise.resolve(this.runQuery(W,{days:e},t))}catch(e){return Promise.reject(e)}}getLastHoursVolume(e,t={}){try{return Promise.resolve(this.runQuery(K,{hours:e},t))}catch(e){return Promise.reject(e)}}runQuery(e,t=undefined,r={}){try{const a=this,{chainId:o,env:s}=a.getContextWithOverride(r),i=a.getEnvConfigs(s)[o];return Promise.resolve(function(r,a){try{var o=Promise.resolve(n.request(i,e,t))}catch(e){return a(e)}return o&&o.then?o.then(void 0,a):o}(0,function(r){throw console.error(`[subgraph:${a.API_NAME}]`,r),new u(`Error running query: ${e}. Variables: ${JSON.stringify(t)}. API: ${i}. Inner Error: ${r}`)}))}catch(e){return Promise.reject(e)}}getContextWithOverride(e={}){return{...this.context,...e}}getEnvConfigs(e){return this.context.baseUrls?this.context.baseUrls:"prod"===e?Q:q}},exports.TWAP_ADDRESS=Nt,exports.TokenRegistry=Ge,exports.Twap=kt,exports.VAULT_INTERFACE=at,exports.apiUrl=Ke,exports.commonjsGlobal=ae,exports.computeOrderUid=function(e,t,r){return be({orderDigest:he(e,t),owner:r,validTo:t.validTo})},exports.createCommonjsModule=oe,exports.createSetDomainVerifierTx=function(e,t){return ne.createInterface().encodeFunctionData("setDomainVerifier",[e,t])},exports.decodeEip1271SignatureData=Ne,exports.decodeOrder=function(e,t){const r=a.BigNumber.from(e.sellTokenIndex).toNumber(),n=a.BigNumber.from(e.buyTokenIndex).toNumber();if(Math.max(r,n)>=t.length)throw new Error("Invalid trade");return Object.assign({sellToken:t[r],buyToken:t[n],receiver:e.receiver,sellAmount:e.sellAmount,buyAmount:e.buyAmount,validTo:a.BigNumber.from(e.validTo).toNumber(),appData:e.appData,feeAmount:e.feeAmount},Le(e.flags))},exports.decodeOrderFlags=Le,exports.decodeParams=yt,exports.decodeSignatureOwner=function(e,t,r,n){switch(r){case exports.SigningScheme.EIP712:return a.ethers.utils.verifyTypedData(e,{Order:de},fe(t),n);case exports.SigningScheme.ETHSIGN:return a.ethers.utils.verifyMessage(a.ethers.utils.arrayify(me(e,{Order:de},fe(t))),n);case exports.SigningScheme.EIP1271:return Ne(n).verifier;case exports.SigningScheme.PRESIGN:return a.ethers.utils.getAddress(a.ethers.utils.hexlify(n));default:throw new Error("unsupported signing scheme")}},exports.decodeSigningScheme=Ue,exports.decodeTradeFlags=function(e){return Object.assign(Object.assign({},Le(e)),{signingScheme:Ue(e)})},exports.deterministicDeploymentAddress=function({abi:e,bytecode:t},r){const n=new a.utils.Interface(e),o=a.utils.hexConcat([t,n.encodeDeploy(r)]);return a.utils.getCreate2Address(ze,Ze,a.utils.keccak256(o))},exports.encodeEip1271SignatureData=Pe,exports.encodeOrderFlags=Be,exports.encodeParams=lt,exports.encodeSignatureData=Fe,exports.encodeSigningScheme=we,exports.encodeTrade=Me,exports.encodeTradeFlags=ke,exports.extractOrderUidParams=function(e){const t=a.ethers.utils.arrayify(e);if(56!=t.length)throw new Error("invalid order UID length");const r=new DataView(t.buffer);return{orderDigest:a.ethers.utils.hexlify(t.subarray(0,32)),owner:a.ethers.utils.getAddress(a.ethers.utils.hexlify(t.subarray(32,52))),validTo:r.getUint32(52)}},exports.formatEpoch=mt,exports.fromStructToOrder=bt,exports.getBlockInfo=ot,exports.getDomainVerifier=function(e,t,r,n){try{const a=ne.connect(h[r],n);return Promise.resolve(a.callStatic.domainVerifiers(e,t))}catch(e){return Promise.reject(e)}},exports.grantRequiredRoles=function(e,t,r){return n=this,s=function*(){for(const n in at.functions)yield e.grantRole(a.ethers.utils.solidityKeccak256(["uint256","bytes4"],[t,at.getSighash(n)]),r)},new((o=void 0)||(o=Promise))(function(e,t){function r(e){try{i(s.next(e))}catch(e){t(e)}}function a(e){try{i(s.throw(e))}catch(e){t(e)}}function i(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o(function(e){e(n)})).then(r,a)}i((s=s.apply(n,[])).next())});var n,o,s},exports.hashOrder=he,exports.hashOrderCancellation=function(e,t){return Te(e,[t])},exports.hashOrderCancellations=Te,exports.hashTypedData=me,exports.hashify=le,exports.implementationAddress=function(e,t){return Je(this,void 0,void 0,function*(){const[r]=a.ethers.utils.defaultAbiCoder.decode(["address"],yield e.getStorageAt(t,tt));return r})},exports.isComposableCow=function(e,t){return e===T[t]},exports.isExtensibleFallbackHandler=function(e,t){return e===h[t]},exports.isJsonRpcProvider=function(e){return"send"in e},exports.isTypedDataSigner=xe,exports.isValidAbi=ft,exports.logPrefix="cow-sdk:",exports.normalizeBuyTokenBalance=ye,exports.normalizeInteraction=Ee,exports.normalizeInteractions=function(e){return e.map(Ee)},exports.normalizeOrder=fe,exports.ownerAddress=function(e,t){return Je(this,void 0,void 0,function*(){const[r]=a.ethers.utils.defaultAbiCoder.decode(["address"],yield e.getStorageAt(t,rt));return r})},exports.packOrderUidParams=be,exports.proxyInterface=function(e){var t;return new a.Contract(e.address,nt,null!==(t=e.signer)&&void 0!==t?t:e.provider)},exports.request=E,exports.signOrder=ge,exports.signOrderCancellation=function(e,t,r,n){return Se(this,void 0,void 0,function*(){return ve(e,[t],r,n)})},exports.signOrderCancellations=ve,exports.timestamp=pe,exports.transformDataToStruct=Ft,exports.transformStructToData=Mt;
//# sourceMappingURL=index-29756f86.js.map
